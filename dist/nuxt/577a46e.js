/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[50,55,205],{1037:function(e,t,n){"use strict";n.r(t);var r=n(755),o=n(759),c=n(174),l=n(175),h=n(281),d=n(283),f=n(107),_=n(758),v=n(77),m=n(297),y=n(0),w=(n(16),n(45),n(58),n(6)),k=n(837),C=(n(831),Object(w.b)({name:"ParticipantSheet",directives:{Touch:m.a},props:{chat:{type:Object,default:function(){return{}}},participants:{type:Object,default:function(){return{}}},admins:{type:Object,default:function(){return{}}}},setup:function(e){var t=Object(w.l)(),n=t.$notify,r=t.i18n,o=Object(w.q)(),c=o.state,l=o.dispatch,h=Object(w.p)(),d=Object(w.a)((function(){return c.user})),f=Object(w.i)(!1),_=Object(w.i)({}),v=function(){var t=Object(y.a)(regeneratorRuntime.mark((function t(p){var o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o=e.chat.admins.includes(p.id))||1!==e.chat.admins.length){t.next=3;break}return t.abrupt("return",n.show({text:r.t("notify.not_enough_admins"),color:"error"}));case 3:return t.next=5,l("chats/updateField",{id:e.chat.id,admins:o?k.a.firestore.FieldValue.arrayRemove(p.id):k.a.firestore.FieldValue.arrayUnion(p.id)});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),m=function(){var t=Object(y.a)(regeneratorRuntime.mark((function t(p){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,l("chats/updateField",{id:e.chat.id,participants:k.a.firestore.FieldValue.arrayRemove(p.id)});case 2:if(!t.sent||p.id!==d.value.data.uid){t.next=5;break}return t.abrupt("return",h.push("/chsts"));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return{openBottomSheet:function(p){_.value=p,f.value=!0},showBottomSheet:f,user:d,participant:_,swipe:function(e){"Down"===e&&(f.value=!1)},viewParticipantProfile:function(p){return p.id===d.value.data.uid?h.push("/profile"):h.push("/users/user/".concat(p.id))},setParticipantAsAdmin:v,removeParticipant:m}}})),O=C,T=n(42),component=Object(T.a)(O,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._l(e.participants,(function(t,r){return n(l.a,{key:r,on:{click:function(n){return e.openBottomSheet(t)}}},[n(h.a,[n("ChatAvatar",{attrs:{user:t}})],1),e._v(" "),n(f.c,[e._v("\n        "+e._s(t.username)+"\n    ")])],1)})),e._v(" "),n(r.a,{attrs:{scrollable:!0,"max-width":"700"},model:{value:e.showBottomSheet,callback:function(t){e.showBottomSheet=t},expression:"showBottomSheet"}},[n(v.a,{staticClass:"rounded-t-xl",attrs:{height:"93vh"}},[n("div",{staticClass:"ma-3",staticStyle:{"padding-bottom":"180px"}},[n("GlobalSlidebar",{directives:[{def:m.b,name:"touch",rawName:"v-touch",value:{down:function(){return e.swipe("Down")}},expression:"{ down: () => swipe('Down') }"}],nativeOn:{click:function(t){return e.swipe("Down")}}}),e._v(" "),e.participant?n(_.a,{staticClass:"text-center mb-10",attrs:{"no-gutters":""}},[n(o.a,{attrs:{cols:"12"}},[n("ChatAvatar",{attrs:{user:e.participant,size:80}})],1),e._v(" "),n(o.a,{staticClass:"text-h2 pt-5 pb-2",attrs:{cols:"12"}},[e._v("\n            "+e._s(e.participant.username?e.participant.username:e.participant.first_name?e.participant.first_name:"")+"\n          ")])],1):e._e(),e._v(" "),n(d.a,{staticClass:"mt-10"},[n(l.a,{key:"profile",on:{click:function(t){return e.viewParticipantProfile(e.participant)}}},[n(h.a,[n(c.a,{attrs:{small:""}},[e._v("mdi-account")])],1),e._v(" "),n(f.c,[e._v("\n              "+e._s(e.$t("chat.view_profile"))+"\n            ")])],1)],1),e._v(" "),n(d.a,{staticClass:"mt-5"},[e.chat.admins.includes(e.user.data.uid)?n(l.a,{key:"mute-chat",on:{click:function(t){return e.setParticipantAsAdmin(e.participant)}}},[n(h.a,[n(c.a,{attrs:{small:"",color:e.chat.admins.includes(e.participant.id)?"red":""}},[e._v("mdi-account-lock")])],1),e._v(" "),n(f.c,{class:e.chat.admins.includes(e.participant.id)?"red--text":""},[e._v("\n              "+e._s(e.chat.admins.includes(e.participant.id)?"Remove As Admin":"Make An Admin")+"\n            ")])],1):e._e(),e._v(" "),e.chat.admins.includes(e.user.data.uid)||e.user.data.uid===e.participant.id?n(l.a,{key:"leave-group",on:{click:function(t){return e.removeParticipant(e.participant)}}},[n(h.a,[n(c.a,{attrs:{small:"",color:"red"}},[e._v("mdi-exit-to-app")])],1),e._v(" "),n(f.c,{staticClass:"red--text"},[e._v("\n              "+e._s(e.participants.size>1?e.participant.id===e.user.data.id?e.$t("chat.leave_group"):e.$t("chat.remove_from_group"):e.$t("chat.leave_chat"))+"\n            ")])],1):e._e()],1)],1)])],1)],2)}),[],!1,null,null,null);t.default=component.exports;installComponents(component,{ChatAvatar:n(815).default,GlobalSlidebar:n(430).default})},765:function(e,t,n){var content=n(766);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(37).default)("1cdf85c7",content,!0,{sourceMap:!1})},766:function(e,t,n){var r=n(36)(!1);r.push([e.i,".input-tel__input{background:#f6f6f6 !important;border:none !important;padding:1.75rem !important}input.country-selector__input{border:none !important;background:#f6f6f6 !important;height:56px !important}.country-selector__country-flag{top:25px}.country-selector__toggle{top:calc(50% - 4px) !important}.theme--light.v-application,.theme--light.v-app-bar.v-toolbar.v-sheet{background-color:#eef3ff}.theme--light.v-tabs-items{background-color:#eef3ff}.theme--light .cart-popup-contents{background-color:#fff}.theme--light.v-stepper{background:transparent}.theme--light.v-sheet.product-card,.theme--light.v-sheet.company-card,.theme--light.v-sheet.post-card,.theme--light.v-sheet.recent-news-card,.theme--light.v-sheet.company-list-card{background-color:#fff;border:7px solid rgba(222,222,222,.2)}.theme--light.v-skeleton-loader .v-skeleton-loader__actions,.theme--light.v-skeleton-loader .v-skeleton-loader__article,.theme--light.v-skeleton-loader .v-skeleton-loader__card-heading,.theme--light.v-skeleton-loader .v-skeleton-loader__card-text,.theme--light.v-skeleton-loader .v-skeleton-loader__date-picker,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-avatar,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-text,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-two-line,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-avatar-two-line,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-three-line,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-avatar-three-line,.theme--light.v-skeleton-loader .v-skeleton-loader__table-heading,.theme--light.v-skeleton-loader .v-skeleton-loader__table-thead,.theme--light.v-skeleton-loader .v-skeleton-loader__table-tbody,.theme--light.v-skeleton-loader .v-skeleton-loader__table-tfoot{background:transparent !important}.theme--light.slide-up{background-color:#eef3ff}.theme--dark.v-application,.theme--dark.v-app-bar.v-toolbar.v-sheet{background-color:#242a33}.theme--dark.v-navigation-drawer{background-color:transparent}.theme--dark.v-navigation-drawer:not(.v-navigation-drawer--floating) .v-navigation-drawer__border{background-color:transparent}.theme--dark.v-bottom-navigation{background-color:#242a33}.theme--dark.v-tabs-items{background-color:transparent}.theme--dark.v-sheet{background-color:#242a33}.v-dialog .theme--dark.v-sheet{background-color:#242a33}.theme--dark.shipping-options{background-color:#242a33}.theme--dark.v-tabs-items{background-color:#242a33}.theme--dark .cart-popup-contents{background-color:#242a33}.theme--dark.v-sheet.product-card,.theme--dark.v-sheet.company-card,.theme--dark.v-sheet.post-card,.theme--dark.v-sheet.recent-news-card,.theme--dark.v-sheet.company-list-card{background-color:#fff;border:7px solid #15191e}.theme--dark.v-card>.v-card__title{color:#000}.theme--dark.v-card>.v-card__text{color:#000}.theme--dark.slide-up{background-color:#242a33}.appBarHeight{height:calc(60px + env(safe-area-inset-top))}.mobileNotch{padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left) !important;height:inherit !important}header.mobileNotch{max-height:100px}.v-card__subtitle,.v-card__text{line-height:1.975rem;letter-spacing:0 !important}.v-application .body-1{letter-spacing:0 !important}.v-application .primary{background-color:#6fa7e0;border-color:#6fa7e0}.v-bottom-sheet.v-dialog.v-bottom-sheet--inset{max-width:90%}.v-dialog--scrollable>.v-sheet{overflow-y:scroll !important}@media screen and (max-width: 600px){.v-bottom-sheet.v-dialog.v-bottom-sheet--inset{max-width:100%}}.admin-container{margin-top:0;margin-bottom:15px;padding-top:0;padding-left:0;padding-right:0}.avatar-elevation{border:4px solid #fff}.no-break{word-break:break-word}.v-application a{text-decoration:none;color:#6fa7e0 !important}.missing-image{opacity:.25}.post-card .name,.product-card .name,.company-card .title{word-break:break-word;line-height:1.33em;letter-spacing:-0.3px !important}.phoneNumberInput .input-tel__input{font-size:16px !important;border-top:3px solid rgba(118,118,118,.05) !important;border-right:3px solid rgba(118,118,118,.05) !important;border-bottom:3px solid rgba(118,118,118,.05) !important;padding-left:1px !important}.phoneNumberInput .country-selector__input{font-size:16px !important;border-top:3px solid rgba(118,118,118,.05) !important;border-left:3px solid rgba(118,118,118,.05) !important;border-bottom:3px solid rgba(118,118,118,.05) !important;height:62px !important}.phoneNumberInput .country-selector__toggle{top:20px !important}.phoneNumberInput .country-selector__country-flag{top:27px !important}.v-text-field--outlined fieldset{border-color:#f1f0ef !important}.country-selector.has-hint .country-selector__input,.country-selector.has-value .country-selector__input{padding-top:0 !important}.alertBtn{font-size:1.45rem;font-weight:600;letter-spacing:1px;text-transform:capitalize;color:#fff}.borderButton{border:3px solid #f1f0ef;background-color:#f8f9fa}.borderInput{border:3px solid #f1f0ef;background-color:#f8f9fa}details>summary{font-size:17px;margin:10px 0px 10px;border-bottom:1px solid #fefefe;padding:15px 0 30px}.v-list--rounded.v-list--three-line .v-list-item,.v-list--rounded.v-list--three-line .v-list-item::before,.v-list--rounded.v-list--three-line .v-list-item>.v-ripple__container{border-radius:32px !important}.v-list--rounded .v-list-item,.v-list--rounded .v-list-item::before,.v-list--rounded .v-list-item>.v-ripple__container{border-radius:15px !important}.myshout .theme--light.v-list-item:not(.v-list-item--active):not(.v-list-item--disabled){border:2px solid #f0f0ef;background:#f9f9f9;margin-bottom:15px}.myshout .v-list-item__title{font-size:1rem;font-weight:600}.myshout .v-list-item__subtitle{font-size:.9rem}.myshout .v-list-item__icon{width:80px;height:80px;border-radius:20px;text-align:center}.myshout .v-list-item__icon .v-icon{font-size:33px;width:100%}.v-application--is-ltr .myshout .v-list-item__action:first-child,.v-application--is-ltr .myshout .v-list-item__icon:first-child{margin-right:10px}.theme--light.v-image{color:rgba(0,0,0,.87)}.theme--dark.v-image{color:#fff}.v-image{z-index:0}.v-image__image,.v-image__placeholder{z-index:-1;position:absolute;top:0;left:0;width:100%;height:100%}.v-image__image{background-repeat:no-repeat}.v-image__image--preload{filter:blur(2px)}.v-image__image--contain{background-size:contain}.v-image__image--cover{background-size:cover}",""]),e.exports=r},767:function(e,t,n){var content=n(768);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(37).default)("2fba213c",content,!0,{sourceMap:!1})},768:function(e,t,n){var r=n(36)(!1);r.push([e.i,".input-tel__input{background:#f6f6f6 !important;border:none !important;padding:1.75rem !important}input.country-selector__input{border:none !important;background:#f6f6f6 !important;height:56px !important}.country-selector__country-flag{top:25px}.country-selector__toggle{top:calc(50% - 4px) !important}.theme--light.v-application,.theme--light.v-app-bar.v-toolbar.v-sheet{background-color:#eef3ff}.theme--light.v-tabs-items{background-color:#eef3ff}.theme--light .cart-popup-contents{background-color:#fff}.theme--light.v-stepper{background:transparent}.theme--light.v-sheet.product-card,.theme--light.v-sheet.company-card,.theme--light.v-sheet.post-card,.theme--light.v-sheet.recent-news-card,.theme--light.v-sheet.company-list-card{background-color:#fff;border:7px solid rgba(222,222,222,.2)}.theme--light.v-skeleton-loader .v-skeleton-loader__actions,.theme--light.v-skeleton-loader .v-skeleton-loader__article,.theme--light.v-skeleton-loader .v-skeleton-loader__card-heading,.theme--light.v-skeleton-loader .v-skeleton-loader__card-text,.theme--light.v-skeleton-loader .v-skeleton-loader__date-picker,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-avatar,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-text,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-two-line,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-avatar-two-line,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-three-line,.theme--light.v-skeleton-loader .v-skeleton-loader__list-item-avatar-three-line,.theme--light.v-skeleton-loader .v-skeleton-loader__table-heading,.theme--light.v-skeleton-loader .v-skeleton-loader__table-thead,.theme--light.v-skeleton-loader .v-skeleton-loader__table-tbody,.theme--light.v-skeleton-loader .v-skeleton-loader__table-tfoot{background:transparent !important}.theme--light.slide-up{background-color:#eef3ff}.theme--dark.v-application,.theme--dark.v-app-bar.v-toolbar.v-sheet{background-color:#242a33}.theme--dark.v-navigation-drawer{background-color:transparent}.theme--dark.v-navigation-drawer:not(.v-navigation-drawer--floating) .v-navigation-drawer__border{background-color:transparent}.theme--dark.v-bottom-navigation{background-color:#242a33}.theme--dark.v-tabs-items{background-color:transparent}.theme--dark.v-sheet{background-color:#242a33}.v-dialog .theme--dark.v-sheet{background-color:#242a33}.theme--dark.shipping-options{background-color:#242a33}.theme--dark.v-tabs-items{background-color:#242a33}.theme--dark .cart-popup-contents{background-color:#242a33}.theme--dark.v-sheet.product-card,.theme--dark.v-sheet.company-card,.theme--dark.v-sheet.post-card,.theme--dark.v-sheet.recent-news-card,.theme--dark.v-sheet.company-list-card{background-color:#fff;border:7px solid #15191e}.theme--dark.v-card>.v-card__title{color:#000}.theme--dark.v-card>.v-card__text{color:#000}.theme--dark.slide-up{background-color:#242a33}.appBarHeight{height:calc(60px + env(safe-area-inset-top))}.mobileNotch{padding:env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left) !important;height:inherit !important}header.mobileNotch{max-height:100px}.v-card__subtitle,.v-card__text{line-height:1.975rem;letter-spacing:0 !important}.v-application .body-1{letter-spacing:0 !important}.v-application .primary{background-color:#6fa7e0;border-color:#6fa7e0}.v-bottom-sheet.v-dialog.v-bottom-sheet--inset{max-width:90%}.v-dialog--scrollable>.v-sheet{overflow-y:scroll !important}@media screen and (max-width: 600px){.v-bottom-sheet.v-dialog.v-bottom-sheet--inset{max-width:100%}}.admin-container{margin-top:0;margin-bottom:15px;padding-top:0;padding-left:0;padding-right:0}.avatar-elevation{border:4px solid #fff}.no-break{word-break:break-word}.v-application a{text-decoration:none;color:#6fa7e0 !important}.missing-image{opacity:.25}.post-card .name,.product-card .name,.company-card .title{word-break:break-word;line-height:1.33em;letter-spacing:-0.3px !important}.phoneNumberInput .input-tel__input{font-size:16px !important;border-top:3px solid rgba(118,118,118,.05) !important;border-right:3px solid rgba(118,118,118,.05) !important;border-bottom:3px solid rgba(118,118,118,.05) !important;padding-left:1px !important}.phoneNumberInput .country-selector__input{font-size:16px !important;border-top:3px solid rgba(118,118,118,.05) !important;border-left:3px solid rgba(118,118,118,.05) !important;border-bottom:3px solid rgba(118,118,118,.05) !important;height:62px !important}.phoneNumberInput .country-selector__toggle{top:20px !important}.phoneNumberInput .country-selector__country-flag{top:27px !important}.v-text-field--outlined fieldset{border-color:#f1f0ef !important}.country-selector.has-hint .country-selector__input,.country-selector.has-value .country-selector__input{padding-top:0 !important}.alertBtn{font-size:1.45rem;font-weight:600;letter-spacing:1px;text-transform:capitalize;color:#fff}.borderButton{border:3px solid #f1f0ef;background-color:#f8f9fa}.borderInput{border:3px solid #f1f0ef;background-color:#f8f9fa}details>summary{font-size:17px;margin:10px 0px 10px;border-bottom:1px solid #fefefe;padding:15px 0 30px}.v-list--rounded.v-list--three-line .v-list-item,.v-list--rounded.v-list--three-line .v-list-item::before,.v-list--rounded.v-list--three-line .v-list-item>.v-ripple__container{border-radius:32px !important}.v-list--rounded .v-list-item,.v-list--rounded .v-list-item::before,.v-list--rounded .v-list-item>.v-ripple__container{border-radius:15px !important}.myshout .theme--light.v-list-item:not(.v-list-item--active):not(.v-list-item--disabled){border:2px solid #f0f0ef;background:#f9f9f9;margin-bottom:15px}.myshout .v-list-item__title{font-size:1rem;font-weight:600}.myshout .v-list-item__subtitle{font-size:.9rem}.myshout .v-list-item__icon{width:80px;height:80px;border-radius:20px;text-align:center}.myshout .v-list-item__icon .v-icon{font-size:33px;width:100%}.v-application--is-ltr .myshout .v-list-item__action:first-child,.v-application--is-ltr .myshout .v-list-item__icon:first-child{margin-right:10px}.v-responsive{position:relative;overflow:hidden;flex:1 0 auto;max-width:100%;display:flex}.v-responsive__content{flex:1 0 0px;max-width:100%}.v-application--is-ltr .v-responsive__sizer~.v-responsive__content{margin-left:-100%}.v-application--is-rtl .v-responsive__sizer~.v-responsive__content{margin-right:-100%}.v-responsive__sizer{transition:padding-bottom .2s cubic-bezier(0.25, 0.8, 0.5, 1);flex:1 0 0px}",""]),e.exports=r},783:function(e,t,n){"use strict";var r=n(25),o=(n(89),n(52),n(238),n(95),n(62),n(765),n(181)),c=(n(767),n(109)),l=n(27),h=n(3),d=Object(l.a)(c.a).extend({name:"v-responsive",props:{aspectRatio:[String,Number],contentClass:String},computed:{computedAspectRatio:function(){return Number(this.aspectRatio)},aspectStyle:function(){return this.computedAspectRatio?{paddingBottom:1/this.computedAspectRatio*100+"%"}:void 0},__cachedSizer:function(){return this.aspectStyle?this.$createElement("div",{style:this.aspectStyle,staticClass:"v-responsive__sizer"}):[]}},methods:{genContent:function(){return this.$createElement("div",{staticClass:"v-responsive__content",class:this.contentClass},Object(h.r)(this))}},render:function(e){return e("div",{staticClass:"v-responsive",style:this.measurableStyles,on:this.$listeners},[this.__cachedSizer,this.genContent()])}}),f=n(50),_=n(119),v=n(28),m="undefined"!=typeof window&&"IntersectionObserver"in window;t.a=Object(l.a)(d,f.a).extend({name:"v-img",directives:{intersect:o.b},props:{alt:String,contain:Boolean,eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:function(){return{root:void 0,rootMargin:void 0,threshold:void 0}}},position:{type:String,default:"center center"},sizes:String,src:{type:[String,Object],default:""},srcset:String,transition:{type:[Boolean,String],default:"fade-transition"}},data:function(){return{currentSrc:"",image:null,isLoading:!0,calculatedAspectRatio:void 0,naturalWidth:void 0,hasError:!1}},computed:{computedAspectRatio:function(){return Number(this.normalisedSrc.aspect||this.calculatedAspectRatio)},normalisedSrc:function(){return this.src&&"object"===Object(r.a)(this.src)?{src:this.src.src,srcset:this.srcset||this.src.srcset,lazySrc:this.lazySrc||this.src.lazySrc,aspect:Number(this.aspectRatio||this.src.aspect)}:{src:this.src,srcset:this.srcset,lazySrc:this.lazySrc,aspect:Number(this.aspectRatio||0)}},__cachedImage:function(){if(!(this.normalisedSrc.src||this.normalisedSrc.lazySrc||this.gradient))return[];var e=[],t=this.isLoading?this.normalisedSrc.lazySrc:this.currentSrc;this.gradient&&e.push("linear-gradient(".concat(this.gradient,")")),t&&e.push('url("'.concat(t,'")'));var image=this.$createElement("div",{staticClass:"v-image__image",class:{"v-image__image--preload":this.isLoading,"v-image__image--contain":this.contain,"v-image__image--cover":!this.contain},style:{backgroundImage:e.join(", "),backgroundPosition:this.position},key:+this.isLoading});return this.transition?this.$createElement("transition",{attrs:{name:this.transition,mode:"in-out"}},[image]):image}},watch:{src:function(){this.isLoading?this.loadImage():this.init(void 0,void 0,!0)},"$vuetify.breakpoint.width":"getSrc"},mounted:function(){this.init()},methods:{init:function(e,t,n){if(!m||n||this.eager){if(this.normalisedSrc.lazySrc){var r=new Image;r.src=this.normalisedSrc.lazySrc,this.pollForSize(r,null)}this.normalisedSrc.src&&this.loadImage()}},onLoad:function(){this.getSrc(),this.isLoading=!1,this.$emit("load",this.src),this.image&&(this.normalisedSrc.src.endsWith(".svg")||this.normalisedSrc.src.startsWith("data:image/svg+xml"))&&(this.image.naturalHeight&&this.image.naturalWidth?(this.naturalWidth=this.image.naturalWidth,this.calculatedAspectRatio=this.image.naturalWidth/this.image.naturalHeight):this.calculatedAspectRatio=1)},onError:function(){this.hasError=!0,this.$emit("error",this.src)},getSrc:function(){this.image&&(this.currentSrc=this.image.currentSrc||this.image.src)},loadImage:function(){var e=this,image=new Image;this.image=image,image.onload=function(){image.decode?image.decode().catch((function(t){Object(v.c)("Failed to decode image, trying to render anyway\n\n"+"src: ".concat(e.normalisedSrc.src)+(t.message?"\nOriginal error: ".concat(t.message):""),e)})).then(e.onLoad):e.onLoad()},image.onerror=this.onError,this.hasError=!1,this.sizes&&(image.sizes=this.sizes),this.normalisedSrc.srcset&&(image.srcset=this.normalisedSrc.srcset),image.src=this.normalisedSrc.src,this.$emit("loadstart",this.normalisedSrc.src),this.aspectRatio||this.pollForSize(image),this.getSrc()},pollForSize:function(img){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;!function n(){var r=img.naturalHeight,o=img.naturalWidth;r||o?(e.naturalWidth=o,e.calculatedAspectRatio=o/r):img.complete||!e.isLoading||e.hasError||null==t||setTimeout(n,t)}()},genContent:function(){var content=d.options.methods.genContent.call(this);return this.naturalWidth&&this._b(content.data,"div",{style:{width:"".concat(this.naturalWidth,"px")}}),content},__genPlaceholder:function(){var slot=Object(h.r)(this,"placeholder");if(slot){var e=this.isLoading?[this.$createElement("div",{staticClass:"v-image__placeholder"},slot)]:[];return this.transition?this.$createElement("transition",{props:{appear:!0,name:this.transition}},e):e[0]}}},render:function(e){var t=d.options.render.call(this,e),data=Object(_.a)(t.data,{staticClass:"v-image",attrs:{"aria-label":this.alt,role:this.alt?"img":void 0},class:this.themeClasses,directives:m?[{name:"intersect",modifiers:{once:!0},value:{handler:this.init,options:this.options}}]:void 0});return t.children=[this.__cachedSizer,this.__cachedImage,this.__genPlaceholder(),this.genContent()],e(t.tag,data,t.children)}})},814:function(e,t,n){"use strict";var r=n(770),o=n(776),c=n(781),l={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},h=function(e){function t(code,n,details){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r.code=code,r.details=details,r}return Object(o.__extends)(t,e),t}(Error);var d=function(){function e(e,t){var n=this;this.auth=null,this.messaging=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then((function(e){return n.auth=e}),(function(){})),this.messaging||t.get().then((function(e){return n.messaging=e}),(function(){}))}return e.prototype.getAuthToken=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(t){switch(t.label){case 0:if(!this.auth)return[2,void 0];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return(e=t.sent())?[2,e.accessToken]:[2,void 0];case 3:return t.sent(),[2,void 0];case 4:return[2]}}))}))},e.prototype.getInstanceIdToken=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){return Object(o.__generator)(this,(function(e){switch(e.label){case 0:if(!this.messaging||!("Notification"in self)||"granted"!==Notification.permission)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.messaging.getToken()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,void 0];case 4:return[2]}}))}))},e.prototype.getContext=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return e=n.sent(),[4,this.getInstanceIdToken()];case 2:return t=n.sent(),[2,{authToken:e,instanceIdToken:t}]}}))}))},e}();function f(e,t){var n={};for(var r in e)e.hasOwnProperty(r)&&(n[r]=t(e[r]));return n}var _=function(){function e(){}return e.prototype.encode=function(data){var e=this;if(null==data)return null;if(data instanceof Number&&(data=data.valueOf()),"number"==typeof data&&isFinite(data))return data;if(!0===data||!1===data)return data;if("[object String]"===Object.prototype.toString.call(data))return data;if(data instanceof Date)return data.toISOString();if(Array.isArray(data))return data.map((function(t){return e.encode(t)}));if("function"==typeof data||"object"==typeof data)return f(data,(function(t){return e.encode(t)}));throw new Error("Data cannot be encoded in JSON: "+data)},e.prototype.decode=function(e){var t=this;if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":var n=Number(e.value);if(isNaN(n))throw new Error("Data cannot be decoded from JSON: "+e);return n;default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map((function(e){return t.decode(e)})):"function"==typeof e||"object"==typeof e?f(e,(function(e){return t.decode(e)})):e},e}();var v=function(){function e(e,t,n,r,o,c){var l=this;void 0===o&&(o="us-central1"),this.app_=e,this.appCheckProvider=r,this.fetchImpl=c,this.serializer=new _,this.emulatorOrigin=null,this.INTERNAL={delete:function(){return Promise.resolve(l.deleteService())}},this.contextProvider=new d(t,n),this.cancelAllRequests=new Promise((function(e){l.deleteService=function(){return e()}}));try{var h=new URL(o);this.customDomain=h.origin,this.region="us-central1"}catch(e){this.customDomain=null,this.region=o}}return Object.defineProperty(e.prototype,"app",{get:function(){return this.app_},enumerable:!1,configurable:!0}),e.prototype._url=function(e){var t=this.app_.options.projectId;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+t+"/"+this.region+"/"+e:null!==this.customDomain?this.customDomain+"/"+e:"https://"+this.region+"-"+t+".cloudfunctions.net/"+e},e.prototype.useEmulator=function(e,t){this.emulatorOrigin="http://"+e+":"+t},e.prototype.useFunctionsEmulator=function(e){this.emulatorOrigin=e},e.prototype.httpsCallable=function(e,t){var n=this;return function(data){return n.call(e,data,t||{})}},e.prototype.postJSON=function(e,body,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,r,c;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return t["Content-Type"]="application/json",[4,this.getAppCheckToken()];case 1:null!==(n=o.sent())&&(t["X-Firebase-AppCheck"]=n),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,this.fetchImpl(e,{method:"POST",body:JSON.stringify(body),headers:t})];case 3:return r=o.sent(),[3,5];case 4:return o.sent(),[2,{status:0,json:null}];case 5:c=null,o.label=6;case 6:return o.trys.push([6,8,,9]),[4,r.json()];case 7:return c=o.sent(),[3,9];case 8:return o.sent(),[3,9];case 9:return[2,{status:r.status,json:c}]}}))}))},e.prototype.getAppCheckToken=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return(e=this.appCheckProvider.getImmediate({optional:!0}))?[4,e.getToken()]:[3,2];case 1:return[2,t.sent().token];case 2:return[2,null]}}))}))},e.prototype.call=function(e,data,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,body,r,c,d,f,_,v,y,w,k;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return n=this._url(e),data=this.serializer.encode(data),body={data:data},r={},[4,this.contextProvider.getContext()];case 1:return(c=o.sent()).authToken&&(r.Authorization="Bearer "+c.authToken),c.instanceIdToken&&(r["Firebase-Instance-ID-Token"]=c.instanceIdToken),d=t.timeout||7e4,f=function(e){var t,n=new Promise((function(n,r){t=setTimeout((function(){r(new h("deadline-exceeded","deadline-exceeded"))}),e)}));return{timer:t,promise:n}}(d),_=f.timer,v=f.promise,[4,Promise.race([m(_,this.postJSON(n,body,r)),v,m(_,this.cancelAllRequests)])];case 2:if(!(y=o.sent()))throw new h("cancelled","Firebase Functions instance was deleted.");if(w=function(e,t,n){var code=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),r=code,details=void 0;try{var o=t&&t.error;if(o){var c=o.status;if("string"==typeof c){if(!l[c])return new h("internal","internal");code=l[c],r=c}var d=o.message;"string"==typeof d&&(r=d),void 0!==(details=o.details)&&(details=n.decode(details))}}catch(e){}return"ok"===code?null:new h(code,r,details)}(y.status,y.json,this.serializer))throw w;if(!y.json)throw new h("internal","Response is not valid JSON object.");if(void 0===(k=y.json.data)&&(k=y.json.result),void 0===k)throw new h("internal","Response is missing data field.");return[2,{data:this.serializer.decode(k)}]}}))}))},e}();function m(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return[4,t];case 1:return n=r.sent(),clearTimeout(e),[2,n]}}))}))}var y,w,k;y=r.default,w=fetch.bind(self),k={Functions:v},y.INTERNAL.registerComponent(new c.Component("functions",(function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),o=e.getProvider("auth-internal"),c=e.getProvider("app-check-internal"),l=e.getProvider("messaging");return new v(r,o,l,c,n,w)}),"PUBLIC").setServiceProps(k).setMultipleInstances(!0)),r.default.registerVersion("@firebase/functions","0.6.16")},815:function(e,t,n){"use strict";n.r(t);var r=n(282),o=n(783),c=(n(52),n(6)),l=Object(c.b)({name:"ChatAvatar",props:{user:{type:Object,default:function(){return{}}},color:{type:String,default:function(){return"primary"}},size:{type:Number,default:function(){return 30}}}}),h=n(42),component=Object(h.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(r.a,{attrs:{size:e.size,elevation:"10",color:e.color+" lighten-2",rounded:""}},[e.user.photoURL?n(o.a,{attrs:{src:e.user.photoURL}}):n("span",{staticClass:"white--text headline"},[e._v(e._s(e.user.initial?e.user.initial:e.user.username?e.user.username.charAt(0):":)"))])],1)}),[],!1,null,null,null);t.default=component.exports},831:function(e,t,n){"use strict";n.r(t);n(814)},837:function(e,t,n){"use strict";n.d(t,"a",(function(){return o.default}));var r,o=n(770),c=(n(856),n(852),n(857),n(840)),l=n(780),h=n(788);n(825);(r=c.e).prototype.loadBundle=c.t,r.prototype.namedQuery=c.l;n(814),n(841),n(842),n(795);var d,f,_,v=n(776),m=n(781),y="0.4.18",w=y,k="FB-PERF-TRACE-MEASURE",C="_wt_",O="_fcp",T="_fid",I="@firebase/performance/config",E="@firebase/performance/configexpire",S="Performance",x=((d={})["trace started"]="Trace {$traceName} was started before.",d["trace stopped"]="Trace {$traceName} is not running.",d["nonpositive trace startTime"]="Trace {$traceName} startTime should be positive.",d["nonpositive trace duration"]="Trace {$traceName} duration should be positive.",d["no window"]="Window is not available.",d["no app id"]="App id is not available.",d["no project id"]="Project id is not available.",d["no api key"]="Api key is not available.",d["invalid cc log"]="Attempted to queue invalid cc event",d["FB not default"]="Performance can only start when Firebase app instance is the default one.",d["RC response not ok"]="RC response is not ok",d["invalid attribute name"]="Attribute name {$attributeName} is invalid.",d["invalid attribute value"]="Attribute value {$attributeValue} is invalid.",d["invalid custom metric name"]="Custom metric name {$customMetricName} is invalid",d["invalid String merger input"]="Input for String merger is invalid, contact support team to resolve.",d),P=new l.ErrorFactory("performance",S,x),j=new h.Logger(S);j.logLevel=h.LogLevel.INFO;var R,N=function(){function e(e){if(this.window=e,!e)throw P.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}return e.prototype.getUrl=function(){return this.windowLocation.href.split("?")[0]},e.prototype.mark=function(e){this.performance&&this.performance.mark&&this.performance.mark(e)},e.prototype.measure=function(e,t,n){this.performance&&this.performance.measure&&this.performance.measure(e,t,n)},e.prototype.getEntriesByType=function(e){return this.performance&&this.performance.getEntriesByType?this.performance.getEntriesByType(e):[]},e.prototype.getEntriesByName=function(e){return this.performance&&this.performance.getEntriesByName?this.performance.getEntriesByName(e):[]},e.prototype.getTimeOrigin=function(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)},e.prototype.requiredApisAvailable=function(){return fetch&&Promise&&this.navigator&&this.navigator.cookieEnabled?!!Object(l.isIndexedDBAvailable)()||(j.info("IndexedDB is not supported by current browswer"),!1):(j.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1)},e.prototype.setupObserver=function(e,t){this.PerformanceObserver&&new this.PerformanceObserver((function(e){for(var n=0,r=e.getEntries();n<r.length;n++){var o=r[n];t(o)}})).observe({entryTypes:[e]})},e.getInstance=function(){return void 0===f&&(f=new e(_)),f},e}();function A(e,t){var n=e.length-t.length;if(n<0||n>1)throw P.create("invalid String merger input");for(var r=[],i=0;i<e.length;i++)r.push(e.charAt(i)),t.length>i&&r.push(t.charAt(i));return r.join("")}var M,D,F=function(){function e(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=A("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=A("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}return e.prototype.getAppId=function(){var e=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.appId;if(!e)throw P.create("no app id");return e},e.prototype.getProjectId=function(){var e=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.projectId;if(!e)throw P.create("no project id");return e},e.prototype.getApiKey=function(){var e=this.firebaseAppInstance&&this.firebaseAppInstance.options&&this.firebaseAppInstance.options.apiKey;if(!e)throw P.create("no api key");return e},e.prototype.getFlTransportFullUrl=function(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)},e.getInstance=function(){return void 0===R&&(R=new e),R},e}();function L(){return M}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.VISIBLE=1]="VISIBLE",e[e.HIDDEN=2]="HIDDEN"}(D||(D={}));var U=["firebase_","google_","ga_"],B=new RegExp("^[a-zA-Z]\\w*$");function W(){var e=N.getInstance().navigator;return"serviceWorker"in e?e.serviceWorker.controller?2:3:1}function z(){switch(N.getInstance().document.visibilityState){case"visible":return D.VISIBLE;case"hidden":return D.HIDDEN;default:return D.UNKNOWN}}function K(){var e=N.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}var H="0.0.1",V={loggingEnabled:!0},G="FIREBASE_INSTALLATIONS_AUTH";function Q(e){var t=function(){var e=N.getInstance().localStorage;if(!e)return;var t=e.getItem(E);if(!(t&&(n=t,Number(n)>Date.now())))return;var n;var r=e.getItem(I);if(!r)return;try{return JSON.parse(r)}catch(e){return}}();return t?(Y(t),Promise.resolve()):function(e){return(t=F.getInstance().installationsService.getToken(),t.then((function(e){})),t).then((function(t){var n="https://firebaseremoteconfig.googleapis.com/v1/projects/"+F.getInstance().getProjectId()+"/namespaces/fireperf:fetch?key="+F.getInstance().getApiKey(),r=new Request(n,{method:"POST",headers:{Authorization:G+" "+t},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:F.getInstance().getAppId(),app_version:w,sdk_version:H})});return fetch(r).then((function(e){if(e.ok)return e.json();throw P.create("RC response not ok")}))})).catch((function(){j.info($)}));var t}(e).then(Y).then((function(e){return function(e){var t=N.getInstance().localStorage;if(!e||!t)return;t.setItem(I,JSON.stringify(e)),t.setItem(E,String(Date.now()+60*F.getInstance().configTimeToLive*60*1e3))}(e)}),(function(){}))}var $="Could not fetch config, will use default configs";function Y(e){if(!e)return e;var t=F.getInstance(),n=e.entries||{};return void 0!==n.fpr_enabled?t.loggingEnabled="true"===String(n.fpr_enabled):t.loggingEnabled=V.loggingEnabled,n.fpr_log_source&&(t.logSource=Number(n.fpr_log_source)),n.fpr_log_endpoint_url&&(t.logEndPointUrl=n.fpr_log_endpoint_url),n.fpr_log_transport_key&&(t.transportKey=n.fpr_log_transport_key),void 0!==n.fpr_vc_network_request_sampling_rate&&(t.networkRequestsSamplingRate=Number(n.fpr_vc_network_request_sampling_rate)),void 0!==n.fpr_vc_trace_sampling_rate&&(t.tracesSamplingRate=Number(n.fpr_vc_trace_sampling_rate)),t.logTraceAfterSampling=J(t.tracesSamplingRate),t.logNetworkAfterSampling=J(t.networkRequestsSamplingRate),e}function J(e){return Math.random()<=e}var X,Z=1;function ee(){return Z=2,X=X||function(){var e=N.getInstance().document;return new Promise((function(t){if(e&&"complete"!==e.readyState){var n=function(){"complete"===e.readyState&&(e.removeEventListener("readystatechange",n),t())};e.addEventListener("readystatechange",n)}else t()}))}().then((function(){return(e=F.getInstance().installationsService.getId()).then((function(e){M=e})),e;var e})).then((function(e){return Q(e)})).then((function(){return te()}),(function(){return te()}))}function te(){Z=3}var ne,re=1e4,ie=3,oe=1e3,ae=ie,se=[],ce=!1;function ue(e){setTimeout((function(){var e,t;if(0!==ae)return se.length?(e=se.splice(0,oe),t=e.map((function(e){return{source_extension_json_proto3:e.message,event_time_ms:String(e.eventTime)}})),void function(data,e){return function(data){var e=F.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(data)})}(data).then((function(e){return e.ok||j.info("Call to Firebase backend failed."),e.json()})).then((function(t){var n=Number(t.nextRequestWaitMillis),r=re;isNaN(n)||(r=Math.max(n,r));var o=t.logResponseDetails;Array.isArray(o)&&o.length>0&&"RETRY_REQUEST_LATER"===o[0].responseAction&&(se=Object(v.__spreadArray)(Object(v.__spreadArray)([],e),se),j.info("Retry transport request later.")),ae=ie,ue(r)}))}({request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:F.getInstance().logSource,log_event:t},e).catch((function(){se=Object(v.__spreadArray)(Object(v.__spreadArray)([],e),se),ae--,j.info("Tries left: "+ae+"."),ue(re)}))):ue(re)}),e)}function le(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];!function(e){if(!e.eventTime||!e.message)throw P.create("invalid cc log");se=Object(v.__spreadArray)(Object(v.__spreadArray)([],se),[e])}({message:e.apply(void 0,t),eventTime:Date.now()})}}function he(e,t){ne||(ne=le(fe)),ne(e,t)}function de(e){var t=F.getInstance();!t.instrumentationEnabled&&e.isAuto||(t.dataCollectionEnabled||e.isAuto)&&N.getInstance().requiredApisAvailable()&&(e.isAuto&&z()!==D.VISIBLE||(3===Z?pe(e):ee().then((function(){return pe(e)}),(function(){return pe(e)}))))}function pe(e){if(L()){var t=F.getInstance();t.loggingEnabled&&t.logTraceAfterSampling&&setTimeout((function(){return he(e,1)}),0)}}function fe(e,t){return 0===t?(r={url:(n=e).url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},o={application_info:_e(),network_request_metric:r},JSON.stringify(o)):function(e){var t={name:e.name,is_auto:e.isAuto,client_start_time_us:e.startTimeUs,duration_us:e.durationUs};0!==Object.keys(e.counters).length&&(t.counters=e.counters);var n=e.getAttributes();0!==Object.keys(n).length&&(t.custom_attributes=n);var r={application_info:_e(),trace_metric:t};return JSON.stringify(r)}(e);var n,r,o}function _e(){return{google_app_id:F.getInstance().getAppId(),app_instance_id:L(),web_app_info:{sdk_version:w,page_url:N.getInstance().getUrl(),service_worker_status:W(),visibility_state:z(),effective_connection_type:K()},application_process_state:0}}var ge=["_fp",O,T];var ve=function(){function e(e,t,n){void 0===t&&(t=!1),this.name=e,this.isAuto=t,this.state=1,this.customAttributes={},this.counters={},this.api=N.getInstance(),this.randomId=Math.floor(1e6*Math.random()),this.isAuto||(this.traceStartMark="FB-PERF-TRACE-START-"+this.randomId+"-"+this.name,this.traceStopMark="FB-PERF-TRACE-STOP-"+this.randomId+"-"+this.name,this.traceMeasure=n||k+"-"+this.randomId+"-"+this.name,n&&this.calculateTraceMetrics())}return e.prototype.start=function(){if(1!==this.state)throw P.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2},e.prototype.stop=function(){if(2!==this.state)throw P.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),de(this)},e.prototype.record=function(e,t,n){if(e<=0)throw P.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw P.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(1e3*t),this.startTimeUs=Math.floor(1e3*e),n&&n.attributes&&(this.customAttributes=Object(v.__assign)({},n.attributes)),n&&n.metrics)for(var r=0,o=Object.keys(n.metrics);r<o.length;r++){var c=o[r];isNaN(Number(n.metrics[c]))||(this.counters[c]=Number(Math.floor(n.metrics[c])))}de(this)},e.prototype.incrementMetric=function(e,t){void 0===t&&(t=1),void 0===this.counters[e]?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)},e.prototype.putMetric=function(e,t){if(o=e,c=this.name,0===o.length||o.length>100||!(c&&c.startsWith(C)&&ge.indexOf(o)>-1)&&o.startsWith("_"))throw P.create("invalid custom metric name",{customMetricName:e});var n,r,o,c;this.counters[e]=(n=t,(r=Math.floor(n))<n&&j.info("Metric value should be an Integer, setting the value as : "+r+"."),r)},e.prototype.getMetric=function(e){return this.counters[e]||0},e.prototype.putAttribute=function(e,t){var n,r=!(0===(n=e).length||n.length>40||U.some((function(e){return n.startsWith(e)}))||!n.match(B)),o=function(e){return 0!==e.length&&e.length<=100}(t);if(r&&o)this.customAttributes[e]=t;else{if(!r)throw P.create("invalid attribute name",{attributeName:e});if(!o)throw P.create("invalid attribute value",{attributeValue:t})}},e.prototype.getAttribute=function(e){return this.customAttributes[e]},e.prototype.removeAttribute=function(e){void 0!==this.customAttributes[e]&&delete this.customAttributes[e]},e.prototype.getAttributes=function(){return Object(v.__assign)({},this.customAttributes)},e.prototype.setStartTime=function(e){this.startTimeUs=e},e.prototype.setDuration=function(e){this.durationUs=e},e.prototype.calculateTraceMetrics=function(){var e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(1e3*t.duration),this.startTimeUs=Math.floor(1e3*(t.startTime+this.api.getTimeOrigin())))},e.createOobTrace=function(t,n,r){var o=N.getInstance().getUrl();if(o){var c=new e(C+o,!0),l=Math.floor(1e3*N.getInstance().getTimeOrigin());c.setStartTime(l),t&&t[0]&&(c.setDuration(Math.floor(1e3*t[0].duration)),c.putMetric("domInteractive",Math.floor(1e3*t[0].domInteractive)),c.putMetric("domContentLoadedEventEnd",Math.floor(1e3*t[0].domContentLoadedEventEnd)),c.putMetric("loadEventEnd",Math.floor(1e3*t[0].loadEventEnd)));if(n){var h=n.find((function(e){return"first-paint"===e.name}));h&&h.startTime&&c.putMetric("_fp",Math.floor(1e3*h.startTime));var d=n.find((function(e){return"first-contentful-paint"===e.name}));d&&d.startTime&&c.putMetric(O,Math.floor(1e3*d.startTime)),r&&c.putMetric(T,Math.floor(1e3*r))}de(c)}},e.createUserTimingTrace=function(t){de(new e(t,!1,t))},e}();function me(e){var t=e;if(t&&void 0!==t.responseStart){var n=N.getInstance().getTimeOrigin(),r=Math.floor(1e3*(t.startTime+n)),o=t.responseStart?Math.floor(1e3*(t.responseStart-t.startTime)):void 0,c=Math.floor(1e3*(t.responseEnd-t.startTime));!function(e){var t=F.getInstance();if(t.instrumentationEnabled){var n=e.url,r=t.logEndPointUrl.split("?")[0],o=t.flTransportEndpointUrl.split("?")[0];n!==r&&n!==o&&t.loggingEnabled&&t.logNetworkAfterSampling&&setTimeout((function(){return he(e,0)}),0)}}({url:t.name&&t.name.split("?")[0],responsePayloadBytes:t.transferSize,startTimeUs:r,timeToResponseInitiatedUs:o,timeToResponseCompletedUs:c})}}var ye=5e3;function be(){L()&&(setTimeout((function(){return function(){var e=N.getInstance(),t=e.getEntriesByType("navigation"),n=e.getEntriesByType("paint");if(e.onFirstInputDelay){var r=setTimeout((function(){ve.createOobTrace(t,n),r=void 0}),ye);e.onFirstInputDelay((function(e){r&&(clearTimeout(r),ve.createOobTrace(t,n,e))}))}else ve.createOobTrace(t,n)}()}),0),setTimeout((function(){return function(){for(var e=N.getInstance(),t=e.getEntriesByType("resource"),n=0,r=t;n<r.length;n++){me(r[n])}e.setupObserver("resource",me)}()}),0),setTimeout((function(){return function(){for(var e=N.getInstance(),t=e.getEntriesByType("measure"),n=0,r=t;n<r.length;n++){we(r[n])}e.setupObserver("measure",we)}()}),0))}function we(e){var t=e.name;t.substring(0,k.length)!==k&&ve.createUserTimingTrace(t)}var ke,Ce,Oe=function(){function e(e){this.app=e,N.getInstance().requiredApisAvailable()&&Object(l.validateIndexedDBOpenable)().then((function(e){e&&(ce||(ue(5500),ce=!0),ee().then(be,be))})).catch((function(e){j.info("Environment doesn't support IndexedDB: "+e)}))}return e.prototype.trace=function(e){return new ve(e)},Object.defineProperty(e.prototype,"instrumentationEnabled",{get:function(){return F.getInstance().instrumentationEnabled},set:function(e){F.getInstance().instrumentationEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataCollectionEnabled",{get:function(){return F.getInstance().dataCollectionEnabled},set:function(e){F.getInstance().dataCollectionEnabled=e},enumerable:!1,configurable:!0}),e}();ke=o.default,Ce=function(e,t){if("[DEFAULT]"!==e.name)throw P.create("FB not default");if("undefined"==typeof window)throw P.create("no window");return function(e){_=e}(window),F.getInstance().firebaseAppInstance=e,F.getInstance().installationsService=t,new Oe(e)},ke.INTERNAL.registerComponent(new m.Component("performance",(function(e){var t=e.getProvider("app").getImmediate(),n=e.getProvider("installations").getImmediate();return Ce(t,n)}),"PUBLIC")),ke.registerVersion("@firebase/performance",y);n(843),n(844),n(854);var Te="8.10.1";o.default.registerVersion("firebase",Te,"app"),o.default.SDK_VERSION=Te;console.warn("\nIt looks like you're using the development build of the Firebase JS SDK.\nWhen deploying Firebase apps to production, it is advisable to only import\nthe individual SDK components you intend to use.\n\nFor the module builds, these are available in the following manner\n(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):\n\nCommonJS Modules:\nconst firebase = require('firebase/app');\nrequire('firebase/<PACKAGE>');\n\nES Modules:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n\nTypescript:\nimport firebase from 'firebase/app';\nimport 'firebase/<PACKAGE>';\n"),o.default.registerVersion("firebase","8.10.1")},841:function(e,t,n){"use strict";n(795);var r,o,c=n(781),l=n(780),h=n(776),d=n(858),f=n(770),_=((r={})["missing-app-config-values"]='Missing App configuration value: "{$valueName}"',r["only-available-in-window"]="This method is available in a Window context.",r["only-available-in-sw"]="This method is available in a service worker context.",r["permission-default"]="The notification permission was not granted and dismissed instead.",r["permission-blocked"]="The notification permission was not granted and blocked instead.",r["unsupported-browser"]="This browser doesn't support the API's required to use the firebase SDK.",r["failed-service-worker-registration"]="We are unable to register the default service worker. {$browserErrorMessage}",r["token-subscribe-failed"]="A problem occurred while subscribing the user to FCM: {$errorInfo}",r["token-subscribe-no-token"]="FCM returned no token when subscribing the user to push.",r["token-unsubscribe-failed"]="A problem occurred while unsubscribing the user from FCM: {$errorInfo}",r["token-update-failed"]="A problem occurred while updating the user from FCM: {$errorInfo}",r["token-update-no-token"]="FCM returned no token when updating the user to push.",r["use-sw-after-get-token"]="The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",r["invalid-sw-registration"]="The input to useServiceWorker() must be a ServiceWorkerRegistration.",r["invalid-bg-handler"]="The input to setBackgroundMessageHandler() must be a function.",r["invalid-vapid-key"]="The public VAPID key must be a string.",r["use-vapid-key-after-get-token"]="The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used.",r),v=new l.ErrorFactory("messaging","Messaging",_),m="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",y="https://fcmregistrations.googleapis.com/v1",w="FCM_MSG",k="google.c.a.c_id";function C(e){var t=new Uint8Array(e);return btoa(String.fromCharCode.apply(String,Object(h.__spreadArray)([],Object(h.__read)(t)))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function O(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=atob(t),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}!function(e){e.PUSH_RECEIVED="push-received",e.NOTIFICATION_CLICKED="notification-clicked"}(o||(o={}));var T="fcm_token_details_db",I=5,E="fcm_token_object_Store";function S(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o=this;return Object(h.__generator)(this,(function(c){switch(c.label){case 0:return"databases"in indexedDB?[4,indexedDB.databases()]:[3,2];case 1:if(t=c.sent(),n=t.map((function(e){return e.name})),!n.includes(T))return[2,null];c.label=2;case 2:return r=null,[4,Object(d.openDb)(T,I,(function(t){return Object(h.__awaiter)(o,void 0,void 0,(function(){var n,o,c,l;return Object(h.__generator)(this,(function(h){switch(h.label){case 0:return t.oldVersion<2?[2]:t.objectStoreNames.contains(E)?[4,(n=t.transaction.objectStore(E)).index("fcmSenderId").get(e)]:[2];case 1:return o=h.sent(),[4,n.clear()];case 2:if(h.sent(),!o)return[2];if(2===t.oldVersion){if(!(c=o).auth||!c.p256dh||!c.endpoint)return[2];r={token:c.fcmToken,createTime:null!==(l=c.createTime)&&void 0!==l?l:Date.now(),subscriptionOptions:{auth:c.auth,p256dh:c.p256dh,endpoint:c.endpoint,swScope:c.swScope,vapidKey:"string"==typeof c.vapidKey?c.vapidKey:C(c.vapidKey)}}}else(3===t.oldVersion||4===t.oldVersion)&&(r={token:(c=o).fcmToken,createTime:c.createTime,subscriptionOptions:{auth:C(c.auth),p256dh:C(c.p256dh),endpoint:c.endpoint,swScope:c.swScope,vapidKey:C(c.vapidKey)}});return[2]}}))}))}))];case 3:return c.sent().close(),[4,Object(d.deleteDb)(T)];case 4:return c.sent(),[4,Object(d.deleteDb)("fcm_vapid_details_db")];case 5:return c.sent(),[4,Object(d.deleteDb)("undefined")];case 6:return c.sent(),[2,x(r)?r:null]}}))}))}function x(e){if(!e||!e.subscriptionOptions)return!1;var t=e.subscriptionOptions;return"number"==typeof e.createTime&&e.createTime>0&&"string"==typeof e.token&&e.token.length>0&&"string"==typeof t.auth&&t.auth.length>0&&"string"==typeof t.p256dh&&t.p256dh.length>0&&"string"==typeof t.endpoint&&t.endpoint.length>0&&"string"==typeof t.swScope&&t.swScope.length>0&&"string"==typeof t.vapidKey&&t.vapidKey.length>0}var P="firebase-messaging-database",j=1,R="firebase-messaging-store",N=null;function A(){return N||(N=Object(d.openDb)(P,j,(function(e){if(0===e.oldVersion)e.createObjectStore(R)}))),N}function M(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(h.__generator)(this,(function(o){switch(o.label){case 0:return t=L(e),[4,A()];case 1:return[4,o.sent().transaction(R).objectStore(R).get(t)];case 2:return(n=o.sent())?[2,n]:[3,3];case 3:return[4,S(e.appConfig.senderId)];case 4:return(r=o.sent())?[4,D(e,r)]:[3,6];case 5:return o.sent(),[2,r];case 6:return[2]}}))}))}function D(e,t){return Object(h.__awaiter)(this,void 0,void 0,(function(){var n,r,o;return Object(h.__generator)(this,(function(c){switch(c.label){case 0:return n=L(e),[4,A()];case 1:return r=c.sent(),[4,(o=r.transaction(R,"readwrite")).objectStore(R).put(t,n)];case 2:return c.sent(),[4,o.complete];case 3:return c.sent(),[2,t]}}))}))}function F(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(h.__generator)(this,(function(o){switch(o.label){case 0:return t=L(e),[4,A()];case 1:return n=o.sent(),[4,(r=n.transaction(R,"readwrite")).objectStore(R).delete(t)];case 2:return o.sent(),[4,r.complete];case 3:return o.sent(),[2]}}))}))}function L(e){return e.appConfig.appId}function U(e,t){return Object(h.__awaiter)(this,void 0,void 0,(function(){var n,body,r,o,c,l;return Object(h.__generator)(this,(function(h){switch(h.label){case 0:return[4,K(e)];case 1:n=h.sent(),body=H(t),r={method:"POST",headers:n,body:JSON.stringify(body)},h.label=2;case 2:return h.trys.push([2,5,,6]),[4,fetch(z(e.appConfig),r)];case 3:return[4,h.sent().json()];case 4:return o=h.sent(),[3,6];case 5:throw c=h.sent(),v.create("token-subscribe-failed",{errorInfo:c});case 6:if(o.error)throw l=o.error.message,v.create("token-subscribe-failed",{errorInfo:l});if(!o.token)throw v.create("token-subscribe-no-token");return[2,o.token]}}))}))}function B(e,t){return Object(h.__awaiter)(this,void 0,void 0,(function(){var n,body,r,o,c,l;return Object(h.__generator)(this,(function(h){switch(h.label){case 0:return[4,K(e)];case 1:n=h.sent(),body=H(t.subscriptionOptions),r={method:"PATCH",headers:n,body:JSON.stringify(body)},h.label=2;case 2:return h.trys.push([2,5,,6]),[4,fetch(z(e.appConfig)+"/"+t.token,r)];case 3:return[4,h.sent().json()];case 4:return o=h.sent(),[3,6];case 5:throw c=h.sent(),v.create("token-update-failed",{errorInfo:c});case 6:if(o.error)throw l=o.error.message,v.create("token-update-failed",{errorInfo:l});if(!o.token)throw v.create("token-update-no-token");return[2,o.token]}}))}))}function W(e,t){return Object(h.__awaiter)(this,void 0,void 0,(function(){var n,r,o,c,l;return Object(h.__generator)(this,(function(h){switch(h.label){case 0:return[4,K(e)];case 1:n=h.sent(),r={method:"DELETE",headers:n},h.label=2;case 2:return h.trys.push([2,5,,6]),[4,fetch(z(e.appConfig)+"/"+t,r)];case 3:return[4,h.sent().json()];case 4:if((o=h.sent()).error)throw c=o.error.message,v.create("token-unsubscribe-failed",{errorInfo:c});return[3,6];case 5:throw l=h.sent(),v.create("token-unsubscribe-failed",{errorInfo:l});case 6:return[2]}}))}))}function z(e){var t=e.projectId;return y+"/projects/"+t+"/registrations"}function K(e){var t=e.appConfig,n=e.installations;return Object(h.__awaiter)(this,void 0,void 0,(function(){var e;return Object(h.__generator)(this,(function(r){switch(r.label){case 0:return[4,n.getToken()];case 1:return e=r.sent(),[2,new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t.apiKey,"x-goog-firebase-installations-auth":"FIS "+e})]}}))}))}function H(e){var t=e.p256dh,n=e.auth,r=e.endpoint,o=e.vapidKey,body={web:{endpoint:r,auth:n,p256dh:t}};return o!==m&&(body.web.applicationPubKey=o),body}function V(e,t,n){return Object(h.__awaiter)(this,void 0,void 0,(function(){var r,o,c,l;return Object(h.__generator)(this,(function(h){switch(h.label){case 0:if("granted"!==Notification.permission)throw v.create("permission-blocked");return[4,Y(t,n)];case 1:return r=h.sent(),[4,M(e)];case 2:return o=h.sent(),c={vapidKey:n,swScope:t.scope,endpoint:r.endpoint,auth:C(r.getKey("auth")),p256dh:C(r.getKey("p256dh"))},o?[3,3]:[2,$(e,c)];case 3:if(d=o.subscriptionOptions,_=(f=c).vapidKey===d.vapidKey,m=f.endpoint===d.endpoint,y=f.auth===d.auth,w=f.p256dh===d.p256dh,_&&m&&y&&w)return[3,8];h.label=4;case 4:return h.trys.push([4,6,,7]),[4,W(e,o.token)];case 5:return h.sent(),[3,7];case 6:return l=h.sent(),console.warn(l),[3,7];case 7:return[2,$(e,c)];case 8:return Date.now()>=o.createTime+6048e5?[2,Q({token:o.token,createTime:Date.now(),subscriptionOptions:c},e,t)]:[2,o.token];case 9:return[2]}var d,f,_,m,y,w}))}))}function G(e,t){return Object(h.__awaiter)(this,void 0,void 0,(function(){var n,r;return Object(h.__generator)(this,(function(o){switch(o.label){case 0:return[4,M(e)];case 1:return(n=o.sent())?[4,W(e,n.token)]:[3,4];case 2:return o.sent(),[4,F(e)];case 3:o.sent(),o.label=4;case 4:return[4,t.pushManager.getSubscription()];case 5:return(r=o.sent())?[2,r.unsubscribe()]:[2,!0]}}))}))}function Q(e,t,n){return Object(h.__awaiter)(this,void 0,void 0,(function(){var r,o,c;return Object(h.__generator)(this,(function(l){switch(l.label){case 0:return l.trys.push([0,3,,5]),[4,B(t,e)];case 1:return r=l.sent(),o=Object(h.__assign)(Object(h.__assign)({},e),{token:r,createTime:Date.now()}),[4,D(t,o)];case 2:return l.sent(),[2,r];case 3:return c=l.sent(),[4,G(t,n)];case 4:throw l.sent(),c;case 5:return[2]}}))}))}function $(e,t){return Object(h.__awaiter)(this,void 0,void 0,(function(){var n,r;return Object(h.__generator)(this,(function(o){switch(o.label){case 0:return[4,U(e,t)];case 1:return n=o.sent(),r={token:n,createTime:Date.now(),subscriptionOptions:t},[4,D(e,r)];case 2:return o.sent(),[2,r.token]}}))}))}function Y(e,t){return Object(h.__awaiter)(this,void 0,void 0,(function(){var n;return Object(h.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.pushManager.getSubscription()];case 1:return(n=r.sent())?[2,n]:[2,e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:O(t)})]}}))}))}function J(data){return"object"==typeof data&&!!data&&k in data}function X(e){return new Promise((function(t){setTimeout(t,e)}))}var Z=function(){function e(e){var t=this;this.firebaseDependencies=e,this.isOnBackgroundMessageUsed=null,this.vapidKey=null,this.bgMessageHandler=null,self.addEventListener("push",(function(e){e.waitUntil(t.onPush(e))})),self.addEventListener("pushsubscriptionchange",(function(e){e.waitUntil(t.onSubChange(e))})),self.addEventListener("notificationclick",(function(e){e.waitUntil(t.onNotificationClick(e))}))}return Object.defineProperty(e.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),e.prototype.setBackgroundMessageHandler=function(e){if(this.isOnBackgroundMessageUsed=!1,!e||"function"!=typeof e)throw v.create("invalid-bg-handler");this.bgMessageHandler=e},e.prototype.onBackgroundMessage=function(e){var t=this;return this.isOnBackgroundMessageUsed=!0,this.bgMessageHandler=e,function(){t.bgMessageHandler=null}},e.prototype.getToken=function(){var e,t;return Object(h.__awaiter)(this,void 0,void 0,(function(){var n;return Object(h.__generator)(this,(function(r){switch(r.label){case 0:return this.vapidKey?[3,2]:[4,M(this.firebaseDependencies)];case 1:n=r.sent(),this.vapidKey=null!==(t=null===(e=null==n?void 0:n.subscriptionOptions)||void 0===e?void 0:e.vapidKey)&&void 0!==t?t:m,r.label=2;case 2:return[2,V(this.firebaseDependencies,self.registration,this.vapidKey)]}}))}))},e.prototype.deleteToken=function(){return G(this.firebaseDependencies,self.registration)},e.prototype.requestPermission=function(){throw v.create("only-available-in-window")},e.prototype.usePublicVapidKey=function(e){if(null!==this.vapidKey)throw v.create("use-vapid-key-after-get-token");if("string"!=typeof e||0===e.length)throw v.create("invalid-vapid-key");this.vapidKey=e},e.prototype.useServiceWorker=function(){throw v.create("only-available-in-window")},e.prototype.onMessage=function(){throw v.create("only-available-in-window")},e.prototype.onTokenRefresh=function(){throw v.create("only-available-in-window")},e.prototype.onPush=function(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o;return Object(h.__generator)(this,(function(c){switch(c.label){case 0:return t=function(e){var data=e.data;if(!data)return null;try{return data.json()}catch(e){return null}}(e),t?[4,re()]:(console.debug("FirebaseMessaging: failed to get parsed MessagePayload from the PushEvent. Skip handling the push."),[2]);case 1:return function(e){return e.some((function(e){return"visible"===e.visibilityState&&!e.url.startsWith("chrome-extension://")}))}(n=c.sent())?[2,ne(n,t)]:(r=!1,t.notification?[4,ie(ee(t))]:[3,3]);case 2:c.sent(),r=!0,c.label=3;case 3:return!0===r&&!1===this.isOnBackgroundMessageUsed?[2]:(this.bgMessageHandler&&(o=function(e){var t={from:e.from,collapseKey:e.collapse_key,messageId:e.fcm_message_id};return function(e,t){if(t.notification){e.notification={};var title=t.notification.title;title&&(e.notification.title=title);var body=t.notification.body;body&&(e.notification.body=body);var image=t.notification.image;image&&(e.notification.image=image)}}(t,e),function(e,t){t.data&&(e.data=t.data)}(t,e),function(e,t){if(t.fcmOptions){e.fcmOptions={};var link=t.fcmOptions.link;link&&(e.fcmOptions.link=link);var n=t.fcmOptions.analytics_label;n&&(e.fcmOptions.analyticsLabel=n)}}(t,e),t}(t),"function"==typeof this.bgMessageHandler?this.bgMessageHandler(o):this.bgMessageHandler.next(o)),[4,X(1e3)]);case 4:return c.sent(),[2]}}))}))},e.prototype.onSubChange=function(e){var t,n;return Object(h.__awaiter)(this,void 0,void 0,(function(){var r;return Object(h.__generator)(this,(function(o){switch(o.label){case 0:return e.newSubscription?[3,2]:[4,G(this.firebaseDependencies,self.registration)];case 1:case 5:return o.sent(),[2];case 2:return[4,M(this.firebaseDependencies)];case 3:return r=o.sent(),[4,G(this.firebaseDependencies,self.registration)];case 4:return o.sent(),[4,V(this.firebaseDependencies,self.registration,null!==(n=null===(t=null==r?void 0:r.subscriptionOptions)||void 0===t?void 0:t.vapidKey)&&void 0!==n?n:m)]}}))}))},e.prototype.onNotificationClick=function(e){var t,n;return Object(h.__awaiter)(this,void 0,void 0,(function(){var r,link,c,l,d;return Object(h.__generator)(this,(function(h){switch(h.label){case 0:return(r=null===(n=null===(t=e.notification)||void 0===t?void 0:t.data)||void 0===n?void 0:n[w])?e.action?[2]:(e.stopImmediatePropagation(),e.notification.close(),link=function(e){var t,n,r,link=null!==(n=null===(t=e.fcmOptions)||void 0===t?void 0:t.link)&&void 0!==n?n:null===(r=e.notification)||void 0===r?void 0:r.click_action;if(link)return link;return J(e.data)?self.location.origin:null}(r),link?(c=new URL(link,self.location.href),l=new URL(self.location.origin),c.host!==l.host?[2]:[4,te(c)]):[2]):[2];case 1:return(d=h.sent())?[3,4]:[4,self.clients.openWindow(link)];case 2:return d=h.sent(),[4,X(3e3)];case 3:return h.sent(),[3,6];case 4:return[4,d.focus()];case 5:d=h.sent(),h.label=6;case 6:return d?(r.messageType=o.NOTIFICATION_CLICKED,r.isFirebaseMessaging=!0,[2,d.postMessage(r)]):[2]}}))}))},e}();function ee(e){var t,n=Object(h.__assign)({},e.notification);return n.data=((t={})[w]=e,t),n}function te(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o,c,l,d;return Object(h.__generator)(this,(function(f){switch(f.label){case 0:return[4,re()];case 1:t=f.sent();try{for(n=Object(h.__values)(t),r=n.next();!r.done;r=n.next())if(o=r.value,c=new URL(o.url,self.location.href),e.host===c.host)return[2,o]}catch(e){l={error:e}}finally{try{r&&!r.done&&(d=n.return)&&d.call(n)}finally{if(l)throw l.error}}return[2,null]}}))}))}function ne(e,t){var n,r;t.isFirebaseMessaging=!0,t.messageType=o.PUSH_RECEIVED;try{for(var c=Object(h.__values)(e),l=c.next();!l.done;l=c.next()){l.value.postMessage(t)}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}function re(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function ie(e){var t,n=e.actions,r=Notification.maxActions;return n&&r&&n.length>r&&console.warn("This browser only supports "+r+" actions. The remaining actions will not be displayed."),self.registration.showNotification(null!==(t=e.title)&&void 0!==t?t:"",e)}var oe=function(){function e(e){var t=this;this.firebaseDependencies=e,this.vapidKey=null,this.onMessageCallback=null,navigator.serviceWorker.addEventListener("message",(function(e){return t.messageEventListener(e)}))}return Object.defineProperty(e.prototype,"app",{get:function(){return this.firebaseDependencies.app},enumerable:!1,configurable:!0}),e.prototype.messageEventListener=function(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(h.__generator)(this,(function(r){switch(r.label){case 0:return(t=e.data).isFirebaseMessaging?(this.onMessageCallback&&t.messageType===o.PUSH_RECEIVED&&("function"==typeof this.onMessageCallback?this.onMessageCallback(function(e){return delete e.messageType,delete e.isFirebaseMessaging,e}(Object.assign({},t))):this.onMessageCallback.next(Object.assign({},t))),J(n=t.data)&&"1"===n["google.c.a.e"]?[4,this.logEvent(t.messageType,n)]:[3,2]):[2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},e.prototype.getVapidKey=function(){return this.vapidKey},e.prototype.getSwReg=function(){return this.swRegistration},e.prototype.getToken=function(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){return Object(h.__generator)(this,(function(t){switch(t.label){case 0:return"default"!==Notification.permission?[3,2]:[4,Notification.requestPermission()];case 1:t.sent(),t.label=2;case 2:if("granted"!==Notification.permission)throw v.create("permission-blocked");return[4,this.updateVapidKey(null==e?void 0:e.vapidKey)];case 3:return t.sent(),[4,this.updateSwReg(null==e?void 0:e.serviceWorkerRegistration)];case 4:return t.sent(),[2,V(this.firebaseDependencies,this.swRegistration,this.vapidKey)]}}))}))},e.prototype.updateVapidKey=function(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){return Object(h.__generator)(this,(function(t){return e?this.vapidKey=e:this.vapidKey||(this.vapidKey=m),[2]}))}))},e.prototype.updateSwReg=function(e){return Object(h.__awaiter)(this,void 0,void 0,(function(){return Object(h.__generator)(this,(function(t){switch(t.label){case 0:return e||this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:t.sent(),t.label=2;case 2:if(!e&&this.swRegistration)return[2];if(!(e instanceof ServiceWorkerRegistration))throw v.create("invalid-sw-registration");return this.swRegistration=e,[2]}}))}))},e.prototype.registerDefaultSw=function(){return Object(h.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(h.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=this,[4,navigator.serviceWorker.register("/firebase-messaging-sw.js",{scope:"/firebase-cloud-messaging-push-scope"})];case 1:return e.swRegistration=n.sent(),this.swRegistration.update().catch((function(){})),[3,3];case 2:throw t=n.sent(),v.create("failed-service-worker-registration",{browserErrorMessage:t.message});case 3:return[2]}}))}))},e.prototype.deleteToken=function(){return Object(h.__awaiter)(this,void 0,void 0,(function(){return Object(h.__generator)(this,(function(e){switch(e.label){case 0:return this.swRegistration?[3,2]:[4,this.registerDefaultSw()];case 1:e.sent(),e.label=2;case 2:return[2,G(this.firebaseDependencies,this.swRegistration)]}}))}))},e.prototype.requestPermission=function(){return Object(h.__awaiter)(this,void 0,void 0,(function(){var e;return Object(h.__generator)(this,(function(t){switch(t.label){case 0:return"granted"===Notification.permission?[2]:[4,Notification.requestPermission()];case 1:if("granted"===(e=t.sent()))return[2];throw"denied"===e?v.create("permission-blocked"):v.create("permission-default")}}))}))},e.prototype.usePublicVapidKey=function(e){if(null!==this.vapidKey)throw v.create("use-vapid-key-after-get-token");if("string"!=typeof e||0===e.length)throw v.create("invalid-vapid-key");this.vapidKey=e},e.prototype.useServiceWorker=function(e){if(!(e instanceof ServiceWorkerRegistration))throw v.create("invalid-sw-registration");if(this.swRegistration)throw v.create("use-sw-after-get-token");this.swRegistration=e},e.prototype.onMessage=function(e){var t=this;return this.onMessageCallback=e,function(){t.onMessageCallback=null}},e.prototype.setBackgroundMessageHandler=function(){throw v.create("only-available-in-sw")},e.prototype.onBackgroundMessage=function(){throw v.create("only-available-in-sw")},e.prototype.onTokenRefresh=function(){return function(){}},e.prototype.logEvent=function(e,data){return Object(h.__awaiter)(this,void 0,void 0,(function(){var t;return Object(h.__generator)(this,(function(n){switch(n.label){case 0:return t=function(e){switch(e){case o.NOTIFICATION_CLICKED:return"notification_open";case o.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}(e),[4,this.firebaseDependencies.analyticsProvider.get()];case 1:return n.sent().logEvent(t,{message_id:data[k],message_name:data["google.c.a.c_l"],message_time:data["google.c.a.ts"],message_device_time:Math.floor(Date.now()/1e3)}),[2]}}))}))},e}();function ae(e){return v.create("missing-app-config-values",{valueName:e})}var se={isSupported:ce};function ce(){return self&&"ServiceWorkerGlobalScope"in self?"indexedDB"in self&&null!==indexedDB&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey"):"indexedDB"in window&&null!==indexedDB&&navigator.cookieEnabled&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}f.default.INTERNAL.registerComponent(new c.Component("messaging",(function(e){var t=e.getProvider("app").getImmediate(),n=function(e){var t,n;if(!e||!e.options)throw ae("App Configuration Object");if(!e.name)throw ae("App Name");var r=e.options;try{for(var o=Object(h.__values)(["projectId","apiKey","appId","messagingSenderId"]),c=o.next();!c.done;c=o.next()){var l=c.value;if(!r[l])throw ae(l)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return{appName:e.name,projectId:r.projectId,apiKey:r.apiKey,appId:r.appId,senderId:r.messagingSenderId}}(t),r={app:t,appConfig:n,installations:e.getProvider("installations").getImmediate(),analyticsProvider:e.getProvider("analytics-internal")};if(!ce())throw v.create("unsupported-browser");return self&&"ServiceWorkerGlobalScope"in self?new Z(r):new oe(r)}),"PUBLIC").setServiceProps(se))},842:function(e,t,n){"use strict";var r=n(770),o=n(776),c=n(780),l=n(781),h="firebasestorage.googleapis.com",d="storageBucket",f=function(e){function t(code,n){var r=e.call(this,_(code),"Firebase Storage: "+n+" ("+_(code)+")")||this;return r.customData={serverResponse:null},r._baseMessage=r.message,Object.setPrototypeOf(r,t.prototype),r}return Object(o.__extends)(t,e),t.prototype._codeEquals=function(code){return _(code)===this.code},Object.defineProperty(t.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=this._baseMessage+"\n"+this.customData.serverResponse:this.message=this._baseMessage},enumerable:!1,configurable:!0}),t}(c.FirebaseError);function _(code){return"storage/"+code}function v(){return new f("unknown","An unknown error occurred, please check the error payload for server response.")}function m(){return new f("canceled","User canceled the upload/download.")}function y(){return new f("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function w(e){return new f("invalid-argument",e)}function k(){return new f("app-deleted","The Firebase app was deleted.")}function C(e){return new f("invalid-root-operation","The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function O(e,t){return new f("invalid-format","String does not match format '"+e+"': "+t)}function T(e){throw new f("internal-error","Internal error: "+e)}var I={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},E=function(data,e){this.data=data,this.contentType=e||null};function S(e,t){switch(e){case I.RAW:return new E(x(t));case I.BASE64:case I.BASE64URL:return new E(P(e,t));case I.DATA_URL:return new E((n=new j(t)).base64?P(I.BASE64,n.rest):function(e){var t;try{t=decodeURIComponent(e)}catch(e){throw O(I.DATA_URL,"Malformed data URL.")}return x(t)}(n.rest),function(e){var t=new j(e);return t.contentType}(t))}var n;throw v()}function x(e){for(var b=[],i=0;i<e.length;i++){var t=e.charCodeAt(i);if(t<=127)b.push(t);else if(t<=2047)b.push(192|t>>6,128|63&t);else if(55296==(64512&t))if(i<e.length-1&&56320==(64512&e.charCodeAt(i+1)))t=65536|(1023&t)<<10|1023&e.charCodeAt(++i),b.push(240|t>>18,128|t>>12&63,128|t>>6&63,128|63&t);else b.push(239,191,189);else 56320==(64512&t)?b.push(239,191,189):b.push(224|t>>12,128|t>>6&63,128|63&t)}return new Uint8Array(b)}function P(e,t){switch(e){case I.BASE64:var n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw O(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case I.BASE64URL:var o=-1!==t.indexOf("+"),c=-1!==t.indexOf("/");if(o||c)throw O(e,"Invalid character '"+(o?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/")}var l;try{l=atob(t)}catch(t){throw O(e,"Invalid character found")}for(var h=new Uint8Array(l.length),i=0;i<l.length;i++)h[i]=l.charCodeAt(i);return h}var j=function(e){this.base64=!1,this.contentType=null;var t=e.match(/^data:([^,]+)?,/);if(null===t)throw O(I.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n=t[1]||null;null!=n&&(this.base64=(s=n,r=";base64",s.length>=r.length&&s.substring(s.length-r.length)===r),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1);var s,r};var R,N={STATE_CHANGED:"state_changed"},A={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function M(e){switch(e){case"running":case"pausing":case"canceling":return A.RUNNING;case"paused":return A.PAUSED;case"success":return A.SUCCESS;case"canceled":return A.CANCELED;default:return A.ERROR}}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(R||(R={}));var D=function(){function e(){var e=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=R.NO_ERROR,this.sendPromise_=new Promise((function(t){e.xhr_.addEventListener("abort",(function(){e.errorCode_=R.ABORT,t()})),e.xhr_.addEventListener("error",(function(){e.errorCode_=R.NETWORK_ERROR,t()})),e.xhr_.addEventListener("load",(function(){t()}))}))}return e.prototype.send=function(e,t,body,n){if(this.sent_)throw T("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==n)for(var r in n)n.hasOwnProperty(r)&&this.xhr_.setRequestHeader(r,n[r].toString());return void 0!==body?this.xhr_.send(body):this.xhr_.send(),this.sendPromise_},e.prototype.getErrorCode=function(){if(!this.sent_)throw T("cannot .getErrorCode() before sending");return this.errorCode_},e.prototype.getStatus=function(){if(!this.sent_)throw T("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}},e.prototype.getResponseText=function(){if(!this.sent_)throw T("cannot .getResponseText() before sending");return this.xhr_.responseText},e.prototype.abort=function(){this.xhr_.abort()},e.prototype.getResponseHeader=function(header){return this.xhr_.getResponseHeader(header)},e.prototype.addUploadProgressListener=function(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)},e.prototype.removeUploadProgressListener=function(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)},e}();var F=function(){function e(){}return e.prototype.createConnection=function(){return new D},e}(),L=function(){function e(e,path){this.bucket=e,this.path_=path}return Object.defineProperty(e.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),e.prototype.fullServerUrl=function(){var e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)},e.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},e.makeFromBucketSpec=function(t,n){var r;try{r=e.makeFromUrl(t,n)}catch(n){return new e(t,"")}if(""===r.path)return r;throw new f("invalid-default-bucket","Invalid default bucket '"+t+"'.")},e.makeFromUrl=function(t,n){var r=null,o="([A-Za-z0-9.\\-_]+)";var c=new RegExp("^gs://"+o+"(/(.*))?$","i");function l(e){e.path_=decodeURIComponent(e.path)}for(var d=n.replace(/[.]/g,"\\."),_=[{regex:c,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+d+"/v[A-Za-z0-9_]+/b/"+o+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:l},{regex:new RegExp("^https?://"+(n===h?"(?:storage.googleapis.com|storage.cloud.google.com)":n)+"/"+o+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:l}],i=0;i<_.length;i++){var v=_[i],m=v.regex.exec(t);if(m){var y=m[v.indices.bucket],w=m[v.indices.path];w||(w=""),r=new e(y,w),v.postModify(r);break}}if(null==r)throw function(e){return new f("invalid-url","Invalid URL '"+e+"'.")}(t);return r},e}(),U=function(){function e(e){this.promise_=Promise.reject(e)}return e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){},e}();function B(p){return"string"==typeof p||p instanceof String}function W(p){return z()&&p instanceof Blob}function z(){return"undefined"!=typeof Blob}function K(e,t,n,r){if(r<t)throw w("Invalid value for '"+e+"'. Expected "+t+" or greater.");if(r>n)throw w("Invalid value for '"+e+"'. Expected "+n+" or less.")}function H(e,t){var n=t.match(/^(\w+):\/\/.+/),r=t;return null==(null==n?void 0:n[1])&&(r="https://"+t),r+"/v0"+e}function V(e){var t=encodeURIComponent,n="?";for(var r in e){if(e.hasOwnProperty(r))n=n+(t(r)+"="+t(e[r]))+"&"}return n=n.slice(0,-1)}var G=function(){function e(e,t,n,body,r,o,c,l,h,d,f){var _=this;this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=e,this.method_=t,this.headers_=n,this.body_=body,this.successCodes_=r.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=c,this.errorCallback_=l,this.progressCallback_=d,this.timeout_=h,this.pool_=f,this.promise_=new Promise((function(e,t){_.resolve_=e,_.reject_=t,_.start_()}))}return e.prototype.start_=function(){var e=this;function t(t,n){var r,o=e.resolve_,c=e.reject_,l=n.connection;if(n.wasSuccessCode)try{var h=e.callback_(l,l.getResponseText());void 0!==h?o(h):o()}catch(e){c(e)}else null!==l?((r=v()).serverResponse=l.getResponseText(),e.errorCallback_?c(e.errorCallback_(l,r)):c(r)):n.canceled?c(r=e.appDelete_?k():m()):c(r=new f("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}this.canceled_?t(0,new Q(!1,null,!0)):this.backoffId_=function(e,t,n){var r=1,c=null,l=!1,h=0;function d(){return 2===h}var f=!1;function _(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];f||(f=!0,t.apply(null,e))}function v(t){c=setTimeout((function(){c=null,e(m,d())}),t)}function m(e){for(var t,n=[],c=1;c<arguments.length;c++)n[c-1]=arguments[c];f||(e||d()||l?_.call.apply(_,Object(o.__spreadArray)([null,e],n)):(r<64&&(r*=2),1===h?(h=2,t=0):t=1e3*(r+Math.random()),v(t)))}var y=!1;function w(e){y||(y=!0,f||(null!==c?(e||(h=2),clearTimeout(c),v(0)):e||(h=1)))}return v(0),setTimeout((function(){l=!0,w(!0)}),n),w}((function(t,n){if(n)t(!1,new Q(!1,null,!0));else{var r=e.pool_.createConnection();e.pendingConnection_=r,null!==e.progressCallback_&&r.addUploadProgressListener(o),r.send(e.url_,e.method_,e.body_,e.headers_).then((function(){null!==e.progressCallback_&&r.removeUploadProgressListener(o),e.pendingConnection_=null;var n=r.getErrorCode()===R.NO_ERROR,c=r.getStatus();if(n&&!e.isRetryStatusCode_(c)){var l=-1!==e.successCodes_.indexOf(c);t(!0,new Q(l,r))}else{var h=r.getErrorCode()===R.ABORT;t(!1,new Q(!1,null,h))}}))}function o(t){var n=t.loaded,r=t.lengthComputable?t.total:-1;null!==e.progressCallback_&&e.progressCallback_(n,r)}}),t,this.timeout_)},e.prototype.getPromise=function(){return this.promise_},e.prototype.cancel=function(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()},e.prototype.isRetryStatusCode_=function(e){var t=e>=500&&e<600,n=-1!==[408,429].indexOf(e),r=-1!==this.additionalRetryCodes_.indexOf(e);return t||n||r},e}(),Q=function(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n};function $(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Y(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=$();if(void 0!==n){for(var r=new n,i=0;i<e.length;i++)r.append(e[i]);return r.getBlob()}if(z())return new Blob(e);throw new f("unsupported-environment","This browser doesn't seem to support creating Blobs")}var J=function(){function e(data,e){var t=0,n="";W(data)?(this.data_=data,t=data.size,n=data.type):data instanceof ArrayBuffer?(e?this.data_=new Uint8Array(data):(this.data_=new Uint8Array(data.byteLength),this.data_.set(new Uint8Array(data))),t=this.data_.length):data instanceof Uint8Array&&(e?this.data_=data:(this.data_=new Uint8Array(data.length),this.data_.set(data)),t=data.length),this.size_=t,this.type_=n}return e.prototype.size=function(){return this.size_},e.prototype.type=function(){return this.type_},e.prototype.slice=function(t,n){if(W(this.data_)){var r=function(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.mozSlice?e.mozSlice(t,n):e.slice?e.slice(t,n):null}(this.data_,t,n);return null===r?null:new e(r)}return new e(new Uint8Array(this.data_.buffer,t,n-t),!0)},e.getBlob=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(z()){var r=t.map((function(t){return t instanceof e?t.data_:t}));return new e(Y.apply(null,r))}var o=t.map((function(e){return B(e)?S(I.RAW,e).data:e.data_})),c=0;o.forEach((function(e){c+=e.byteLength}));var l=new Uint8Array(c),h=0;return o.forEach((function(e){for(var i=0;i<e.length;i++)l[h++]=e[i]})),new e(l,!0)},e.prototype.uploadData=function(){return this.data_},e}();function X(s){var e,p;try{e=JSON.parse(s)}catch(e){return null}return"object"!=typeof(p=e)||Array.isArray(p)?null:e}function Z(path){var e=path.lastIndexOf("/",path.length-2);return-1===e?path:path.slice(e+1)}function ee(e,t){return t}var te=function(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||ee},ne=null;function re(){if(ne)return ne;var e=[];e.push(new te("bucket")),e.push(new te("generation")),e.push(new te("metageneration")),e.push(new te("name","fullPath",!0));var t=new te("name");t.xform=function(e,t){return function(e){return!B(e)||e.length<2?e:Z(e)}(t)},e.push(t);var n=new te("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new te("timeCreated")),e.push(new te("updated")),e.push(new te("md5Hash",null,!0)),e.push(new te("cacheControl",null,!0)),e.push(new te("contentDisposition",null,!0)),e.push(new te("contentEncoding",null,!0)),e.push(new te("contentLanguage",null,!0)),e.push(new te("contentType",null,!0)),e.push(new te("metadata","customMetadata",!0)),ne=e}function ie(e,t,n){for(var r={type:"file"},o=n.length,i=0;i<o;i++){var c=n[i];r[c.local]=c.xform(r,t[c.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){var n=e.bucket,path=e.fullPath,r=new L(n,path);return t._makeStorageReference(r)}})}(r,e),r}function oe(e,t,n){var r=X(t);return null===r?null:ie(e,r,n)}function ae(e,t){for(var n={},r=t.length,i=0;i<r;i++){var o=t[i];o.writable&&(n[o.server]=e[o.local])}return JSON.stringify(n)}var se="prefixes",ce="items";function ue(e,t,n){var r=X(n);return null===r?null:function(e,t,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n[se])for(var o=0,c=n[se];o<c.length;o++){var l=c[o].replace(/\/$/,""),h=e._makeStorageReference(new L(t,l));r.prefixes.push(h)}if(n[ce])for(var d=0,f=n[ce];d<f.length;d++){var _=f[d];h=e._makeStorageReference(new L(t,_.name)),r.items.push(h)}return r}(e,t,r)}var le=function(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]};function he(e){if(!e)throw v()}function de(e,t){return function(n,text){var r=oe(e,text,t);return he(null!==r),r}}function pe(e,t){return function(n,text){var r=oe(e,text,t);return he(null!==r),function(e,t,n){var r=X(t);if(null===r)return null;if(!B(r.downloadTokens))return null;var o=r.downloadTokens;if(0===o.length)return null;var c=encodeURIComponent;return o.split(",").map((function(t){var r=e.bucket,path=e.fullPath;return H("/b/"+c(r)+"/o/"+c(path),n)+V({alt:"media",token:t})}))[0]}(r,text,e.host)}}function fe(e){return function(t,n){var r,path,o;return 401===t.getStatus()?r=t.getResponseText().includes("Firebase App Check token is invalid")?new f("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new f("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(o=e.bucket,r=new f("quota-exceeded","Quota for bucket '"+o+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(path=e.path,r=new f("unauthorized","User does not have permission to access '"+path+"'.")):r=n,r.serverResponse=n.serverResponse,r}}function _e(e){var t=fe(e);return function(n,r){var path,o=t(n,r);return 404===n.getStatus()&&(path=e.path,o=new f("object-not-found","Object '"+path+"' does not exist.")),o.serverResponse=r.serverResponse,o}}function ge(e,t,n){var r=H(t.fullServerUrl(),e.host),o=e.maxOperationRetryTime,c=new le(r,"GET",de(e,n),o);return c.errorHandler=_e(t),c}function ve(e,t,n,r,o){var c={};t.isRoot?c.prefix="":c.prefix=t.path+"/",n&&n.length>0&&(c.delimiter=n),r&&(c.pageToken=r),o&&(c.maxResults=o);var l=H(t.bucketOnlyServerUrl(),e.host),h=e.maxOperationRetryTime,d=new le(l,"GET",function(e,t){return function(n,text){var r=ue(e,t,text);return he(null!==r),r}}(e,t.bucket),h);return d.urlParams=c,d.errorHandler=fe(t),d}function me(e,t,n){var r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),r}var ye=function(e,t,n,r){this.current=e,this.total=t,this.finalized=!!n,this.metadata=r||null};function be(e,t){var n=null;try{n=e.getResponseHeader("X-Goog-Upload-Status")}catch(e){he(!1)}return he(!!n&&-1!==(t||["active"]).indexOf(n)),n}var we=262144;function ke(e,t,n,r,o,c,l,h){var d=new ye(0,0);if(l?(d.current=l.current,d.total=l.total):(d.current=0,d.total=r.size()),r.size()!==d.total)throw new f("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var _=d.total-d.current,v=_;o>0&&(v=Math.min(v,o));var m=d.current,w=m+v,k={"X-Goog-Upload-Command":v===_?"upload, finalize":"upload","X-Goog-Upload-Offset":""+d.current},body=r.slice(m,w);if(null===body)throw y();var C=t.maxUploadRetryTime,O=new le(n,"POST",(function(e,text){var n,o=be(e,["active","final"]),l=d.current+v,h=r.size();return n="final"===o?de(t,c)(e,text):null,new ye(l,h,"final"===o,n)}),C);return O.headers=k,O.body=body.uploadData(),O.progressCallback=h||null,O.errorHandler=fe(e),O}var Ce=function(e,t,n){if("function"==typeof e||null!=t||null!=n)this.next=e,this.error=t,this.complete=n;else{var r=e;this.next=r.next,this.error=r.error,this.complete=r.complete}};function Oe(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];Promise.resolve().then((function(){return e.apply(void 0,t)}))}}var Te=function(){function e(e,t,n){var r=this;void 0===n&&(n=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=n,this._mappings=re(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(e){r._request=void 0,r._chunkMultiplier=1,e._codeEquals("canceled")?(r._needToFetchStatus=!0,r.completeTransitions_()):(r._error=e,r._transition("error"))},this._metadataErrorHandler=function(e){r._request=void 0,e._codeEquals("canceled")?r.completeTransitions_():(r._error=e,r._transition("error"))},this._promise=new Promise((function(e,t){r._resolve=e,r._reject=t,r._start()})),this._promise.then(null,(function(){}))}return e.prototype._makeProgressCallback=function(){var e=this,t=this._transferred;return function(n){return e._updateProgress(t+n)}},e.prototype._shouldDoResumable=function(e){return e.size()>262144},e.prototype._start=function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},e.prototype._resolveToken=function(e){var t=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((function(n){var r=n[0],o=n[1];switch(t._state){case"running":e(r,o);break;case"canceling":t._transition("canceled");break;case"pausing":t._transition("paused")}}))},e.prototype._createResumable=function(){var e=this;this._resolveToken((function(t,n){var r=function(e,t,n,r,o){var c=t.bucketOnlyServerUrl(),l=me(t,r,o),h={name:l.fullPath},d=H(c,e.host),f={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+r.size(),"X-Goog-Upload-Header-Content-Type":l.contentType,"Content-Type":"application/json; charset=utf-8"},body=ae(l,n),_=e.maxUploadRetryTime,v=new le(d,"POST",(function(e){var t;be(e);try{t=e.getResponseHeader("X-Goog-Upload-URL")}catch(e){he(!1)}return he(B(t)),t}),_);return v.urlParams=h,v.headers=f,v.body=body,v.errorHandler=fe(t),v}(e._ref.storage,e._ref._location,e._mappings,e._blob,e._metadata),o=e._ref.storage._makeRequest(r,t,n);e._request=o,o.getPromise().then((function(t){e._request=void 0,e._uploadUrl=t,e._needToFetchStatus=!1,e.completeTransitions_()}),e._errorHandler)}))},e.prototype._fetchStatus=function(){var e=this,t=this._uploadUrl;this._resolveToken((function(n,r){var o=function(e,t,n,r){var o=e.maxUploadRetryTime,c=new le(n,"POST",(function(e){var t=be(e,["active","final"]),n=null;try{n=e.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){he(!1)}n||he(!1);var o=Number(n);return he(!isNaN(o)),new ye(o,r.size(),"final"===t)}),o);return c.headers={"X-Goog-Upload-Command":"query"},c.errorHandler=fe(t),c}(e._ref.storage,e._ref._location,t,e._blob),c=e._ref.storage._makeRequest(o,n,r);e._request=c,c.getPromise().then((function(t){e._request=void 0,e._updateProgress(t.current),e._needToFetchStatus=!1,t.finalized&&(e._needToFetchMetadata=!0),e.completeTransitions_()}),e._errorHandler)}))},e.prototype._continueUpload=function(){var e=this,t=we*this._chunkMultiplier,n=new ye(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((function(o,c){var l;try{l=ke(e._ref._location,e._ref.storage,r,e._blob,t,e._mappings,n,e._makeProgressCallback())}catch(t){return e._error=t,void e._transition("error")}var h=e._ref.storage._makeRequest(l,o,c);e._request=h,h.getPromise().then((function(t){e._increaseMultiplier(),e._request=void 0,e._updateProgress(t.current),t.finalized?(e._metadata=t.metadata,e._transition("success")):e.completeTransitions_()}),e._errorHandler)}))},e.prototype._increaseMultiplier=function(){we*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},e.prototype._fetchMetadata=function(){var e=this;this._resolveToken((function(t,n){var r=ge(e._ref.storage,e._ref._location,e._mappings),o=e._ref.storage._makeRequest(r,t,n);e._request=o,o.getPromise().then((function(t){e._request=void 0,e._metadata=t,e._transition("success")}),e._metadataErrorHandler)}))},e.prototype._oneShotUpload=function(){var e=this;this._resolveToken((function(t,n){var r=function(e,t,n,r,o){var c=t.bucketOnlyServerUrl(),l={"X-Goog-Upload-Protocol":"multipart"},h=function(){for(var e="",i=0;i<2;i++)e+=Math.random().toString().slice(2);return e}();l["Content-Type"]="multipart/related; boundary="+h;var d=me(t,r,o),f="--"+h+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+ae(d,n)+"\r\n--"+h+"\r\nContent-Type: "+d.contentType+"\r\n\r\n",_="\r\n--"+h+"--",body=J.getBlob(f,r,_);if(null===body)throw y();var v={name:d.fullPath},m=H(c,e.host),w=e.maxUploadRetryTime,k=new le(m,"POST",de(e,n),w);return k.urlParams=v,k.headers=l,k.body=body.uploadData(),k.errorHandler=fe(t),k}(e._ref.storage,e._ref._location,e._mappings,e._blob,e._metadata),o=e._ref.storage._makeRequest(r,t,n);e._request=o,o.getPromise().then((function(t){e._request=void 0,e._metadata=t,e._updateProgress(e._blob.size()),e._transition("success")}),e._errorHandler)}))},e.prototype._updateProgress=function(e){var t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()},e.prototype._transition=function(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,void 0!==this._request&&this._request.cancel();break;case"running":var t="paused"===this._state;this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=e,this._notifyObservers();break;case"canceled":this._error=m(),this._state=e,this._notifyObservers()}},e.prototype.completeTransitions_=function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}},Object.defineProperty(e.prototype,"snapshot",{get:function(){var e=M(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),e.prototype.on=function(e,t,n,r){var o=this,c=new Ce(t,n,r);return this._addObserver(c),function(){o._removeObserver(c)}},e.prototype.then=function(e,t){return this._promise.then(e,t)},e.prototype.catch=function(e){return this.then(null,e)},e.prototype._addObserver=function(e){this._observers.push(e),this._notifyObserver(e)},e.prototype._removeObserver=function(e){var i=this._observers.indexOf(e);-1!==i&&this._observers.splice(i,1)},e.prototype._notifyObservers=function(){var e=this;this._finishPromise(),this._observers.slice().forEach((function(t){e._notifyObserver(t)}))},e.prototype._finishPromise=function(){if(void 0!==this._resolve){var e=!0;switch(M(this._state)){case A.SUCCESS:Oe(this._resolve.bind(null,this.snapshot))();break;case A.CANCELED:case A.ERROR:Oe(this._reject.bind(null,this._error))();break;default:e=!1}e&&(this._resolve=void 0,this._reject=void 0)}},e.prototype._notifyObserver=function(e){switch(M(this._state)){case A.RUNNING:case A.PAUSED:e.next&&Oe(e.next.bind(e,this.snapshot))();break;case A.SUCCESS:e.complete&&Oe(e.complete.bind(e))();break;default:e.error&&Oe(e.error.bind(e,this._error))()}},e.prototype.resume=function(){var e="paused"===this._state||"pausing"===this._state;return e&&this._transition("running"),e},e.prototype.pause=function(){var e="running"===this._state;return e&&this._transition("pausing"),e},e.prototype.cancel=function(){var e="running"===this._state||"pausing"===this._state;return e&&this._transition("canceling"),e},e}(),Ie=function(){function e(e,t){this._service=e,this._location=t instanceof L?t:L.makeFromUrl(t,e.host)}return e.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},e.prototype._newRef=function(t,n){return new e(t,n)},Object.defineProperty(e.prototype,"root",{get:function(){var e=new L(this._location.bucket,"");return this._newRef(this._service,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return Z(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=function(path){if(0===path.length)return null;var e=path.lastIndexOf("/");return-1===e?"":path.slice(0,e)}(this._location.path);if(null===t)return null;var n=new L(this._location.bucket,t);return new e(this._service,n)},enumerable:!1,configurable:!0}),e.prototype._throwIfRoot=function(e){if(""===this._location.path)throw C(e)},e}();function Ee(e){var t={prefixes:[],items:[]};return Se(e,t).then((function(){return t}))}function Se(e,t,n){return Object(o.__awaiter)(this,void 0,void 0,(function(){var r,c,l;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,xe(e,{pageToken:n})];case 1:return r=o.sent(),(c=t.prefixes).push.apply(c,r.prefixes),(l=t.items).push.apply(l,r.items),null==r.nextPageToken?[3,3]:[4,Se(e,t,r.nextPageToken)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}function xe(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n,r;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return null!=t&&"number"==typeof t.maxResults&&K("options.maxResults",1,1e3,t.maxResults),n=t||{},r=ve(e.storage,e._location,"/",n.pageToken,n.maxResults),[4,e.storage.makeRequestWithTokens(r)];case 1:return[2,o.sent().getPromise()]}}))}))}function Pe(e,t){return Object(o.__awaiter)(this,void 0,void 0,(function(){var n;return Object(o.__generator)(this,(function(r){switch(r.label){case 0:return e._throwIfRoot("updateMetadata"),n=function(e,t,n,r){var o=H(t.fullServerUrl(),e.host),body=ae(n,r),c=e.maxOperationRetryTime,l=new le(o,"PATCH",de(e,r),c);return l.headers={"Content-Type":"application/json; charset=utf-8"},l.body=body,l.errorHandler=_e(t),l}(e.storage,e._location,t,re()),[4,e.storage.makeRequestWithTokens(n)];case 1:return[2,r.sent().getPromise()]}}))}))}function je(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return e._throwIfRoot("getDownloadURL"),t=function(e,t,n){var r=H(t.fullServerUrl(),e.host),o=e.maxOperationRetryTime,c=new le(r,"GET",pe(e,n),o);return c.errorHandler=_e(t),c}(e.storage,e._location,re()),[4,e.storage.makeRequestWithTokens(t)];case 1:return[2,n.sent().getPromise().then((function(e){if(null===e)throw new f("no-download-url","The given file does not have any download URLs.");return e}))]}}))}))}function Re(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return e._throwIfRoot("deleteObject"),t=function(e,t){var n=H(t.fullServerUrl(),e.host),r=e.maxOperationRetryTime,o=new le(n,"DELETE",(function(e,t){}),r);return o.successCodes=[200,204],o.errorHandler=_e(t),o}(e.storage,e._location),[4,e.storage.makeRequestWithTokens(t)];case 1:return[2,n.sent().getPromise()]}}))}))}function Ne(e,t){var n=function(path,e){var t=e.split("/").filter((function(component){return component.length>0})).join("/");return 0===path.length?t:path+"/"+t}(e._location.path,t),r=new L(e._location.bucket,n);return new Ie(e.storage,r)}function Ae(path){return/^[A-Za-z]+:\/\//.test(path)}function Me(e,path){if(e instanceof Le){var t=e;if(null==t._bucket)throw new f("no-default-bucket","No default bucket found. Did you set the '"+d+"' property when initializing the app?");var n=new Ie(t,t._bucket);return null!=path?Me(n,path):n}return void 0!==path?Ne(e,path):e}function De(e,t){if(t&&Ae(t)){if(e instanceof Le)return new Ie(e,t);throw w("To use ref(service, url), the first argument must be a Storage instance.")}return Me(e,t)}function Fe(e,t){var n=null==t?void 0:t[d];return null==n?null:L.makeFromBucketSpec(n,e)}var Le=function(){function e(e,t,n,r,o,c){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._pool=r,this._url=o,this._firebaseVersion=c,this._bucket=null,this._host=h,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=o?L.makeFromBucketSpec(o,this._host):Fe(this._host,this.app.options)}return Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){this._host=e,null!=this._url?this._bucket=L.makeFromBucketSpec(this._url,e):this._bucket=Fe(e,this.app.options)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(time){K("time",0,Number.POSITIVE_INFINITY,time),this._maxUploadRetryTime=time},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(time){K("time",0,Number.POSITIVE_INFINITY,time),this._maxOperationRetryTime=time},enumerable:!1,configurable:!0}),e.prototype._getAuthToken=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return this._overrideAuthToken?[2,this._overrideAuthToken]:(e=this._authProvider.getImmediate({optional:!0}))?[4,e.getToken()]:[3,2];case 1:if(null!==(t=n.sent()))return[2,t.accessToken];n.label=2;case 2:return[2,null]}}))}))},e.prototype._getAppCheckToken=function(){return Object(o.__awaiter)(this,void 0,void 0,(function(){var e;return Object(o.__generator)(this,(function(t){switch(t.label){case 0:return(e=this._appCheckProvider.getImmediate({optional:!0}))?[4,e.getToken()]:[3,2];case 1:return[2,t.sent().token];case 2:return[2,null]}}))}))},e.prototype._delete=function(){return this._deleted||(this._deleted=!0,this._requests.forEach((function(e){return e.cancel()})),this._requests.clear()),Promise.resolve()},e.prototype._makeStorageReference=function(e){return new Ie(this,e)},e.prototype._makeRequest=function(e,t,n){var r=this;if(this._deleted)return new U(k());var o=function(e,t,n,r,o,c){var l=V(e.urlParams),h=e.url+l,d=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(d,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(d,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(d,c),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(d,r),new G(h,e.method,d,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,o)}(e,this._appId,t,n,this._pool,this._firebaseVersion);return this._requests.add(o),o.getPromise().then((function(){return r._requests.delete(o)}),(function(){return r._requests.delete(o)})),o},e.prototype.makeRequestWithTokens=function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(o.__generator)(this,(function(o){switch(o.label){case 0:return[4,Promise.all([this._getAuthToken(),this._getAppCheckToken()])];case 1:return t=o.sent(),n=t[0],r=t[1],[2,this._makeRequest(e,n,r)]}}))}))},e}();function Ue(e,data,t){return function(e,data,t){return e._throwIfRoot("uploadBytesResumable"),new Te(e,new J(data),t)}(e=Object(c.getModularInstance)(e),data,t)}function qe(e){return function(e){return Object(o.__awaiter)(this,void 0,void 0,(function(){var t;return Object(o.__generator)(this,(function(n){switch(n.label){case 0:return e._throwIfRoot("getMetadata"),t=ge(e.storage,e._location,re()),[4,e.storage.makeRequestWithTokens(t)];case 1:return[2,n.sent().getPromise()]}}))}))}(e=Object(c.getModularInstance)(e))}function Be(e,t){return De(e=Object(c.getModularInstance)(e),t)}function We(e,t,n,r){void 0===r&&(r={}),function(e,t,n,r){void 0===r&&(r={}),e.host="http://"+t+":"+n;var o=r.mockUserToken;o&&(e._overrideAuthToken="string"==typeof o?o:Object(c.createMockUserToken)(o,e.app.options.projectId))}(e,t,n,r)}var ze,Ke,He=function(){function e(e,t,n){this._delegate=e,this.task=t,this.ref=n}return Object.defineProperty(e.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),e}(),Ve=function(){function e(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(e.prototype,"snapshot",{get:function(){return new He(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),e.prototype.then=function(e,t){var n=this;return this._delegate.then((function(t){if(e)return e(new He(t,n,n._ref))}),t)},e.prototype.on=function(e,t,n,r){var o=this,c=void 0;return t&&(c="function"==typeof t?function(e){return t(new He(e,o,o._ref))}:{next:t.next?function(e){return t.next(new He(e,o,o._ref))}:void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,c,n||void 0,r||void 0)},e}(),Ge=function(){function e(e,t){this._delegate=e,this._service=t}return Object.defineProperty(e.prototype,"prefixes",{get:function(){var e=this;return this._delegate.prefixes.map((function(t){return new Qe(t,e._service)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){var e=this;return this._delegate.items.map((function(t){return new Qe(t,e._service)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),e}(),Qe=function(){function e(e,t){this._delegate=e,this.storage=t}return Object.defineProperty(e.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this._delegate.toString()},e.prototype.child=function(t){var n=function(e,t){return Ne(e,t)}(this._delegate,t);return new e(n,this.storage)},Object.defineProperty(e.prototype,"root",{get:function(){return new e(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return null==t?null:new e(t,this.storage)},enumerable:!1,configurable:!0}),e.prototype.put=function(data,e){return this._throwIfRoot("put"),new Ve(Ue(this._delegate,data,e),this)},e.prototype.putString=function(e,t,n){void 0===t&&(t=I.RAW),this._throwIfRoot("putString");var data=S(t,e),r=Object(o.__assign)({},n);return null==r.contentType&&null!=data.contentType&&(r.contentType=data.contentType),new Ve(new Te(this._delegate,new J(data.data,!0),r),this)},e.prototype.listAll=function(){var e=this;return function(e){return Ee(e=Object(c.getModularInstance)(e))}(this._delegate).then((function(t){return new Ge(t,e.storage)}))},e.prototype.list=function(e){var t=this;return function(e,t){return xe(e=Object(c.getModularInstance)(e),t)}(this._delegate,e||void 0).then((function(e){return new Ge(e,t.storage)}))},e.prototype.getMetadata=function(){return qe(this._delegate)},e.prototype.updateMetadata=function(e){return function(e,t){return Pe(e=Object(c.getModularInstance)(e),t)}(this._delegate,e)},e.prototype.getDownloadURL=function(){return function(e){return je(e=Object(c.getModularInstance)(e))}(this._delegate)},e.prototype.delete=function(){return this._throwIfRoot("delete"),function(e){return Re(e=Object(c.getModularInstance)(e))}(this._delegate)},e.prototype._throwIfRoot=function(e){if(""===this._delegate._location.path)throw C(e)},e}(),$e=function(){function e(e,t){this.app=e,this._delegate=t}return Object.defineProperty(e.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),e.prototype.ref=function(path){if(Ae(path))throw w("ref() expected a child path but got a URL, use refFromURL instead.");return new Qe(Be(this._delegate,path),this)},e.prototype.refFromURL=function(e){if(!Ae(e))throw w("refFromURL() expected a full URL but got a child path, use ref() instead.");try{L.makeFromUrl(e,this._delegate.host)}catch(e){throw w("refFromUrl() expected a valid full URL but got an invalid one.")}return new Qe(Be(this._delegate,e),this)},e.prototype.setMaxUploadRetryTime=function(time){this._delegate.maxUploadRetryTime=time},e.prototype.setMaxOperationRetryTime=function(time){this._delegate.maxOperationRetryTime=time},e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),We(this._delegate,e,t,n)},e}();function Ye(e,t){var n=t.instanceIdentifier,o=e.getProvider("app").getImmediate(),c=e.getProvider("auth-internal"),l=e.getProvider("app-check-internal");return new $e(o,new Le(o,c,l,new F,n,r.default.SDK_VERSION))}ze=r.default,Ke={TaskState:A,TaskEvent:N,StringFormat:I,Storage:Le,Reference:Qe},ze.INTERNAL.registerComponent(new l.Component("storage",Ye,"PUBLIC").setServiceProps(Ke).setMultipleInstances(!0)),ze.registerVersion("@firebase/storage","0.7.1")},843:function(e,t,n){"use strict";var r,o,c=n(776),l=n(770),h=(n(795),n(788)),d=n(780),f=n(781),_="firebase_id",v="origin",m=6e4,y="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",w="https://www.googletagmanager.com/gtag/js";!function(e){e.EVENT="event",e.SET="set",e.CONFIG="config"}(r||(r={})),function(e){e.ADD_SHIPPING_INFO="add_shipping_info",e.ADD_PAYMENT_INFO="add_payment_info",e.ADD_TO_CART="add_to_cart",e.ADD_TO_WISHLIST="add_to_wishlist",e.BEGIN_CHECKOUT="begin_checkout",e.CHECKOUT_PROGRESS="checkout_progress",e.EXCEPTION="exception",e.GENERATE_LEAD="generate_lead",e.LOGIN="login",e.PAGE_VIEW="page_view",e.PURCHASE="purchase",e.REFUND="refund",e.REMOVE_FROM_CART="remove_from_cart",e.SCREEN_VIEW="screen_view",e.SEARCH="search",e.SELECT_CONTENT="select_content",e.SELECT_ITEM="select_item",e.SELECT_PROMOTION="select_promotion",e.SET_CHECKOUT_OPTION="set_checkout_option",e.SHARE="share",e.SIGN_UP="sign_up",e.TIMING_COMPLETE="timing_complete",e.VIEW_CART="view_cart",e.VIEW_ITEM="view_item",e.VIEW_ITEM_LIST="view_item_list",e.VIEW_PROMOTION="view_promotion",e.VIEW_SEARCH_RESULTS="view_search_results"}(o||(o={}));var k,C=new h.Logger("@firebase/analytics");function O(e,t,n,o,l,h){return Object(c.__awaiter)(this,void 0,void 0,(function(){var d,f,_,v;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:d=o[l],c.label=1;case 1:return c.trys.push([1,7,,8]),d?[4,t[d]]:[3,3];case 2:return c.sent(),[3,6];case 3:return[4,Promise.all(n)];case 4:return f=c.sent(),(_=f.find((function(e){return e.measurementId===l})))?[4,t[_.appId]]:[3,6];case 5:c.sent(),c.label=6;case 6:return[3,8];case 7:return v=c.sent(),C.error(v),[3,8];case 8:return e(r.CONFIG,l,h),[2]}}))}))}function T(e,t,n,o,l){return Object(c.__awaiter)(this,void 0,void 0,(function(){var h,d,f,_,v,m,y,w;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return c.trys.push([0,4,,5]),h=[],l&&l.send_to?(d=l.send_to,Array.isArray(d)||(d=[d]),[4,Promise.all(n)]):[3,2];case 1:for(f=c.sent(),_=function(e){var n=f.find((function(t){return t.measurementId===e})),r=n&&t[n.appId];if(!r)return h=[],"break";h.push(r)},v=0,m=d;v<m.length&&(y=m[v],"break"!==_(y));v++);c.label=2;case 2:return 0===h.length&&(h=Object.values(t)),[4,Promise.all(h)];case 3:return c.sent(),e(r.EVENT,o,l||{}),[3,5];case 4:return w=c.sent(),C.error(w),[3,5];case 5:return[2]}}))}))}function I(e,t,n,o,l){var h=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];window[o].push(arguments)};return window[l]&&"function"==typeof window[l]&&(h=window[l]),window[l]=function(e,t,n,o){return function(l,h,d){return Object(c.__awaiter)(this,void 0,void 0,(function(){var f;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return c.trys.push([0,6,,7]),l!==r.EVENT?[3,2]:[4,T(e,t,n,h,d)];case 1:return c.sent(),[3,5];case 2:return l!==r.CONFIG?[3,4]:[4,O(e,t,n,o,h,d)];case 3:return c.sent(),[3,5];case 4:e(r.SET,h),c.label=5;case 5:return[3,7];case 6:return f=c.sent(),C.error(f),[3,7];case 7:return[2]}}))}))}}(h,e,t,n),{gtagCore:h,wrappedGtag:window[l]}}var E=((k={})["already-exists"]="A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",k["already-initialized"]="Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",k["interop-component-reg-failed"]="Firebase Analytics Interop Component failed to instantiate: {$reason}",k["invalid-analytics-context"]="Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",k["indexeddb-unavailable"]="IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",k["fetch-throttle"]="The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",k["config-fetch-failed"]="Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",k["no-api-key"]='The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',k["no-app-id"]='The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',k),S=new d.ErrorFactory("analytics","Analytics",E),x=30,P=new(function(){function e(e,t){void 0===e&&(e={}),void 0===t&&(t=1e3),this.throttleMetadata=e,this.intervalMillis=t}return e.prototype.getThrottleMetadata=function(e){return this.throttleMetadata[e]},e.prototype.setThrottleMetadata=function(e,t){this.throttleMetadata[e]=t},e.prototype.deleteThrottleMetadata=function(e){delete this.throttleMetadata[e]},e}());function j(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}function R(e){var t;return Object(c.__awaiter)(this,void 0,void 0,(function(){var n,r,o,l,h,d,f;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return n=e.appId,r=e.apiKey,o={method:"GET",headers:j(r)},l=y.replace("{app-id}",n),[4,fetch(l,o)];case 1:if(200===(h=c.sent()).status||304===h.status)return[3,6];d="",c.label=2;case 2:return c.trys.push([2,4,,5]),[4,h.json()];case 3:return f=c.sent(),(null===(t=f.error)||void 0===t?void 0:t.message)&&(d=f.error.message),[3,5];case 4:return c.sent(),[3,5];case 5:throw S.create("config-fetch-failed",{httpStatus:h.status,responseMessage:d});case 6:return[2,h.json()]}}))}))}function N(e,t,n,r){var o=t.throttleEndTimeMillis,l=t.backoffCount;return void 0===r&&(r=P),Object(c.__awaiter)(this,void 0,void 0,(function(){var t,h,f,_,v,m,y;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:t=e.appId,h=e.measurementId,c.label=1;case 1:return c.trys.push([1,3,,4]),[4,A(n,o)];case 2:return c.sent(),[3,4];case 3:if(f=c.sent(),h)return C.warn("Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID "+h+' provided in the "measurementId" field in the local Firebase config. ['+f.message+"]"),[2,{appId:t,measurementId:h}];throw f;case 4:return c.trys.push([4,6,,7]),[4,R(e)];case 5:return _=c.sent(),r.deleteThrottleMetadata(t),[2,_];case 6:if(!function(e){if(!(e instanceof d.FirebaseError&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(v=c.sent())){if(r.deleteThrottleMetadata(t),h)return C.warn("Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID "+h+' provided in the "measurementId" field in the local Firebase config. ['+v.message+"]"),[2,{appId:t,measurementId:h}];throw v}return m=503===Number(v.customData.httpStatus)?Object(d.calculateBackoffMillis)(l,r.intervalMillis,x):Object(d.calculateBackoffMillis)(l,r.intervalMillis),y={throttleEndTimeMillis:Date.now()+m,backoffCount:l+1},r.setThrottleMetadata(t,y),C.debug("Calling attemptFetch again in "+m+" millis"),[2,N(e,y,n,r)];case 7:return[2]}}))}))}function A(e,t){return new Promise((function(n,r){var o=Math.max(t-Date.now(),0),c=setTimeout(n,o);e.addEventListener((function(){clearTimeout(c),r(S.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}var M=function(){function e(){this.listeners=[]}return e.prototype.addEventListener=function(e){this.listeners.push(e)},e.prototype.abort=function(){this.listeners.forEach((function(e){return e()}))},e}();function D(e,t,n,o,l,h){return Object(c.__awaiter)(this,void 0,void 0,(function(){var f,y,k,O,T,I,E;return Object(c.__generator)(this,(function(x){switch(x.label){case 0:return f=function(e,t,n){return void 0===t&&(t=P),Object(c.__awaiter)(this,void 0,void 0,(function(){var r,o,l,h,d,f,_=this;return Object(c.__generator)(this,(function(v){if(r=e.options,o=r.appId,l=r.apiKey,h=r.measurementId,!o)throw S.create("no-app-id");if(!l){if(h)return[2,{measurementId:h,appId:o}];throw S.create("no-api-key")}return d=t.getThrottleMetadata(o)||{backoffCount:0,throttleEndTimeMillis:Date.now()},f=new M,setTimeout((function(){return Object(c.__awaiter)(_,void 0,void 0,(function(){return Object(c.__generator)(this,(function(e){return f.abort(),[2]}))}))}),void 0!==n?n:m),[2,N({appId:o,apiKey:l,measurementId:h},d,f,t)]}))}))}(e),f.then((function(t){n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&C.warn("The measurement ID in the local Firebase config ("+e.options.measurementId+") does not match the measurement ID fetched from the server ("+t.measurementId+"). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.")})).catch((function(e){return C.error(e)})),t.push(f),y=function(){return Object(c.__awaiter)(this,void 0,void 0,(function(){var e;return Object(c.__generator)(this,(function(t){switch(t.label){case 0:return Object(d.isIndexedDBAvailable)()?[3,1]:(C.warn(S.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),[2,!1]);case 1:return t.trys.push([1,3,,4]),[4,Object(d.validateIndexedDBOpenable)()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),C.warn(S.create("indexeddb-unavailable",{errorInfo:e}).message),[2,!1];case 4:return[2,!0]}}))}))}().then((function(e){return e?o.getId():void 0})),[4,Promise.all([f,y])];case 1:return k=x.sent(),O=k[0],T=k[1],function(){for(var e=window.document.getElementsByTagName("script"),t=0,n=Object.values(e);t<n.length;t++){var r=n[t];if(r.src&&r.src.includes(w))return r}return null}()||function(e,t){var script=document.createElement("script");script.src=w+"?l="+e+"&id="+t,script.async=!0,document.head.appendChild(script)}(h,O.measurementId),l("js",new Date),(E={})[v]="firebase",E.update=!0,I=E,null!=T&&(I[_]=T),l(r.CONFIG,O.measurementId,I),[2,O.measurementId]}}))}))}var F,L,U={},B=[],W={},z="dataLayer",K="gtag",H=!1;function V(e){if(H)throw S.create("already-initialized");e.dataLayerName&&(z=e.dataLayerName),e.gtagName&&(K=e.gtagName)}function G(e,t){!function(){var e=[];if(Object(d.isBrowserExtension)()&&e.push("This is a browser extension environment."),Object(d.areCookiesEnabled)()||e.push("Cookies are not available."),e.length>0){var details=e.map((function(e,t){return"("+(t+1)+") "+e})).join(" "),t=S.create("invalid-analytics-context",{errorInfo:details});C.warn(t.message)}}();var n=e.options.appId;if(!n)throw S.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw S.create("no-api-key");C.warn('The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID '+e.options.measurementId+' provided in the "measurementId" field in the local Firebase config.')}if(null!=U[n])throw S.create("already-exists",{id:n});if(!H){!function(e){var t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(z);var o=I(U,B,W,z,K),l=o.wrappedGtag,h=o.gtagCore;L=l,F=h,H=!0}U[n]=D(e,B,W,t,F,z);var f={app:e,logEvent:function(e,t,o){(function(e,t,n,o,l){return Object(c.__awaiter)(this,void 0,void 0,(function(){var h,d;return Object(c.__generator)(this,(function(f){switch(f.label){case 0:return l&&l.global?(e(r.EVENT,n,o),[2]):[3,1];case 1:return[4,t];case 2:h=f.sent(),d=Object(c.__assign)(Object(c.__assign)({},o),{send_to:h}),e(r.EVENT,n,d),f.label=3;case 3:return[2]}}))}))})(L,U[n],e,t,o).catch((function(e){return C.error(e)}))},setCurrentScreen:function(e,t){(function(e,t,n,o){return Object(c.__awaiter)(this,void 0,void 0,(function(){var l;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return o&&o.global?(e(r.SET,{screen_name:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,t];case 2:l=c.sent(),e(r.CONFIG,l,{update:!0,screen_name:n}),c.label=3;case 3:return[2]}}))}))})(L,U[n],e,t).catch((function(e){return C.error(e)}))},setUserId:function(e,t){(function(e,t,n,o){return Object(c.__awaiter)(this,void 0,void 0,(function(){var l;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return o&&o.global?(e(r.SET,{user_id:n}),[2,Promise.resolve()]):[3,1];case 1:return[4,t];case 2:l=c.sent(),e(r.CONFIG,l,{update:!0,user_id:n}),c.label=3;case 3:return[2]}}))}))})(L,U[n],e,t).catch((function(e){return C.error(e)}))},setUserProperties:function(e,t){(function(e,t,n,o){return Object(c.__awaiter)(this,void 0,void 0,(function(){var l,h,d,f,_;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:if(!o||!o.global)return[3,1];for(l={},h=0,d=Object.keys(n);h<d.length;h++)f=d[h],l["user_properties."+f]=n[f];return e(r.SET,l),[2,Promise.resolve()];case 1:return[4,t];case 2:_=c.sent(),e(r.CONFIG,_,{update:!0,user_properties:n}),c.label=3;case 3:return[2]}}))}))})(L,U[n],e,t).catch((function(e){return C.error(e)}))},setAnalyticsCollectionEnabled:function(e){(function(e,t){return Object(c.__awaiter)(this,void 0,void 0,(function(){var n;return Object(c.__generator)(this,(function(r){switch(r.label){case 0:return[4,e];case 1:return n=r.sent(),window["ga-disable-"+n]=!t,[2]}}))}))})(U[n],e).catch((function(e){return C.error(e)}))},INTERNAL:{delete:function(){return delete U[n],Promise.resolve()}}};return f}var Q,$="analytics";function Y(){return Object(c.__awaiter)(this,void 0,void 0,(function(){return Object(c.__generator)(this,(function(e){switch(e.label){case 0:if(Object(d.isBrowserExtension)())return[2,!1];if(!Object(d.areCookiesEnabled)())return[2,!1];if(!Object(d.isIndexedDBAvailable)())return[2,!1];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Object(d.validateIndexedDBOpenable)()];case 2:return[2,e.sent()];case 3:return e.sent(),[2,!1];case 4:return[2]}}))}))}(Q=l.default).INTERNAL.registerComponent(new f.Component($,(function(e){return G(e.getProvider("app").getImmediate(),e.getProvider("installations").getImmediate())}),"PUBLIC").setServiceProps({settings:V,EventName:o,isSupported:Y})),Q.INTERNAL.registerComponent(new f.Component("analytics-internal",(function(e){try{return{logEvent:e.getProvider($).getImmediate().logEvent}}catch(e){throw S.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),Q.registerVersion("@firebase/analytics","0.6.18")},844:function(e,t,n){"use strict";var r,o=n(770),c=(n(795),n(776)),l=n(780),h=n(788),d=n(781),f=function(){function e(e,t,n,r){this.client=e,this.storage=t,this.storageCache=n,this.logger=r}return e.prototype.isCachedDataFresh=function(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;var n=Date.now()-t,r=n<=e;return this.logger.debug("Config fetch cache check. Cache age millis: "+n+". Cache max age millis (minimumFetchIntervalMillis setting): "+e+". Is cache hit: "+r+"."),r},e.prototype.fetch=function(e){return Object(c.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o,l;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return[4,Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()])];case 1:return t=c.sent(),n=t[0],(r=t[1])&&this.isCachedDataFresh(e.cacheMaxAgeMillis,n)?[2,r]:(e.eTag=r&&r.eTag,[4,this.client.fetch(e)]);case 2:return o=c.sent(),l=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())],200===o.status&&l.push(this.storage.setLastSuccessfulFetchResponse(o)),[4,Promise.all(l)];case 3:return c.sent(),[2,o]}}))}))},e}(),_=((r={})["registration-window"]="Undefined window object. This SDK only supports usage in a browser environment.",r["registration-project-id"]="Undefined project identifier. Check Firebase app initialization.",r["registration-api-key"]="Undefined API key. Check Firebase app initialization.",r["registration-app-id"]="Undefined app identifier. Check Firebase app initialization.",r["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",r["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",r["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",r["storage-delete"]="Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",r["fetch-client-network"]="Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",r["fetch-timeout"]='The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',r["fetch-throttle"]='The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',r["fetch-client-parse"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",r["fetch-status"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",r),v=new l.ErrorFactory("remoteconfig","Remote Config",_);var m=function(){function e(e,t,n,r,o,c){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=n,this.projectId=r,this.apiKey=o,this.appId=c}return e.prototype.fetch=function(e){return Object(c.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o,l,h,d,f,_,m,y,w,k,C,O,T,I,E,S;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return[4,Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()])];case 1:t=c.sent(),n=t[0],r=t[1],o=window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com",l=o+"/v1/projects/"+this.projectId+"/namespaces/"+this.namespace+":fetch?key="+this.apiKey,h={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},d={sdk_version:this.sdkVersion,app_instance_id:n,app_instance_id_token:r,app_id:this.appId,language_code:(void 0===x&&(x=navigator),x.languages&&x.languages[0]||x.language)},f={method:"POST",headers:h,body:JSON.stringify(d)},_=fetch(l,f),m=new Promise((function(t,n){e.signal.addEventListener((function(){var e=new Error("The operation was aborted.");e.name="AbortError",n(e)}))})),c.label=2;case 2:return c.trys.push([2,5,,6]),[4,Promise.race([_,m])];case 3:return c.sent(),[4,_];case 4:return y=c.sent(),[3,6];case 5:throw w=c.sent(),k="fetch-client-network","AbortError"===w.name&&(k="fetch-timeout"),v.create(k,{originalErrorMessage:w.message});case 6:if(C=y.status,O=y.headers.get("ETag")||void 0,200!==y.status)return[3,11];E=void 0,c.label=7;case 7:return c.trys.push([7,9,,10]),[4,y.json()];case 8:return E=c.sent(),[3,10];case 9:throw S=c.sent(),v.create("fetch-client-parse",{originalErrorMessage:S.message});case 10:T=E.entries,I=E.state,c.label=11;case 11:if("INSTANCE_STATE_UNSPECIFIED"===I?C=500:"NO_CHANGE"===I?C=304:"NO_TEMPLATE"!==I&&"EMPTY_CONFIG"!==I||(T={}),304!==C&&200!==C)throw v.create("fetch-status",{httpStatus:C});return[2,{status:C,eTag:O,config:T}]}var x}))}))},e}(),y=function(){function e(){this.listeners=[]}return e.prototype.addEventListener=function(e){this.listeners.push(e)},e.prototype.abort=function(){this.listeners.forEach((function(e){return e()}))},e}(),w=["1","true","t","yes","y","on"],k=function(){function e(e,t){void 0===t&&(t=""),this._source=e,this._value=t}return e.prototype.asString=function(){return this._value},e.prototype.asBoolean=function(){return"static"!==this._source&&w.indexOf(this._value.toLowerCase())>=0},e.prototype.asNumber=function(){if("static"===this._source)return 0;var e=Number(this._value);return isNaN(e)&&(e=0),e},e.prototype.getSource=function(){return this._source},e}(),C=function(){function e(e,t,n,r,o){this.app=e,this._client=t,this._storageCache=n,this._storage=r,this._logger=o,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:6e4,minimumFetchIntervalMillis:432e5},this.defaultConfig={}}return e.prototype.setLogLevel=function(e){switch(e){case"debug":this._logger.logLevel=h.LogLevel.DEBUG;break;case"silent":this._logger.logLevel=h.LogLevel.SILENT;break;default:this._logger.logLevel=h.LogLevel.ERROR}},Object.defineProperty(e.prototype,"fetchTimeMillis",{get:function(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastFetchStatus",{get:function(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"},enumerable:!1,configurable:!0}),e.prototype.activate=function(){return Object(c.__awaiter)(this,void 0,void 0,(function(){var e,t,n;return Object(c.__generator)(this,(function(r){switch(r.label){case 0:return[4,Promise.all([this._storage.getLastSuccessfulFetchResponse(),this._storage.getActiveConfigEtag()])];case 1:return e=r.sent(),t=e[0],n=e[1],t&&t.config&&t.eTag&&t.eTag!==n?[4,Promise.all([this._storageCache.setActiveConfig(t.config),this._storage.setActiveConfigEtag(t.eTag)])]:[2,!1];case 2:return r.sent(),[2,!0]}}))}))},e.prototype.ensureInitialized=function(){var e=this;return this._initializePromise||(this._initializePromise=this._storageCache.loadFromStorage().then((function(){e._isInitializationComplete=!0}))),this._initializePromise},e.prototype.fetch=function(){return Object(c.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r=this;return Object(c.__generator)(this,(function(o){switch(o.label){case 0:e=new y,setTimeout((function(){return Object(c.__awaiter)(r,void 0,void 0,(function(){return Object(c.__generator)(this,(function(t){return e.abort(),[2]}))}))}),this.settings.fetchTimeoutMillis),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,this._client.fetch({cacheMaxAgeMillis:this.settings.minimumFetchIntervalMillis,signal:e})];case 2:return o.sent(),[4,this._storageCache.setLastFetchStatus("success")];case 3:return o.sent(),[3,6];case 4:return t=o.sent(),d="fetch-throttle",n=(h=t)instanceof l.FirebaseError&&-1!==h.code.indexOf(d)?"throttle":"failure",[4,this._storageCache.setLastFetchStatus(n)];case 5:throw o.sent(),t;case 6:return[2]}var h,d}))}))},e.prototype.fetchAndActivate=function(){return Object(c.__awaiter)(this,void 0,void 0,(function(){return Object(c.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.fetch()];case 1:return e.sent(),[2,this.activate()]}}))}))},e.prototype.getAll=function(){var e=this;return function(e,t){void 0===e&&(e={});void 0===t&&(t={});return Object.keys(Object(c.__assign)(Object(c.__assign)({},e),t))}(this._storageCache.getActiveConfig(),this.defaultConfig).reduce((function(t,n){return t[n]=e.getValue(n),t}),{})},e.prototype.getBoolean=function(e){return this.getValue(e).asBoolean()},e.prototype.getNumber=function(e){return this.getValue(e).asNumber()},e.prototype.getString=function(e){return this.getValue(e).asString()},e.prototype.getValue=function(e){this._isInitializationComplete||this._logger.debug('A value was requested for key "'+e+'" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.');var t=this._storageCache.getActiveConfig();return t&&void 0!==t[e]?new k("remote",t[e]):this.defaultConfig&&void 0!==this.defaultConfig[e]?new k("default",String(this.defaultConfig[e])):(this._logger.debug('Returning static value for key "'+e+'". Define a default or remote value if this is unintentional.'),new k("static"))},e}();function O(e,t){var n=e.target.error||void 0;return v.create(t,{originalErrorMessage:n&&n.message})}var T="app_namespace_store";var I=function(){function e(e,t,n,r){void 0===r&&(r=new Promise((function(e,t){var n=indexedDB.open("firebase_remote_config",1);n.onerror=function(e){t(O(e,"storage-open"))},n.onsuccess=function(t){e(t.target.result)},n.onupgradeneeded=function(e){var t=e.target.result;0===e.oldVersion&&t.createObjectStore(T,{keyPath:"compositeKey"})}}))),this.appId=e,this.appName=t,this.namespace=n,this.openDbPromise=r}return e.prototype.getLastFetchStatus=function(){return this.get("last_fetch_status")},e.prototype.setLastFetchStatus=function(e){return this.set("last_fetch_status",e)},e.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.get("last_successful_fetch_timestamp_millis")},e.prototype.setLastSuccessfulFetchTimestampMillis=function(e){return this.set("last_successful_fetch_timestamp_millis",e)},e.prototype.getLastSuccessfulFetchResponse=function(){return this.get("last_successful_fetch_response")},e.prototype.setLastSuccessfulFetchResponse=function(e){return this.set("last_successful_fetch_response",e)},e.prototype.getActiveConfig=function(){return this.get("active_config")},e.prototype.setActiveConfig=function(e){return this.set("active_config",e)},e.prototype.getActiveConfigEtag=function(){return this.get("active_config_etag")},e.prototype.setActiveConfigEtag=function(e){return this.set("active_config_etag",e)},e.prototype.getThrottleMetadata=function(){return this.get("throttle_metadata")},e.prototype.setThrottleMetadata=function(e){return this.set("throttle_metadata",e)},e.prototype.deleteThrottleMetadata=function(){return this.delete("throttle_metadata")},e.prototype.get=function(e){return Object(c.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(c.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return t=r.sent(),[2,new Promise((function(r,o){var c=t.transaction([T],"readonly").objectStore(T),l=n.createCompositeKey(e);try{var h=c.get(l);h.onerror=function(e){o(O(e,"storage-get"))},h.onsuccess=function(e){var t=e.target.result;r(t?t.value:void 0)}}catch(e){o(v.create("storage-get",{originalErrorMessage:e&&e.message}))}}))]}}))}))},e.prototype.set=function(e,t){return Object(c.__awaiter)(this,void 0,void 0,(function(){var n,r=this;return Object(c.__generator)(this,(function(o){switch(o.label){case 0:return[4,this.openDbPromise];case 1:return n=o.sent(),[2,new Promise((function(o,c){var l=n.transaction([T],"readwrite").objectStore(T),h=r.createCompositeKey(e);try{var d=l.put({compositeKey:h,value:t});d.onerror=function(e){c(O(e,"storage-set"))},d.onsuccess=function(){o()}}catch(e){c(v.create("storage-set",{originalErrorMessage:e&&e.message}))}}))]}}))}))},e.prototype.delete=function(e){return Object(c.__awaiter)(this,void 0,void 0,(function(){var t,n=this;return Object(c.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.openDbPromise];case 1:return t=r.sent(),[2,new Promise((function(r,o){var c=t.transaction([T],"readwrite").objectStore(T),l=n.createCompositeKey(e);try{var h=c.delete(l);h.onerror=function(e){o(O(e,"storage-delete"))},h.onsuccess=function(){r()}}catch(e){o(v.create("storage-delete",{originalErrorMessage:e&&e.message}))}}))]}}))}))},e.prototype.createCompositeKey=function(e){return[this.appId,this.appName,this.namespace,e].join()},e}(),E=function(){function e(e){this.storage=e}return e.prototype.getLastFetchStatus=function(){return this.lastFetchStatus},e.prototype.getLastSuccessfulFetchTimestampMillis=function(){return this.lastSuccessfulFetchTimestampMillis},e.prototype.getActiveConfig=function(){return this.activeConfig},e.prototype.loadFromStorage=function(){return Object(c.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r,o,l;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),n=this.storage.getActiveConfig(),[4,e];case 1:return(r=c.sent())&&(this.lastFetchStatus=r),[4,t];case 2:return(o=c.sent())&&(this.lastSuccessfulFetchTimestampMillis=o),[4,n];case 3:return(l=c.sent())&&(this.activeConfig=l),[2]}}))}))},e.prototype.setLastFetchStatus=function(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)},e.prototype.setLastSuccessfulFetchTimestampMillis=function(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)},e.prototype.setActiveConfig=function(e){return this.activeConfig=e,this.storage.setActiveConfig(e)},e}();function S(e,t){return new Promise((function(n,r){var o=Math.max(t-Date.now(),0),c=setTimeout(n,o);e.addEventListener((function(){clearTimeout(c),r(v.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}var x,P=function(){function e(e,t){this.client=e,this.storage=t}return e.prototype.fetch=function(e){return Object(c.__awaiter)(this,void 0,void 0,(function(){var t;return Object(c.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.storage.getThrottleMetadata()];case 1:return t=n.sent()||{backoffCount:0,throttleEndTimeMillis:Date.now()},[2,this.attemptFetch(e,t)]}}))}))},e.prototype.attemptFetch=function(e,t){var n=t.throttleEndTimeMillis,r=t.backoffCount;return Object(c.__awaiter)(this,void 0,void 0,(function(){var t,o,h;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return[4,S(e.signal,n)];case 1:c.sent(),c.label=2;case 2:return c.trys.push([2,5,,7]),[4,this.client.fetch(e)];case 3:return t=c.sent(),[4,this.storage.deleteThrottleMetadata()];case 4:return c.sent(),[2,t];case 5:if(!function(e){if(!(e instanceof l.FirebaseError&&e.customData))return!1;var t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(o=c.sent()))throw o;return h={throttleEndTimeMillis:Date.now()+Object(l.calculateBackoffMillis)(r),backoffCount:r+1},[4,this.storage.setThrottleMetadata(h)];case 6:return c.sent(),[2,this.attemptFetch(e,h)];case 7:return[2]}}))}))},e}(),j="@firebase/remote-config";(x=o.default).INTERNAL.registerComponent(new d.Component("remoteConfig",(function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),o=e.getProvider("installations").getImmediate();if("undefined"==typeof window)throw v.create("registration-window");var c=r.options,l=c.projectId,d=c.apiKey,_=c.appId;if(!l)throw v.create("registration-project-id");if(!d)throw v.create("registration-api-key");if(!_)throw v.create("registration-app-id");n=n||"firebase";var y=new I(_,r.name,n),w=new E(y),k=new h.Logger(j);k.logLevel=h.LogLevel.ERROR;var O=new m(o,x.SDK_VERSION,n,l,d,_),T=new P(O,y),S=new f(T,y,w,k),R=new C(r,S,w,y,k);return R.ensureInitialized(),R}),"PUBLIC").setMultipleInstances(!0)),x.registerVersion(j,"0.1.43")},852:function(e,t,n){"use strict";(function(e,t){var r=n(770),o=n(781),c=n(780),l=n(776),h=n(788),d="";function f(e){d=e}var _,v=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(c.stringify)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(c.jsonEval)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),m=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return Object(c.contains)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),y=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new v(t)}}catch(e){}return new m},w=y("localStorage"),k=y("sessionStorage"),C=new h.Logger("@firebase/database"),O=(_=1,function(){return _++}),T=function(e){var t=Object(c.stringToByteArray)(e),n=new c.Sha1;n.update(t);var r=n.digest();return c.base64.encodeByteArray(r)},I=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",i=0;i<e.length;i++){var r=e[i];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?n+=I.apply(null,r):n+="object"==typeof r?Object(c.stringify)(r):r,n+=" "}return n},E=null,S=!0,x=function(e,t){Object(c.assert)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(C.logLevel=h.LogLevel.VERBOSE,E=C.log.bind(C),t&&k.set("logging_enabled",!0)):"function"==typeof e?E=e:(E=null,k.remove("logging_enabled"))},P=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===S&&(S=!1,null===E&&!0===k.get("logging_enabled")&&x(!0)),E){var n=I.apply(null,e);E(n)}},j=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];P.apply(void 0,Object(l.__spreadArray)([e],Object(l.__read)(t)))}},R=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+I.apply(void 0,Object(l.__spreadArray)([],Object(l.__read)(e)));C.error(n)},N=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+I.apply(void 0,Object(l.__spreadArray)([],Object(l.__read)(e)));throw C.error(n),new Error(n)},A=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+I.apply(void 0,Object(l.__spreadArray)([],Object(l.__read)(e)));C.warn(n)},M=function(data){return"number"==typeof data&&(data!=data||data===Number.POSITIVE_INFINITY||data===Number.NEGATIVE_INFINITY)},D="[MIN_NAME]",F="[MAX_NAME]",L=function(a,b){if(a===b)return 0;if(a===D||b===F)return-1;if(b===D||a===F)return 1;var e=$(a),t=$(b);return null!==e?null!==t?e-t==0?a.length-b.length:e-t:-1:null!==t?1:a<b?-1:1},U=function(a,b){return a===b?0:a<b?-1:1},B=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(c.stringify)(t))},W=function(e){if("object"!=typeof e||null===e)return Object(c.stringify)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=Object(c.stringify)(t[i]),r+=":",r+=W(e[t[i]]);return r+="}"},z=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],o=0;o<n;o+=t)o+t>n?r.push(e.substring(o,n)):r.push(e.substring(o,o+t));return r};function K(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var H=function(e){Object(c.assert)(!M(e),"Invalid JSON number");var s,t,n,r,i,o=1023;0===e?(t=0,n=0,s=1/e==-1/0?1:0):(s=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(t=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),o))+o,n=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(t=0,n=Math.round(e/Math.pow(2,-1074))));var l=[];for(i=52;i;i-=1)l.push(n%2?1:0),n=Math.floor(n/2);for(i=11;i;i-=1)l.push(t%2?1:0),t=Math.floor(t/2);l.push(s?1:0),l.reverse();var h=l.join(""),d="";for(i=0;i<64;i+=8){var f=parseInt(h.substr(i,8),2).toString(16);1===f.length&&(f="0"+f),d+=f}return d.toLowerCase()};var V=new RegExp("^-?(0*)\\d{1,10}$"),G=-2147483648,Q=2147483647,$=function(e){if(V.test(e)){var t=Number(e);if(t>=G&&t<=Q)return t}return null},Y=function(e){try{e()}catch(e){setTimeout((function(){var t=e.stack||"";throw A("Exception was thrown by user callback.",t),e}),Math.floor(0))}},J=function(e,time){var t=setTimeout(e,time);return"object"==typeof t&&t.unref&&t.unref(),t},X=function(){function e(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((function(e){return n.appCheck=e}))}return e.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise((function(n,r){setTimeout((function(){t.appCheck?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((function(t){return t.addTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){A('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},e}(),Z=function(){function e(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((function(e){return r.auth_=e}))}return e.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(P("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):new Promise((function(n,r){setTimeout((function(){t.auth_?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',A(e)},e}(),ee=function(){function e(e){this.accessToken=e}return e.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},e.prototype.addTokenChangeListener=function(e){e(this.accessToken)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.OWNER="owner",e}(),te="5",ne=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,re="ac",ie="websocket",oe="long_polling",ae=function(){function e(e,t,n,r,o,c,l){void 0===o&&(o=!1),void 0===c&&(c=""),void 0===l&&(l=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=c,this.includeNamespaceInQueryParams=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=w.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&w.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();function se(e,t,n){var r;if(Object(c.assert)("string"==typeof t,"typeof type must == string"),Object(c.assert)("object"==typeof n,"typeof params must == object"),t===ie)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==oe)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);var o=[];return K(n,(function(e,t){o.push(e+"="+t)})),r+o.join("&")}var ce=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),Object(c.contains)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return Object(c.deepCopy)(this.counters_)},e}(),ue={},le={};function he(e){var t=e.toString();return ue[t]||(ue[t]=new ce),ue[t]}var de=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,data){var t=this;this.pendingResponses[e]=data;for(var n=function(){var e=r.pendingResponses[r.currentResponseNum];delete r.pendingResponses[r.currentResponseNum];for(var n=function(i){e[i]&&Y((function(){t.onMessage_(e[i])}))},i=0;i<e.length;++i)n(i);if(r.currentResponseNum===r.closeAfterResponse)return r.onClose&&(r.onClose(),r.onClose=null),"break";r.currentResponseNum++},r=this;this.pendingResponses[this.currentResponseNum];){if("break"===n())break}},e}(),pe="start",fe=function(){function e(e,t,n,r,o,c,l){var h=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.transportSessionId=c,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=j(e),this.stats_=he(t),this.urlFn=function(e){return h.appCheckToken&&(e[re]=h.appCheckToken),se(t,oe,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new de(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(c.isNodeSdk)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new _e((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(l.__read)(e,5),o=r[0],c=r[1],h=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,o===pe)n.id=c,n.password=h;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);c?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(c,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(l.__read)(e,2),o=r[0],data=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(o,data)}),(function(){n.onClosed_()}),n.urlFn);var e={};e[pe]="t",e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v=te,n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e[re]=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&ne.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!Object(c.isNodeSdk)()&&(!!e.forceAllow_||!(e.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(data){var e=Object(c.stringify)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var t=Object(c.base64Encode)(e),n=z(t,1840),i=0;i<n.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!Object(c.isNodeSdk)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=Object(c.stringify)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),_e=function(){function e(t,n,r,o){if(this.onDisconnect=r,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(c.isNodeSdk)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=O(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var script="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11))script='<script>document.domain="'+document.domain+'";<\/script>';var l="<html><body>"+script+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(l),this.myIFrame.doc.close()}catch(e){P("frame writing exception"),e.stack&&P(e.stack),P(e)}}}return e.createIFrame_=function(){var iframe=document.createElement("iframe");if(iframe.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(iframe);try{iframe.contentWindow.document||P("No IE domain setting required")}catch(t){var e=document.domain;iframe.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return iframe.contentDocument?iframe.doc=iframe.contentDocument:iframe.contentWindow?iframe.doc=iframe.contentWindow.document:iframe.document&&(iframe.doc=iframe.document),iframe},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",i=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var r=this.pendingSegs.shift();n=n+"&seg"+i+"="+r.seg+"&ts"+i+"="+r.ts+"&d"+i+"="+r.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,data){this.pendingSegs.push({seg:e,ts:t,d:data}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},o=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(o),r()}))},e.prototype.addTag=function(e,t){var n=this;Object(c.isNodeSdk)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){P("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}}),Math.floor(1))},e}(),ge=null;"undefined"!=typeof MozWebSocket?ge=MozWebSocket:"undefined"!=typeof WebSocket&&(ge=WebSocket);var ve=function(){function t(e,n,r,o,c,l,h){this.connId=e,this.applicationId=r,this.appCheckToken=o,this.authToken=c,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=j(this.connId),this.stats_=he(n),this.connURL=t.connectionURL_(n,l,h,o),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(e,t,n,r){var o={};return o.v=te,!Object(c.isNodeSdk)()&&"undefined"!=typeof location&&location.hostname&&ne.test(location.hostname)&&(o.r="f"),t&&(o.s=t),n&&(o.ls=n),r&&(o[re]=r),se(e,ie,o)},t.prototype.open=function(t,n){var r=this;this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,w.set("previous_websocket_failure",!0);try{if(Object(c.isNodeSdk)()){var o=this.nodeAdmin?"AdminNode":"Node",l={headers:{"User-Agent":"Firebase/5/"+d+"/"+e.platform+"/"+o,"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(l.headers.Authorization="Bearer "+this.authToken),this.appCheckToken&&(l.headers["X-Firebase-AppCheck"]=this.appCheckToken);var h=e.env,f=0===this.connURL.indexOf("wss://")?h.HTTPS_PROXY||h.https_proxy:h.HTTP_PROXY||h.http_proxy;f&&(l.proxy={origin:f}),this.mySock=new ge(this.connURL,[],l)}else{l={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}};this.mySock=new ge(this.connURL,[],l)}}catch(e){this.log_("Error instantiating WebSocket.");var _=e.message||e.data;return _&&this.log_(_),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(e){r.handleIncomingFrame(e)},this.mySock.onerror=function(e){r.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&r.log_(t),r.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==ge&&!t.forceDisallow_},t.previouslyFailed=function(){return w.isInMemoryStorage||!0===w.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){w.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(data){if(this.frames.push(data),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var t=Object(c.jsonEval)(e);this.onMessage(t)}},t.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},t.prototype.extractFrameCount_=function(data){if(Object(c.assert)(null===this.frames,"We already have a frame buffer"),data.length<=6){var e=Number(data);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),data},t.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var data=e.data;if(this.bytesReceived+=data.length,this.stats_.incrementCounter("bytes_received",data.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(data);else{var t=this.extractFrameCount_(data);null!==t&&this.appendFrame_(t)}}},t.prototype.send=function(data){this.resetKeepAlive();var e=Object(c.stringify)(data);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var t=z(e,16384);t.length>1&&this.sendString_(String(t.length));for(var i=0;i<t.length;i++)this.sendString_(t[i])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),me=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[fe,ve]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,o=ve&&ve.isAvailable(),c=o&&!ve.previouslyFailed();if(t.webSocketOnly&&(o||A("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),c=!0),c)this.transports_=[ve];else{var h=this.transports_=[];try{for(var d=Object(l.__values)(e.ALL_TRANSPORTS),f=d.next();!f.done;f=d.next()){var _=f.value;_&&_.isAvailable()&&h.push(_)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),ye=function(){function e(e,t,n,r,o,c,l,h,d,f){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=c,this.onReady_=l,this.onDisconnect_=h,this.onKill_=d,this.lastSessionId=f,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=j("c:"+this.id+":"),this.transportManager_=new me(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var o=t.healthyTimeout||0;o>0&&(this.healthyTimeout_=J((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(o)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=B("t",e),data=B("d",e);if("c"===t)this.onSecondaryControl_(data);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(data)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=B("t",e),data=B("d",e);"c"===t?this.onControl_(data):"d"===t&&this.onDataMessage_(data)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=B("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?R("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):R("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),te!==n&&A("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),J((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):J((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(w.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(data){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(data)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),be=function(){function e(){}return e.prototype.put=function(e,data,t,n){},e.prototype.merge=function(e,data,t,n){},e.prototype.refreshAuthToken=function(e){},e.prototype.refreshAppCheckToken=function(e){},e.prototype.onDisconnectPut=function(e,data,t){},e.prototype.onDisconnectMerge=function(e,data,t){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),we=function(){function e(e){this.allowedEvents_=e,this.listeners_={},Object(c.assert)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=Object(l.__spreadArray)([],Object(l.__read)(this.listeners_[e])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){Object(c.assert)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),ke=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(c.isMobileCordova)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return Object(l.__extends)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(c.assert)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(we),Ce=32,Oe=768,Te=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[n]=this.pieces_[i],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",i=this.pieceNum_;i<this.pieces_.length;i++)""!==this.pieces_[i]&&(e+="/"+this.pieces_[i]);return e||"/"},e}();function Ie(){return new Te("")}function Ee(path){return path.pieceNum_>=path.pieces_.length?null:path.pieces_[path.pieceNum_]}function Se(path){return path.pieces_.length-path.pieceNum_}function xe(path){var e=path.pieceNum_;return e<path.pieces_.length&&e++,new Te(path.pieces_,e)}function Pe(path){return path.pieceNum_<path.pieces_.length?path.pieces_[path.pieces_.length-1]:null}function je(path,e){return void 0===e&&(e=0),path.pieces_.slice(path.pieceNum_+e)}function Re(path){if(path.pieceNum_>=path.pieces_.length)return null;for(var e=[],i=path.pieceNum_;i<path.pieces_.length-1;i++)e.push(path.pieces_[i]);return new Te(e,0)}function Ne(path,e){for(var t=[],i=path.pieceNum_;i<path.pieces_.length;i++)t.push(path.pieces_[i]);if(e instanceof Te)for(i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{var n=e.split("/");for(i=0;i<n.length;i++)n[i].length>0&&t.push(n[i])}return new Te(t,0)}function Ae(path){return path.pieceNum_>=path.pieces_.length}function Me(e,t){var n=Ee(e),r=Ee(t);if(null===n)return t;if(n===r)return Me(xe(e),xe(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function De(e,t){for(var n=je(e,0),r=je(t,0),i=0;i<n.length&&i<r.length;i++){var o=L(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function Fe(path,e){if(Se(path)!==Se(e))return!1;for(var i=path.pieceNum_,t=e.pieceNum_;i<=path.pieces_.length;i++,t++)if(path.pieces_[i]!==e.pieces_[t])return!1;return!0}function Le(path,e){var i=path.pieceNum_,t=e.pieceNum_;if(Se(path)>Se(e))return!1;for(;i<path.pieces_.length;){if(path.pieces_[i]!==e.pieces_[t])return!1;++i,++t}return!0}var Ue=function(path,e){this.errorPrefix_=e,this.parts_=je(path,0),this.byteLength_=Math.max(1,this.parts_.length);for(var i=0;i<this.parts_.length;i++)this.byteLength_+=Object(c.stringLength)(this.parts_[i]);qe(this)};function qe(e){if(e.byteLength_>Oe)throw new Error(e.errorPrefix_+"has a key path longer than "+Oe+" bytes ("+e.byteLength_+").");if(e.parts_.length>Ce)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ce+") or object contains a cycle "+Be(e))}function Be(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var We,ze,Ke=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return Object(l.__extends)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(c.assert)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(we),He=1e3,Ve=function(e){function t(n,r,o,l,h,d,f,_){var v=e.call(this)||this;if(v.repoInfo_=n,v.applicationId_=r,v.onDataUpdate_=o,v.onConnectStatus_=l,v.onServerInfoUpdate_=h,v.authTokenProvider_=d,v.appCheckTokenProvider_=f,v.authOverride_=_,v.id=t.nextPersistentConnectionId_++,v.log_=j("p:"+v.id+":"),v.interruptReasons_={},v.listens=new Map,v.outstandingPuts_=[],v.outstandingGets_=[],v.outstandingPutCount_=0,v.outstandingGetCount_=0,v.onDisconnectRequestQueue_=[],v.connected_=!1,v.reconnectDelay_=He,v.maxReconnectDelay_=3e5,v.securityDebugCallback_=null,v.lastSessionId=null,v.establishConnectionTimer_=null,v.visible_=!1,v.requestCBHash_={},v.requestNumber_=0,v.realtime_=null,v.authToken_=null,v.appCheckToken_=null,v.forceTokenRefresh_=!1,v.invalidAuthTokenCount_=0,v.invalidAppCheckTokenCount_=0,v.firstConnection_=!0,v.lastConnectionAttemptTime_=null,v.lastConnectionEstablishedTime_=null,_&&!Object(c.isNodeSdk)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Ke.getInstance().on("visible",v.onVisible_,v),-1===n.host.indexOf("fblocal")&&ke.getInstance().on("online",v.onOnline_,v),v}return Object(l.__extends)(t,e),t.prototype.sendRequest=function(e,body,t){var n=++this.requestNumber_,r={r:n,a:e,b:body};this.log_(Object(c.stringify)(r)),Object(c.assert)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),t&&(this.requestCBHash_[n]=t)},t.prototype.get=function(e){var t=this;this.initConnection_();var n=new c.Deferred,r={p:e._path.toString(),q:e._queryObject},o={action:"g",request:r,onComplete:function(e){var o=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,o,!1,null),n.resolve(o)):n.reject(o)}};this.outstandingGets_.push(o),this.outstandingGetCount_++;var l=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[l];void 0!==e&&o===e&&(delete t.outstandingGets_[l],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+l+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(l),n.promise},t.prototype.listen=function(e,t,n,r){this.initConnection_();var o=e._queryIdentifier,l=e._path.toString();this.log_("Listen called for "+l+" "+o),this.listens.has(l)||this.listens.set(l,new Map),Object(c.assert)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Object(c.assert)(!this.listens.get(l).has(o),"listen() called twice for same path/queryId.");var h={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(l).set(o,h),this.connected_&&this.sendListen_(h)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},t.prototype.sendListen_=function(e){var n=this,r=e.query,o=r._path.toString(),c=r._queryIdentifier;this.log_("Listen on "+o+" for "+c);var l={p:o};e.tag&&(l.q=r._queryObject,l.t=e.tag),l.h=e.hashFn(),this.sendRequest("q",l,(function(l){var h=l.d,d=l.s;t.warnOnListenWarnings_(h,r),(n.listens.get(o)&&n.listens.get(o).get(c))===e&&(n.log_("listen response",l),"ok"!==d&&n.removeListen_(o,c),e.onComplete&&e.onComplete(d,h))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&Object(c.contains)(e,"w")){var n=Object(c.safeGet)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();A("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+o+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||Object(c.isAdmin)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(function(){}))},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=Object(c.isValidFormat)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,data=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,data))}))}},t.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(function(t){var n=t.s,data=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,data)}))},t.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Object(c.assert)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var o={p:e};r&&(o.q=n,o.t=r),this.sendRequest("n",o)},t.prototype.onDisconnectPut=function(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:data,onComplete:t})},t.prototype.onDisconnectMerge=function(e,data,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,data,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:data,onComplete:t})},t.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,data,n){var r={p:t,d:data};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(function(e){n&&setTimeout((function(){n(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,data,t,n){this.putInternal("p",e,data,t,n)},t.prototype.merge=function(e,data,t,n){this.putInternal("m",e,data,t,n)},t.prototype.putInternal=function(e,t,data,n,r){this.initConnection_();var o={p:t,d:data};void 0!==r&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:n}),this.outstandingPutCount_++;var c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,o=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),o&&o(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+Object(c.stringify)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,body){this.log_("handleServerMessage",e,body),"d"===e?this.onDataUpdate_(body.p,body.d,!1,body.t):"m"===e?this.onDataUpdate_(body.p,body.d,!0,body.t):"c"===e?this.onListenRevoked_(body.p,body.q):"ac"===e?this.onAuthRevoked_(body.s,body.d):"apc"===e?this.onAppCheckRevoked_(body.s,body.d):"sd"===e?this.onSecurityDebugPacket_(body):R("Unrecognized action received from server: "+Object(c.stringify)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;Object(c.assert)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=He,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=He,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=He),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){return Object(l.__awaiter)(this,void 0,void 0,(function(){var e,n,r,o,h,d,f,_,v,m,y,w,k,C,O=this;return Object(l.__generator)(this,(function(T){switch(T.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+t.nextConnectionId_++,h=this.lastSessionId,d=!1,f=null,_=function(){f?f.close():(d=!0,r())},v=function(e){Object(c.assert)(f,"sendRequest call when we're not connected not allowed."),f.sendRequest(e)},this.realtime_={close:_,sendRequest:v},m=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,T.label=1;case 1:return T.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(m),this.appCheckTokenProvider_.getToken(m)])];case 2:return y=l.__read.apply(void 0,[T.sent(),2]),w=y[0],k=y[1],d?P("getToken() completed but was canceled"):(P("getToken() completed. Creating connection."),this.authToken_=w&&w.accessToken,this.appCheckToken_=k&&k.token,f=new ye(o,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,(function(e){A(e+" ("+O.repoInfo_.toString()+")"),O.interrupt("server_kill")}),h)),[3,4];case 3:return C=T.sent(),this.log_("Failed to get token: "+C),d||(this.repoInfo_.nodeAdmin&&A(C),_()),[3,4];case 4:return[2]}}))}))},t.prototype.interrupt=function(e){P("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){P("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(c.isEmpty)(this.interruptReasons_)&&(this.reconnectDelay_=He,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var i=0;i<this.outstandingPuts_.length;i++){var e=this.outstandingPuts_[i];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[i],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(q){return W(q)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new Te(e).toString();if(this.listens.has(r)){var map=this.listens.get(r);n=map.get(t),map.delete(t),0===map.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){P("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onAppCheckRevoked_=function(e,t){P("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},t.prototype.onSecurityDebugPacket_=function(body){this.securityDebugCallback_?this.securityDebugCallback_(body):"msg"in body&&console.log("FIREBASE: "+body.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var o=Object(l.__values)(this.listens.values()),c=o.next();!c.done;c=o.next()){var h=c.value;try{for(var d=(n=void 0,Object(l.__values)(h.values())),f=d.next();!f.done;f=d.next()){var _=f.value;this.sendListen_(_)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}for(var i=0;i<this.outstandingPuts_.length;i++)this.outstandingPuts_[i]&&this.sendPut_(i);for(;this.onDisconnectRequestQueue_.length;){var v=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(v.action,v.pathString,v.data,v.onComplete)}for(i=0;i<this.outstandingGets_.length;i++)this.outstandingGets_[i]&&this.sendGet_(i)},t.prototype.sendConnectStats_=function(){var e={},t="js";Object(c.isNodeSdk)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+d.replace(/\./g,"-")]=1,Object(c.isMobileCordova)()?e["framework.cordova"]=1:Object(c.isReactNative)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=ke.getInstance().currentlyOnline();return Object(c.isEmpty)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(be),Ge=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Qe=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new Ge(D,e),r=new Ge(D,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return Ge.MIN},e}(),$e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.__extends)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return We},set:function(e){We=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(a,b){return L(a.name,b.name)},t.prototype.isDefinedOn=function(e){throw Object(c.assertionError)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return Ge.MIN},t.prototype.maxPost=function(){return new Ge(F,We)},t.prototype.makePost=function(e,t){return Object(c.assert)("string"==typeof e,"KeyIndex indexValue must always be a string."),new Ge(e,We)},t.prototype.toString=function(){return".key"},t}(Qe),Ye=new $e,Je=function(){function e(e,t,n,r,o){void 0===o&&(o=null),this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];for(var c=1;!e.isEmpty();)if(c=t?n(e.key,t):1,r&&(c*=-1),c<0)e=this.isReverse_?e.left:e.right;else{if(0===c){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Xe=function(){function e(t,n,r,o,c){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=o?o:et.EMPTY_NODE,this.right=null!=c?c:et.EMPTY_NODE}return e.prototype.copy=function(t,n,r,o,c){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=o?o:this.left,null!=c?c:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,o=n(e,r.key);return(r=o<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===o?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return et.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return et.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Ze=function(){function e(){}return e.prototype.copy=function(e,t,n,r,o){return this},e.prototype.insert=function(e,t,n){return new Xe(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),et=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Xe.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Xe.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Je(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Je(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Je(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Je(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Ze,e}();function tt(e,t){return L(e.name,t.name)}function nt(e,t){return L(e,t)}var it,ot,at,st=function(e){return"number"==typeof e?"number:"+H(e):"string:"+e},ct=function(e){if(e.isLeafNode()){var t=e.val();Object(c.assert)("string"==typeof t||"number"==typeof t||"object"==typeof t&&Object(c.contains)(t,".sv"),"Priority must be a string or number.")}else Object(c.assert)(e===ze||e.isEmpty(),"priority of unexpected type.");Object(c.assert)(e===ze||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},ut=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Object(c.assert)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ct(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return it},set:function(e){it=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(path){return Ae(path)?this:".priority"===Ee(path)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(path,t){var n=Ee(path);return null===n?t:t.isEmpty()&&".priority"!==n?this:(Object(c.assert)(".priority"!==n||1===Se(path),".priority must be the last token in a path"),this.updateImmediateChild(n,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(xe(path),t)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+st(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?H(this.value_):this.value_,this.lazyHash_=T(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Object(c.assert)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,o=e.VALUE_TYPE_ORDER.indexOf(n),l=e.VALUE_TYPE_ORDER.indexOf(r);return Object(c.assert)(o>=0,"Unknown leaf type: "+n),Object(c.assert)(l>=0,"Unknown leaf type: "+r),o===l?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:l-o},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var lt,ht,pt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.__extends)(t,e),t.prototype.compare=function(a,b){var e=a.node.getPriority(),t=b.node.getPriority(),n=e.compareTo(t);return 0===n?L(a.name,b.name):n},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return Ge.MIN},t.prototype.maxPost=function(){return new Ge(F,new ut("[PRIORITY-POST]",at))},t.prototype.makePost=function(e,t){var n=ot(e);return new Ge(t,new ut("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(Qe),ft=new pt,_t=Math.log(2),gt=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/_t,10)),this.current_=this.count-1;var n,mask=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&mask}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),vt=function(e,t,n,r){e.sort(t);var o=function(t,r){var c,l,h=r-t;if(0===h)return null;if(1===h)return c=e[t],l=n?n(c):c,new Xe(l,c.node,Xe.BLACK,null,null);var d=parseInt(h/2,10)+t,f=o(t,d),_=o(d+1,r);return c=e[d],l=n?n(c):c,new Xe(l,c.node,Xe.BLACK,f,_)},c=function(t){for(var r=null,c=null,l=e.length,h=function(t,r){var c=l-t,h=l;l-=t;var f=o(c+1,h),_=e[c],v=n?n(_):_;d(new Xe(v,_.node,r,null,f))},d=function(e){r?(r.left=e,r=e):(c=e,r=e)},i=0;i<t.count;++i){var f=t.nextBitIsOne(),_=Math.pow(2,t.count-(i+1));f?h(_,Xe.BLACK):(h(_,Xe.BLACK),h(_,Xe.RED))}return c}(new gt(e.length));return new et(r||t,c)},mt={},yt=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return Object(c.assert)(mt&&ft,"ChildrenNode.ts has not been loaded"),lt=lt||new e({".priority":mt},{".priority":ft})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=Object(c.safeGet)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof et?t:null},e.prototype.hasIndex=function(e){return Object(c.contains)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){Object(c.assert)(t!==Ye,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,o=[],h=!1,d=n.getIterator(Ge.Wrap),f=d.getNext();f;)h=h||t.isDefinedOn(f.node),o.push(f),f=d.getNext();r=h?vt(o,t.getCompare()):mt;var _=t.toString(),v=Object(l.__assign)({},this.indexSet_);v[_]=t;var m=Object(l.__assign)({},this.indexes_);return m[_]=r,new e(m,v)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(Object(c.map)(this.indexes_,(function(e,o){var l=Object(c.safeGet)(r.indexSet_,o);if(Object(c.assert)(l,"Missing index implementation for "+o),e===mt){if(l.isDefinedOn(t.node)){for(var h=[],d=n.getIterator(Ge.Wrap),f=d.getNext();f;)f.name!==t.name&&h.push(f),f=d.getNext();return h.push(t),vt(h,l.getCompare())}return mt}var _=n.get(t.name),v=e;return _&&(v=v.remove(new Ge(t.name,_))),v.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(Object(c.map)(this.indexes_,(function(e){if(e===mt)return e;var r=n.get(t.name);return r?e.remove(new Ge(t.name,r)):e})),this.indexSet_)},e}(),bt=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ct(this.priorityNode_),this.children_.isEmpty()&&Object(c.assert)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return ht||(ht=new e(new et(nt),null,yt.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||ht},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?ht:t},e.prototype.getChild=function(path){var e=Ee(path);return null===e?this:this.getImmediateChild(e).getChild(xe(path))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(Object(c.assert)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new Ge(t,n),o=void 0,l=void 0;n.isEmpty()?(o=this.children_.remove(t),l=this.indexMap_.removeFromIndexes(r,this.children_)):(o=this.children_.insert(t,n),l=this.indexMap_.addToIndexes(r,this.children_));var h=o.isEmpty()?ht:this.priorityNode_;return new e(o,h,l)},e.prototype.updateChild=function(path,e){var t=Ee(path);if(null===t)return e;Object(c.assert)(".priority"!==Ee(path)||1===Se(path),".priority must be the last token in a path");var n=this.getImmediateChild(t).updateChild(xe(path),e);return this.updateImmediateChild(t,n)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,o=0,c=!0;if(this.forEachChild(ft,(function(l,h){n[l]=h.val(t),r++,c&&e.INTEGER_REGEXP_.test(l)?o=Math.max(o,Number(l)):c=!1})),!t&&c&&o<2*r){var l=[];for(var h in n)l[h]=n[h];return l}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+st(this.getPriority().val())+":"),this.forEachChild(ft,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":T(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var o=r.getPredecessorKey(new Ge(e,t));return o?o.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new Ge(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new Ge(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,Ge.Wrap),o=r.peek();null!=o&&t.compare(o,e)<0;)r.getNext(),o=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,Ge.Wrap),o=r.peek();null!=o&&t.compare(o,e)>0;)r.getNext(),o=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===wt?-1:0},e.prototype.withIndex=function(t){if(t===Ye||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===Ye||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(ft),r=t.getIterator(ft),o=n.getNext(),c=r.getNext();o&&c;){if(o.name!==c.name||!o.node.equals(c.node))return!1;o=n.getNext(),c=r.getNext()}return null===o&&null===c}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===Ye?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),wt=new(function(e){function t(){return e.call(this,new et(nt),bt.EMPTY_NODE,yt.Default)||this}return Object(l.__extends)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return bt.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(bt));Object.defineProperties(Ge,{MIN:{value:new Ge(D,bt.EMPTY_NODE)},MAX:{value:new Ge(F,wt)}}),$e.__EMPTY_NODE=bt.EMPTY_NODE,ut.__childrenNodeConstructor=bt,ze=wt,function(e){at=e}(wt);var kt=!0;function Ct(e,t){if(void 0===t&&(t=null),null===e)return bt.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),Object(c.assert)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new ut(e,Ct(t));if(e instanceof Array||!kt){var n=bt.EMPTY_NODE;return K(e,(function(t,r){if(Object(c.contains)(e,t)&&"."!==t.substring(0,1)){var o=Ct(r);!o.isLeafNode()&&o.isEmpty()||(n=n.updateImmediateChild(t,o))}})),n.updatePriority(Ct(t))}var r=[],o=!1;if(K(e,(function(e,t){if("."!==e.substring(0,1)){var n=Ct(t);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),r.push(new Ge(e,n)))}})),0===r.length)return bt.EMPTY_NODE;var l=vt(r,tt,(function(e){return e.name}),nt);if(o){var h=vt(r,ft.getCompare());return new bt(l,Ct(t),new yt({".priority":h},{".priority":ft}))}return new bt(l,Ct(t),yt.Default)}!function(e){ot=e}(Ct);var Ot,Tt,It=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,Object(c.assert)(!Ae(t)&&".priority"!==Ee(t),"Can't create PathIndex with empty path or .priority key"),n}return Object(l.__extends)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(a,b){var e=this.extractChild(a.node),t=this.extractChild(b.node),n=e.compareTo(t);return 0===n?L(a.name,b.name):n},t.prototype.makePost=function(e,t){var n=Ct(e),r=bt.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ge(t,r)},t.prototype.maxPost=function(){var e=bt.EMPTY_NODE.updateChild(this.indexPath_,wt);return new Ge(F,e)},t.prototype.toString=function(){return je(this.indexPath_,0).join("/")},t}(Qe),Et=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.__extends)(t,e),t.prototype.compare=function(a,b){var e=a.node.compareTo(b.node);return 0===e?L(a.name,b.name):e},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return Ge.MIN},t.prototype.maxPost=function(){return Ge.MAX},t.prototype.makePost=function(e,t){var n=Ct(e);return new Ge(t,n)},t.prototype.toString=function(){return".value"},t}(Qe),St=new Et,xt="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Pt=(Ot=0,Tt=[],function(e){var i,t=e===Ot;Ot=e;var n=new Array(8);for(i=7;i>=0;i--)n[i]=xt.charAt(e%64),e=Math.floor(e/64);Object(c.assert)(0===e,"Cannot push at time == 0");var r=n.join("");if(t){for(i=11;i>=0&&63===Tt[i];i--)Tt[i]=0;Tt[i]++}else for(i=0;i<12;i++)Tt[i]=Math.floor(64*Math.random());for(i=0;i<12;i++)r+=xt.charAt(Tt[i]);return Object(c.assert)(20===r.length,"nextPushId: Length should be 20."),r}),jt=function(e){if(e===""+Q)return"-";var t=$(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return F;var source=n[i],o=xt.charAt(xt.indexOf(source)+1);return n[i]=o,n.slice(0,i+1).join("")},Rt=function(e){if(e===""+G)return D;var t=$(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),i=0;i<n.length;i++)n[i]=e.charAt(i);return"-"===n[n.length-1]?1===n.length?""+Q:(delete n[n.length-1],n.join("")):(n[n.length-1]=xt.charAt(xt.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function Nt(e){return{type:"value",snapshotNode:e}}function At(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Mt(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Dt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var Ft=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,source,o){Object(c.assert)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var l=e.getImmediateChild(t);return l.getChild(r).equals(n.getChild(r))&&l.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(Mt(t,l)):Object(c.assert)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(At(t,n)):o.trackChildChange(Dt(t,n,l))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(ft,(function(e,r){t.hasChild(e)||n.trackChildChange(Mt(e,r))})),t.isLeafNode()||t.forEachChild(ft,(function(t,r){if(e.hasChild(t)){var o=e.getImmediateChild(t);o.equals(r)||n.trackChildChange(Dt(t,r,o))}else n.trackChildChange(At(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?bt.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),Lt=function(){function e(t){this.indexedFilter_=new Ft(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,source,o){return this.matches(new Ge(t,n))||(n=bt.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,source,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=bt.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(bt.EMPTY_NODE);var o=this;return t.forEachChild(ft,(function(e,t){o.matches(new Ge(e,t))||(r=r.updateImmediateChild(e,bt.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),Ut=function(){function e(e){this.rangedFilter_=new Lt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,source,o){return this.rangedFilter_.matches(new Ge(t,n))||(n=bt.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,source,o):this.fullLimitUpdateChild_(e,t,n,source,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=bt.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=bt.EMPTY_NODE.withIndex(this.index_);var o=void 0;o=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var c=0;o.hasNext()&&c<this.limit_;){var l=o.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),l)<=0:this.index_.compare(l,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(l.name,l.node),c++}}else{r=(r=t.withIndex(this.index_)).updatePriority(bt.EMPTY_NODE);var h=void 0,d=void 0,f=void 0;o=void 0;if(this.reverse_){o=r.getReverseIterator(this.index_),h=this.rangedFilter_.getEndPost(),d=this.rangedFilter_.getStartPost();var _=this.index_.getCompare();f=function(a,b){return _(b,a)}}else o=r.getIterator(this.index_),h=this.rangedFilter_.getStartPost(),d=this.rangedFilter_.getEndPost(),f=this.index_.getCompare();c=0;for(var v=!1;o.hasNext();){l=o.getNext();!v&&f(h,l)<=0&&(v=!0),v&&c<this.limit_&&f(l,d)<=0?c++:r=r.updateImmediateChild(l.name,bt.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,source,r){var o;if(this.reverse_){var l=this.index_.getCompare();o=function(a,b){return l(b,a)}}else o=this.index_.getCompare();var h=e;Object(c.assert)(h.numChildren()===this.limit_,"");var d=new Ge(t,n),f=this.reverse_?h.getFirstChild(this.index_):h.getLastChild(this.index_),_=this.rangedFilter_.matches(d);if(h.hasChild(t)){for(var v=h.getImmediateChild(t),m=source.getChildAfterChild(this.index_,f,this.reverse_);null!=m&&(m.name===t||h.hasChild(m.name));)m=source.getChildAfterChild(this.index_,m,this.reverse_);var y=null==m?1:o(m,d);if(_&&!n.isEmpty()&&y>=0)return null!=r&&r.trackChildChange(Dt(t,n,v)),h.updateImmediateChild(t,n);null!=r&&r.trackChildChange(Mt(t,v));var w=h.updateImmediateChild(t,bt.EMPTY_NODE);return null!=m&&this.rangedFilter_.matches(m)?(null!=r&&r.trackChildChange(At(m.name,m.node)),w.updateImmediateChild(m.name,m.node)):w}return n.isEmpty()?e:_&&o(f,d)>=0?(null!=r&&(r.trackChildChange(Mt(f.name,f.node)),r.trackChildChange(At(t,n))),h.updateImmediateChild(t,n).updateImmediateChild(f.name,bt.EMPTY_NODE)):e},e}(),qt=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ft}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return Object(c.assert)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return Object(c.assert)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:D},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return Object(c.assert)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return Object(c.assert)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:F},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return Object(c.assert)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===ft},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();function Bt(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Wt(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function zt(e,t){var n=e.copy();return n.index_=t,n}function Kt(e){var t,n={};return e.isDefault()||(e.index_===ft?t="$priority":e.index_===St?t="$value":e.index_===Ye?t="$key":(Object(c.assert)(e.index_ instanceof It,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=Object(c.stringify)(t),e.startSet_&&(n.startAt=Object(c.stringify)(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+Object(c.stringify)(e.indexStartName_))),e.endSet_&&(n.endAt=Object(c.stringify)(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+Object(c.stringify)(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}function Ht(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==ft&&(t.i=e.index_.toString()),t}var Vt=function(e){function t(t,n,r,o){var c=e.call(this)||this;return c.repoInfo_=t,c.onDataUpdate_=n,c.authTokenProvider_=r,c.appCheckTokenProvider_=o,c.log_=j("p:rest:"),c.listens_={},c}return Object(l.__extends)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(Object(c.assert)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},t.prototype.listen=function(e,n,r,o){var l=this,h=e._path.toString();this.log_("Listen called for "+h+" "+e._queryIdentifier);var d=t.getListenId_(e,r),f={};this.listens_[d]=f;var _=Kt(e._queryParams);this.restRequest_(h+".json",_,(function(e,t){var data=t;(404===e&&(data=null,e=null),null===e&&l.onDataUpdate_(h,data,!1,r),Object(c.safeGet)(l.listens_,d)===f)&&o(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=Kt(e._queryParams),r=e._path.toString(),o=new c.Deferred;return this.restRequest_(r+".json",n,(function(e,n){var data=n;404===e&&(data=null,e=null),null===e?(t.onDataUpdate_(r,data,!1,null),o.resolve(data)):o.reject(new Error(data))})),o.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;return void 0===t&&(t={}),t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((function(o){var h=Object(l.__read)(o,2),d=h[0],f=h[1];d&&d.accessToken&&(t.auth=d.accessToken),f&&f.token&&(t.ac=f.token);var _=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+Object(c.querystring)(t);r.log_("Sending REST request for "+_);var v=new XMLHttpRequest;v.onreadystatechange=function(){if(n&&4===v.readyState){r.log_("REST Response for "+_+" received. status:",v.status,"response:",v.responseText);var e=null;if(v.status>=200&&v.status<300){try{e=Object(c.jsonEval)(v.responseText)}catch(e){A("Failed to parse JSON response for "+_+": "+v.responseText)}n(null,e)}else 401!==v.status&&404!==v.status&&A("Got unsuccessful REST response for "+_+" Status: "+v.status),n(v.status);n=null}},v.open("GET",_,!0),v.send()}))},t}(be),Gt=function(){function e(){this.rootNode_=bt.EMPTY_NODE}return e.prototype.getNode=function(path){return this.rootNode_.getChild(path)},e.prototype.updateSnapshot=function(path,e){this.rootNode_=this.rootNode_.updateChild(path,e)},e}();function Qt(){return{value:null,children:new Map}}function $t(e,path,data){if(Ae(path))e.value=data,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(path,data);else{var t=Ee(path);e.children.has(t)||e.children.set(t,Qt()),$t(e.children.get(t),path=xe(path),data)}}function Yt(e,path){if(Ae(path))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;var t=e.value;return e.value=null,t.forEachChild(ft,(function(t,n){$t(e,new Te(t),n)})),Yt(e,path)}if(e.children.size>0){var n=Ee(path);if(path=xe(path),e.children.has(n))Yt(e.children.get(n),path)&&e.children.delete(n);return 0===e.children.size}return!0}function Jt(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((function(e,n){t(n,e)}))}(e,(function(e,r){Jt(r,new Te(t.toString()+"/"+e),n)}))}var Xt,Zt=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=Object(l.__assign)({},e);return this.last_&&K(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),en=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Zt(e);var n=1e4+2e4*Math.random();J(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;K(t,(function(t,o){o>0&&Object(c.contains)(e.statsToReport_,t)&&(n[t]=o,r=!0)})),r&&this.server_.reportStats(n),J(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}();function tn(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Xt||(Xt={}));var nn,rn=function(){function e(path,e,t){this.path=path,this.affectedTree=e,this.revert=t,this.type=Xt.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return e.prototype.operationForChild=function(t){if(Ae(this.path)){if(null!=this.affectedTree.value)return Object(c.assert)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new Te(t));return new e(Ie(),n,this.revert)}return Object(c.assert)(Ee(this.path)===t,"operationForChild called for unrelated child."),new e(xe(this.path),this.affectedTree,this.revert)},e}(),on=function(){function e(source,path){this.source=source,this.path=path,this.type=Xt.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return Ae(this.path)?new e(this.source,Ie()):new e(this.source,xe(this.path))},e}(),an=function(){function e(source,path,e){this.source=source,this.path=path,this.snap=e,this.type=Xt.OVERWRITE}return e.prototype.operationForChild=function(t){return Ae(this.path)?new e(this.source,Ie(),this.snap.getImmediateChild(t)):new e(this.source,xe(this.path),this.snap)},e}(),sn=function(){function e(source,path,e){this.source=source,this.path=path,this.children=e,this.type=Xt.MERGE}return e.prototype.operationForChild=function(t){if(Ae(this.path)){var n=this.children.subtree(new Te(t));return n.isEmpty()?null:n.value?new an(this.source,Ie(),n.value):new e(this.source,Ie(),n)}return Object(c.assert)(Ee(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,xe(this.path),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),cn=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(path){if(Ae(path))return this.isFullyInitialized()&&!this.filtered_;var e=Ee(path);return this.isCompleteForChild(e)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),un=function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()};function ln(e,t,n,r,o,l){var h=r.filter((function(e){return e.type===n}));h.sort((function(a,b){return function(e,a,b){if(null==a.childName||null==b.childName)throw Object(c.assertionError)("Should only compare child_ events.");var t=new Ge(a.childName,a.snapshotNode),n=new Ge(b.childName,b.snapshotNode);return e.index_.compare(t,n)}(e,a,b)})),h.forEach((function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,l);o.forEach((function(o){o.respondsTo(n.type)&&t.push(o.createEvent(r,e.query_))}))}))}function hn(e,t){return{eventCache:e,serverCache:t}}function dn(e,t,n,r){return hn(new cn(t,n,r),e.serverCache)}function pn(e,t,n,r){return hn(e.eventCache,new cn(t,n,r))}function fn(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function _n(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var gn=function(){function e(e,t){void 0===t&&(nn||(nn=new et(U)),t=nn),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return K(t,(function(e,t){n=n.set(new Te(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:Ie(),value:this.value};if(Ae(e))return null;var n=Ee(e),r=this.children.get(n);if(null!==r){var o=r.findRootMostMatchingPathAndValue(xe(e),t);return null!=o?{path:Ne(new Te(n),o.path),value:o.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(Ae(t))return this;var n=Ee(t),r=this.children.get(n);return null!==r?r.subtree(xe(t)):new e(null)},e.prototype.set=function(t,n){if(Ae(t))return new e(n,this.children);var r=Ee(t),o=(this.children.get(r)||new e(null)).set(xe(t),n),c=this.children.insert(r,o);return new e(this.value,c)},e.prototype.remove=function(t){if(Ae(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=Ee(t),r=this.children.get(n);if(r){var o=r.remove(xe(t)),c=void 0;return c=o.isEmpty()?this.children.remove(n):this.children.insert(n,o),null===this.value&&c.isEmpty()?new e(null):new e(this.value,c)}return this},e.prototype.get=function(e){if(Ae(e))return this.value;var t=Ee(e),n=this.children.get(t);return n?n.get(xe(e)):null},e.prototype.setTree=function(t,n){if(Ae(t))return n;var r=Ee(t),o=(this.children.get(r)||new e(null)).setTree(xe(t),n),c=void 0;return c=o.isEmpty()?this.children.remove(r):this.children.insert(r,o),new e(this.value,c)},e.prototype.fold=function(e){return this.fold_(Ie(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,o){n[r]=o.fold_(Ne(e,r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(path,e){return this.findOnPath_(path,Ie(),e)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(Ae(e))return null;var o=Ee(e),c=this.children.get(o);return c?c.findOnPath_(xe(e),Ne(t,o),n):null},e.prototype.foreachOnPath=function(path,e){return this.foreachOnPath_(path,Ie(),e)},e.prototype.foreachOnPath_=function(t,n,r){if(Ae(t))return this;this.value&&r(n,this.value);var o=Ee(t),c=this.children.get(o);return c?c.foreachOnPath_(xe(t),Ne(n,o),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(Ie(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(Ne(e,n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e}(),vn=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new gn(null))},e}();function mn(e,path,t){if(Ae(path))return new vn(new gn(t));var n=e.writeTree_.findRootMostValueAndPath(path);if(null!=n){var r=n.path,o=n.value,c=Me(r,path);return o=o.updateChild(c,t),new vn(e.writeTree_.set(r,o))}var l=new gn(t),h=e.writeTree_.setTree(path,l);return new vn(h)}function yn(e,path,t){var n=e;return K(t,(function(e,t){n=mn(n,Ne(path,e),t)})),n}function bn(e,path){if(Ae(path))return vn.empty();var t=e.writeTree_.setTree(path,new gn(null));return new vn(t)}function wn(e,path){return null!=kn(e,path)}function kn(e,path){var t=e.writeTree_.findRootMostValueAndPath(path);return null!=t?e.writeTree_.get(t.path).getChild(Me(t.path,path)):null}function Cn(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(ft,(function(e,n){t.push(new Ge(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new Ge(e,n.value))})),t}function On(e,path){if(Ae(path))return e;var t=kn(e,path);return new vn(null!=t?new gn(t):e.writeTree_.subtree(path))}function Tn(e){return e.writeTree_.isEmpty()}function In(e,t){return En(Ie(),e.writeTree_,t)}function En(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,o){".priority"===t?(Object(c.assert)(null!==o.value,"Priority writes must always be leaf nodes"),r=o.value):n=En(Ne(e,t),o,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Ne(e,".priority"),r)),n}function Sn(e,path){return Bn(path,e)}function xn(e,t){var n=e.allWrites.findIndex((function(s){return s.writeId===t}));Object(c.assert)(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var o=r.visible,l=!1,i=e.allWrites.length-1;o&&i>=0;){var h=e.allWrites[i];h.visible&&(i>=n&&Pn(h,r.path)?o=!1:Le(r.path,h.path)&&(l=!0)),i--}if(o){if(l)return function(e){e.visibleWrites=Rn(e.allWrites,jn,Ie()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;r.snap?e.visibleWrites=bn(e.visibleWrites,r.path):K(r.children,(function(t){e.visibleWrites=bn(e.visibleWrites,Ne(r.path,t))}));return!0}return!1}function Pn(e,path){if(e.snap)return Le(e.path,path);for(var t in e.children)if(e.children.hasOwnProperty(t)&&Le(Ne(e.path,t),path))return!0;return!1}function jn(e){return e.visible}function Rn(e,filter,t){for(var n=vn.empty(),i=0;i<e.length;++i){var r=e[i];if(filter(r)){var o=r.path,l=void 0;if(r.snap)Le(t,o)?n=mn(n,l=Me(t,o),r.snap):Le(o,t)&&(l=Me(o,t),n=mn(n,Ie(),r.snap.getChild(l)));else{if(!r.children)throw Object(c.assertionError)("WriteRecord should have .snap or .children");if(Le(t,o))n=yn(n,l=Me(t,o),r.children);else if(Le(o,t))if(Ae(l=Me(o,t)))n=yn(n,Ie(),r.children);else{var h=Object(c.safeGet)(r.children,Ee(l));if(h){var d=h.getChild(xe(l));n=mn(n,Ie(),d)}}}}}return n}function Nn(e,t,n,r,o){if(r||o){var c=On(e.visibleWrites,t);if(!o&&Tn(c))return n;if(o||null!=n||wn(c,Ie())){return In(Rn(e.allWrites,(function(e){return(e.visible||o)&&(!r||!~r.indexOf(e.writeId))&&(Le(e.path,t)||Le(t,e.path))}),t),n||bt.EMPTY_NODE)}return null}var l=kn(e.visibleWrites,t);if(null!=l)return l;var h=On(e.visibleWrites,t);return Tn(h)?n:null!=n||wn(h,Ie())?In(h,n||bt.EMPTY_NODE):null}function An(e,t,n,r){return Nn(e.writeTree,e.treePath,t,n,r)}function Mn(e,t){return function(e,t,n){var r=bt.EMPTY_NODE,o=kn(e.visibleWrites,t);if(o)return o.isLeafNode()||o.forEachChild(ft,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var c=On(e.visibleWrites,t);return n.forEachChild(ft,(function(e,t){var n=In(On(c,new Te(e)),t);r=r.updateImmediateChild(e,n)})),Cn(c).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}return Cn(On(e.visibleWrites,t)).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Dn(e,path,t,n){return function(e,t,n,r,o){Object(c.assert)(r||o,"Either existingEventSnap or existingServerSnap must exist");var path=Ne(t,n);if(wn(e.visibleWrites,path))return null;var l=On(e.visibleWrites,path);return Tn(l)?o.getChild(n):In(l,o.getChild(n))}(e.writeTree,e.treePath,path,t,n)}function Fn(e,path){return function(e,path){return kn(e.visibleWrites,path)}(e.writeTree,Ne(e.treePath,path))}function Ln(e,t,n,r,o,c){return function(e,t,n,r,o,c,l){var h,d=On(e.visibleWrites,t),f=kn(d,Ie());if(null!=f)h=f;else{if(null==n)return[];h=In(d,n)}if((h=h.withIndex(l)).isEmpty()||h.isLeafNode())return[];for(var _=[],v=l.getCompare(),m=c?h.getReverseIteratorFrom(r,l):h.getIteratorFrom(r,l),y=m.getNext();y&&_.length<o;)0!==v(y,r)&&_.push(y),y=m.getNext();return _}(e.writeTree,e.treePath,t,n,r,o,c)}function Un(e,t,n){return function(e,t,n,r){var path=Ne(t,n),o=kn(e.visibleWrites,path);return null!=o?o:r.isCompleteForChild(n)?In(On(e.visibleWrites,path),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function qn(e,t){return Bn(Ne(e.treePath,t),e.writeTree)}function Bn(path,e){return{treePath:path,writeTree:e}}var Wn=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;Object(c.assert)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),Object(c.assert)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var o=r.type;if("child_added"===t&&"child_removed"===o)this.changeMap.set(n,Dt(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===o)this.changeMap.set(n,Mt(n,r.oldSnap));else if("child_changed"===t&&"child_added"===o)this.changeMap.set(n,At(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==o)throw Object(c.assertionError)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Dt(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),zn=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),Kn=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new cn(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Un(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:_n(this.viewCache_),o=Ln(this.writes_,r,t,1,n,e);return 0===o.length?null:o[0]},e}();function Hn(e,t,n,r,o){var l,h,d=new Wn;if(n.type===Xt.OVERWRITE){var f=n;f.source.fromUser?l=Qn(e,t,f.path,f.snap,r,o,d):(Object(c.assert)(f.source.fromServer,"Unknown source."),h=f.source.tagged||t.serverCache.isFiltered()&&!Ae(f.path),l=Gn(e,t,f.path,f.snap,r,o,h,d))}else if(n.type===Xt.MERGE){var _=n;_.source.fromUser?l=function(e,t,path,n,r,o,c){var l=t;return n.foreach((function(n,h){var d=Ne(path,n);$n(t,Ee(d))&&(l=Qn(e,l,d,h,r,o,c))})),n.foreach((function(n,h){var d=Ne(path,n);$n(t,Ee(d))||(l=Qn(e,l,d,h,r,o,c))})),l}(e,t,_.path,_.children,r,o,d):(Object(c.assert)(_.source.fromServer,"Unknown source."),h=_.source.tagged||t.serverCache.isFiltered(),l=Jn(e,t,_.path,_.children,r,o,h,d))}else if(n.type===Xt.ACK_USER_WRITE){var v=n;l=v.revert?function(e,t,path,n,r,o){var l;if(null!=Fn(n,path))return t;var source=new Kn(n,t,r),h=t.eventCache.getNode(),d=void 0;if(Ae(path)||".priority"===Ee(path)){var f=void 0;if(t.serverCache.isFullyInitialized())f=An(n,_n(t));else{var _=t.serverCache.getNode();Object(c.assert)(_ instanceof bt,"serverChildren would be complete if leaf node"),f=Mn(n,_)}d=e.filter.updateFullNode(h,f,o)}else{var v=Ee(path),m=Un(n,v,t.serverCache);null==m&&t.serverCache.isCompleteForChild(v)&&(m=h.getImmediateChild(v)),(d=null!=m?e.filter.updateChild(h,v,m,xe(path),source,o):t.eventCache.getNode().hasChild(v)?e.filter.updateChild(h,v,bt.EMPTY_NODE,xe(path),source,o):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(l=An(n,_n(t))).isLeafNode()&&(d=e.filter.updateFullNode(d,l,o))}return l=t.serverCache.isFullyInitialized()||null!=Fn(n,Ie()),dn(t,d,l,e.filter.filtersNodes())}(e,t,v.path,r,o,d):function(e,t,n,r,o,c,l){if(null!=Fn(o,n))return t;var h=t.serverCache.isFiltered(),d=t.serverCache;if(null!=r.value){if(Ae(n)&&d.isFullyInitialized()||d.isCompleteForPath(n))return Gn(e,t,n,d.getNode().getChild(n),o,c,h,l);if(Ae(n)){var f=new gn(null);return d.getNode().forEachChild(Ye,(function(e,t){f=f.set(new Te(e),t)})),Jn(e,t,n,f,o,c,h,l)}return t}var _=new gn(null);return r.foreach((function(e,t){var r=Ne(n,e);d.isCompleteForPath(r)&&(_=_.set(e,d.getNode().getChild(r)))})),Jn(e,t,n,_,o,c,h,l)}(e,t,v.path,v.affectedTree,r,o,d)}else{if(n.type!==Xt.LISTEN_COMPLETE)throw Object(c.assertionError)("Unknown operation type: "+n.type);l=function(e,t,path,n,r){var o=t.serverCache,c=pn(t,o.getNode(),o.isFullyInitialized()||Ae(path),o.isFiltered());return Vn(e,c,path,n,zn,r)}(e,t,n.path,r,d)}var m=d.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var o=r.getNode().isLeafNode()||r.getNode().isEmpty(),c=fn(e);(n.length>0||!e.eventCache.isFullyInitialized()||o&&!r.getNode().equals(c)||!r.getNode().getPriority().equals(c.getPriority()))&&n.push(Nt(fn(t)))}}(t,l,m),{viewCache:l,changes:m}}function Vn(e,t,n,r,source,o){var l=t.eventCache;if(null!=Fn(r,n))return t;var h=void 0,d=void 0;if(Ae(n))if(Object(c.assert)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var f=_n(t),_=Mn(r,f instanceof bt?f:bt.EMPTY_NODE);h=e.filter.updateFullNode(t.eventCache.getNode(),_,o)}else{var v=An(r,_n(t));h=e.filter.updateFullNode(t.eventCache.getNode(),v,o)}else{var m=Ee(n);if(".priority"===m){Object(c.assert)(1===Se(n),"Can't have a priority with additional path components");var y=l.getNode(),w=Dn(r,n,y,d=t.serverCache.getNode());h=null!=w?e.filter.updatePriority(y,w):l.getNode()}else{var k=xe(n),C=void 0;if(l.isCompleteForChild(m)){d=t.serverCache.getNode();var O=Dn(r,n,l.getNode(),d);C=null!=O?l.getNode().getImmediateChild(m).updateChild(k,O):l.getNode().getImmediateChild(m)}else C=Un(r,m,t.serverCache);h=null!=C?e.filter.updateChild(l.getNode(),m,C,k,source,o):l.getNode()}}return dn(t,h,l.isFullyInitialized()||Ae(n),e.filter.filtersNodes())}function Gn(e,t,n,r,o,c,l,h){var d,f=t.serverCache,_=l?e.filter:e.filter.getIndexedFilter();if(Ae(n))d=_.updateFullNode(f.getNode(),r,null);else if(_.filtersNodes()&&!f.isFiltered()){var v=f.getNode().updateChild(n,r);d=_.updateFullNode(f.getNode(),v,null)}else{var m=Ee(n);if(!f.isCompleteForPath(n)&&Se(n)>1)return t;var y=xe(n),w=f.getNode().getImmediateChild(m).updateChild(y,r);d=".priority"===m?_.updatePriority(f.getNode(),w):_.updateChild(f.getNode(),m,w,y,zn,null)}var k=pn(t,d,f.isFullyInitialized()||Ae(n),_.filtersNodes());return Vn(e,k,n,o,new Kn(o,k,c),h)}function Qn(e,t,n,r,o,c,l){var h,d,f=t.eventCache,source=new Kn(o,t,c);if(Ae(n))d=e.filter.updateFullNode(t.eventCache.getNode(),r,l),h=dn(t,d,!0,e.filter.filtersNodes());else{var _=Ee(n);if(".priority"===_)d=e.filter.updatePriority(t.eventCache.getNode(),r),h=dn(t,d,f.isFullyInitialized(),f.isFiltered());else{var v=xe(n),m=f.getNode().getImmediateChild(_),y=void 0;if(Ae(v))y=r;else{var w=source.getCompleteChild(_);y=null!=w?".priority"===Pe(v)&&w.getChild(Re(v)).isEmpty()?w:w.updateChild(v,r):bt.EMPTY_NODE}if(m.equals(y))h=t;else h=dn(t,e.filter.updateChild(f.getNode(),_,y,v,source,l),f.isFullyInitialized(),e.filter.filtersNodes())}}return h}function $n(e,t){return e.eventCache.isCompleteForChild(t)}function Yn(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function Jn(e,t,path,n,r,o,c,l){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var h,d=t;h=Ae(path)?n:new gn(null).setTree(path,n);var f=t.serverCache.getNode();return h.children.inorderTraversal((function(n,h){if(f.hasChild(n)){var _=Yn(0,t.serverCache.getNode().getImmediateChild(n),h);d=Gn(e,d,new Te(n),_,r,o,c,l)}})),h.children.inorderTraversal((function(n,h){var _=!t.serverCache.isCompleteForChild(n)&&void 0===h.value;if(!f.hasChild(n)&&!_){var v=Yn(0,t.serverCache.getNode().getImmediateChild(n),h);d=Gn(e,d,new Te(n),v,r,o,c,l)}})),d}var Xn,Zn=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n,r=this.query_._queryParams,o=new Ft(r.getIndex()),filter=(n=r).loadsAllData()?new Ft(n.getIndex()):n.hasLimit()?new Ut(n):new Lt(n);this.processor_=function(filter){return{filter:filter}}(filter);var c=t.serverCache,l=t.eventCache,h=o.updateFullNode(bt.EMPTY_NODE,c.getNode(),null),d=filter.updateFullNode(bt.EMPTY_NODE,l.getNode(),null),f=new cn(h,c.isFullyInitialized(),o.filtersNodes()),_=new cn(d,l.isFullyInitialized(),filter.filtersNodes());this.viewCache_=hn(_,f),this.eventGenerator_=new un(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function er(view,path){var e=_n(view.viewCache_);return e&&(view.query._queryParams.loadsAllData()||!Ae(path)&&!e.getImmediateChild(Ee(path)).isEmpty())?e.getChild(path):null}function nr(view){return 0===view.eventRegistrations_.length}function rr(view,e,t){var n=[];if(t){Object(c.assert)(null==e,"A cancel should cancel all event registrations.");var r=view.query._path;view.eventRegistrations_.forEach((function(e){var o=e.createCancelEvent(t,r);o&&n.push(o)}))}if(e){for(var o=[],i=0;i<view.eventRegistrations_.length;++i){var l=view.eventRegistrations_[i];if(l.matches(e)){if(e.hasAnyCallback()){o=o.concat(view.eventRegistrations_.slice(i+1));break}}else o.push(l)}view.eventRegistrations_=o}else view.eventRegistrations_=[];return n}function ir(view,e,t,n){e.type===Xt.MERGE&&null!==e.source.queryId&&(Object(c.assert)(_n(view.viewCache_),"We should always have a full cache before handling merges"),Object(c.assert)(fn(view.viewCache_),"Missing event cache, even though we have a server cache"));var r,o,l=view.viewCache_,h=Hn(view.processor_,l,e,t,n);return r=view.processor_,o=h.viewCache,Object(c.assert)(o.eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),Object(c.assert)(o.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),Object(c.assert)(h.viewCache.serverCache.isFullyInitialized()||!l.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),view.viewCache_=h.viewCache,or(view,h.changes,h.viewCache.eventCache.getNode(),null)}function or(view,e,t,n){var r=n?[n]:view.eventRegistrations_;return function(e,t,n,r){var o=[],c=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&c.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),ln(e,o,"child_removed",t,r,n),ln(e,o,"child_added",t,r,n),ln(e,o,"child_moved",c,r,n),ln(e,o,"child_changed",t,r,n),ln(e,o,"value",t,r,n),o}(view.eventGenerator_,e,t,r)}var ar,sr=function(){this.views=new Map};function cr(e,t,n,r){var o,h,d=t.source.queryId;if(null!==d){var view=e.views.get(d);return Object(c.assert)(null!=view,"SyncTree gave us an op for an invalid query."),ir(view,t,n,r)}var f=[];try{for(var _=Object(l.__values)(e.views.values()),v=_.next();!v.done;v=_.next()){view=v.value;f=f.concat(ir(view,t,n,r))}}catch(e){o={error:e}}finally{try{v&&!v.done&&(h=_.return)&&h.call(_)}finally{if(o)throw o.error}}return f}function ur(e,t,n,r,o){var c=t._queryIdentifier,view=e.views.get(c);if(!view){var l=An(n,o?r:null),h=!1;l?h=!0:r instanceof bt?(l=Mn(n,r),h=!1):(l=bt.EMPTY_NODE,h=!1);var d=hn(new cn(l,h,!1),new cn(r,o,!1));return new Zn(t,d)}return view}function lr(e,t,n,r,o,c){var view=ur(e,t,r,o,c);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,view),function(view,e){view.eventRegistrations_.push(e)}(view,n),function(view,e){var t=view.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ft,(function(e,t){n.push(At(e,t))})),t.isFullyInitialized()&&n.push(Nt(t.getNode())),or(view,n,t.getNode(),e)}(view,n)}function dr(e,t,n,r){var o,h,d=t._queryIdentifier,f=[],_=[],v=vr(e);if("default"===d)try{for(var m=Object(l.__values)(e.views.entries()),y=m.next();!y.done;y=m.next()){var w=Object(l.__read)(y.value,2),k=w[0],view=w[1];_=_.concat(rr(view,n,r)),nr(view)&&(e.views.delete(k),view.query._queryParams.loadsAllData()||f.push(view.query))}}catch(e){o={error:e}}finally{try{y&&!y.done&&(h=m.return)&&h.call(m)}finally{if(o)throw o.error}}else(view=e.views.get(d))&&(_=_.concat(rr(view,n,r)),nr(view)&&(e.views.delete(d),view.query._queryParams.loadsAllData()||f.push(view.query)));return v&&!vr(e)&&f.push(new(Object(c.assert)(Xn,"Reference.ts has not been loaded"),Xn)(t._repo,t._path)),{removed:f,events:_}}function pr(e){var t,n,r=[];try{for(var o=Object(l.__values)(e.views.values()),c=o.next();!c.done;c=o.next()){var view=c.value;view.query._queryParams.loadsAllData()||r.push(view)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function fr(e,path){var t,n,r=null;try{for(var o=Object(l.__values)(e.views.values()),c=o.next();!c.done;c=o.next()){var view=c.value;r=r||er(view,path)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function _r(e,t){if(t._queryParams.loadsAllData())return mr(e);var n=t._queryIdentifier;return e.views.get(n)}function gr(e,t){return null!=_r(e,t)}function vr(e){return null!=mr(e)}function mr(e){var t,n;try{for(var r=Object(l.__values)(e.views.values()),o=r.next();!o.done;o=r.next()){var view=o.value;if(view.query._queryParams.loadsAllData())return view}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}var yr=1,wr=function(e){this.listenProvider_=e,this.syncPointTree_=new gn(null),this.pendingWriteTree_={visibleWrites:vn.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function kr(e,path,t,n,r){return function(e,path,t,n,r){Object(c.assert)(n>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:path,snap:t,writeId:n,visible:r}),r&&(e.visibleWrites=mn(e.visibleWrites,path,t)),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n,r),r?Pr(e,new an({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,t)):[]}function Cr(e,path,t,n){!function(e,path,t,n){Object(c.assert)(n>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:path,children:t,writeId:n,visible:!0}),e.visibleWrites=yn(e.visibleWrites,path,t),e.lastWriteId=n}(e.pendingWriteTree_,path,t,n);var r=gn.fromObject(t);return Pr(e,new sn({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},path,r))}function Or(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var i=0;i<e.allWrites.length;i++){var n=e.allWrites[i];if(n.writeId===t)return n}return null}(e.pendingWriteTree_,t);if(xn(e.pendingWriteTree_,t)){var o=new gn(null);return null!=r.snap?o=o.set(Ie(),!0):K(r.children,(function(e){o=o.set(new Te(e),!0)})),Pr(e,new rn(r.path,o,n))}return[]}function Tr(e,path,t){return Pr(e,new an({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,t))}function Ir(e,t,n,r){var path=t._path,o=e.syncPointTree_.get(path),c=[];if(o&&("default"===t._queryIdentifier||gr(o,t))){var l=dr(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(path));var h=l.removed;c=l.events;var d=-1!==h.findIndex((function(e){return e._queryParams.loadsAllData()})),f=e.syncPointTree_.findOnPath(path,(function(e,t){return vr(t)}));if(d&&!f){var _=e.syncPointTree_.subtree(path);if(!_.isEmpty())for(var v=function(e){return e.fold((function(e,t,n){if(t&&vr(t))return[mr(t)];var r=[];return t&&(r=pr(t)),K(n,(function(e,t){r=r.concat(t)})),r}))}(_),i=0;i<v.length;++i){var view=v[i],m=view.query,y=Nr(e,view);e.listenProvider_.startListening(Ur(m),Ar(e,m),y.hashFn,y.onComplete)}}if(!f&&h.length>0&&!r)if(d){e.listenProvider_.stopListening(Ur(t),null)}else h.forEach((function(t){var n=e.queryToTagMap.get(Mr(t));e.listenProvider_.stopListening(Ur(t),n)}));!function(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var o=Mr(r),c=e.queryToTagMap.get(o);e.queryToTagMap.delete(o),e.tagToQueryMap.delete(c)}}}(e,h)}return c}function Er(e,t,n){var path=t._path,r=null,o=!1;e.syncPointTree_.foreachOnPath(path,(function(e,t){var n=Me(e,path);r=r||fr(t,n),o=o||vr(t)}));var l,h=e.syncPointTree_.get(path);(h?(o=o||vr(h),r=r||fr(h,Ie())):(h=new sr,e.syncPointTree_=e.syncPointTree_.set(path,h)),null!=r)?l=!0:(l=!1,r=bt.EMPTY_NODE,e.syncPointTree_.subtree(path).foreachChild((function(e,t){var n=fr(t,Ie());n&&(r=r.updateImmediateChild(e,n))})));var d=gr(h,t);if(!d&&!t._queryParams.loadsAllData()){var f=Mr(t);Object(c.assert)(!e.queryToTagMap.has(f),"View does not exist, but we have a tag");var _=yr++;e.queryToTagMap.set(f,_),e.tagToQueryMap.set(_,f)}var v=lr(h,t,n,Sn(e.pendingWriteTree_,path),r,l);if(!d&&!o){var view=_r(h,t);v=v.concat(function(e,t,view){var path=t._path,n=Ar(e,t),r=Nr(e,view),o=e.listenProvider_.startListening(Ur(t),n,r.hashFn,r.onComplete),l=e.syncPointTree_.subtree(path);if(n)Object(c.assert)(!vr(l.value),"If we're adding a query, it shouldn't be shadowed");else for(var h=l.fold((function(e,t,n){if(!Ae(e)&&t&&vr(t))return[mr(t).query];var r=[];return t&&(r=r.concat(pr(t).map((function(view){return view.query})))),K(n,(function(e,t){r=r.concat(t)})),r})),i=0;i<h.length;++i){var d=h[i];e.listenProvider_.stopListening(Ur(d),Ar(e,d))}return o}(e,t,view))}return v}function Sr(e,path,t){var n=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(path,(function(e,t){var n=fr(t,Me(e,path));if(n)return n}));return Nn(n,path,r,t,!0)}function xr(e,t){var path=t._path,n=null;e.syncPointTree_.foreachOnPath(path,(function(e,t){var r=Me(e,path);n=n||fr(t,r)}));var r=e.syncPointTree_.get(path);r?n=n||fr(r,Ie()):(r=new sr,e.syncPointTree_=e.syncPointTree_.set(path,r));var o=null!=n,c=o?new cn(n,!0,!1):null;return function(view){return fn(view.viewCache_)}(ur(r,t,Sn(e.pendingWriteTree_,t._path),o?c.getNode():bt.EMPTY_NODE,o))}function Pr(e,t){return jr(t,e.syncPointTree_,null,Sn(e.pendingWriteTree_,Ie()))}function jr(e,t,n,r){if(Ae(e.path))return Rr(e,t,n,r);var o=t.get(Ie());null==n&&null!=o&&(n=fr(o,Ie()));var c=[],l=Ee(e.path),h=e.operationForChild(l),d=t.children.get(l);if(d&&h){var f=n?n.getImmediateChild(l):null,_=qn(r,l);c=c.concat(jr(h,d,f,_))}return o&&(c=c.concat(cr(o,e,r,n))),c}function Rr(e,t,n,r){var o=t.get(Ie());null==n&&null!=o&&(n=fr(o,Ie()));var c=[];return t.children.inorderTraversal((function(t,o){var l=n?n.getImmediateChild(t):null,h=qn(r,t),d=e.operationForChild(t);d&&(c=c.concat(Rr(d,o,l,h)))})),o&&(c=c.concat(cr(o,e,r,n))),c}function Nr(e,view){var t=view.query,n=Ar(e,t);return{hashFn:function(){var e=function(view){return view.viewCache_.serverCache.getNode()}(view)||bt.EMPTY_NODE;return e.hash()},onComplete:function(r){if("ok"===r)return n?function(e,path,t){var n=Dr(e,t);if(n){var r=Fr(n),o=r.path,c=r.queryId,l=Me(o,path);return Lr(e,o,new on(tn(c),l))}return[]}(e,t._path,n):function(e,path){return Pr(e,new on({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path))}(e,t._path);var o=function(code,e){var t="Unknown Error";"too_big"===code?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===code?t="Client doesn't have permission to access the desired data.":"unavailable"===code&&(t="The service is unavailable");var n=new Error(code+" at "+e._path.toString()+": "+t);return n.code=code.toUpperCase(),n}(r,t);return Ir(e,t,null,o)}}}function Ar(e,t){var n=Mr(t);return e.queryToTagMap.get(n)}function Mr(e){return e._path.toString()+"$"+e._queryIdentifier}function Dr(e,t){return e.tagToQueryMap.get(t)}function Fr(e){var t=e.indexOf("$");return Object(c.assert)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new Te(e.substr(0,t))}}function Lr(e,t,n){var r=e.syncPointTree_.get(t);return Object(c.assert)(r,"Missing sync point for query tag that we're tracking"),cr(r,n,Sn(e.pendingWriteTree_,t),null)}function Ur(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(Object(c.assert)(ar,"Reference.ts has not been loaded"),ar)(e._repo,e._path):e}var qr=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),Br=function(){function e(e,path){this.syncTree_=e,this.path_=path}return e.prototype.getImmediateChild=function(t){var n=Ne(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return Sr(this.syncTree_,this.path_)},e}(),Wr=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},zr=function(e,t,n){return e&&"object"==typeof e?(Object(c.assert)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Kr(e[".sv"],t,n):"object"==typeof e[".sv"]?Hr(e[".sv"],t):void Object(c.assert)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Kr=function(e,t,n){if("timestamp"===e)return n.timestamp;Object(c.assert)(!1,"Unexpected server value: "+e)},Hr=function(e,t,n){e.hasOwnProperty("increment")||Object(c.assert)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&Object(c.assert)(!1,"Unexpected increment value: "+r);var o=t.node();if(Object(c.assert)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return r;var l=o.getValue();return"number"!=typeof l?r:l+r},Vr=function(path,e,t,n){return Qr(e,new Br(t,path),n)},Gr=function(e,t,n){return Qr(e,new qr(t),n)};function Qr(e,t,n){var r,o=e.getPriority().val(),c=zr(o,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var l=e,h=zr(l.getValue(),t,n);return h!==l.getValue()||c!==l.getPriority().val()?new ut(h,Ct(c)):e}var d=e;return r=d,c!==d.getPriority().val()&&(r=r.updatePriority(new ut(c))),d.forEachChild(ft,(function(e,o){var c=Qr(o,t.getImmediateChild(e),n);c!==o&&(r=r.updateImmediateChild(e,c))})),r}var $r=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n};function Yr(e,t){for(var path=t instanceof Te?t:new Te(t),n=e,r=Ee(path);null!==r;){var o=Object(c.safeGet)(n.node.children,r)||{children:{},childCount:0};n=new $r(r,n,o),r=Ee(path=xe(path))}return n}function Jr(e){return e.node.value}function Xr(e,t){e.node.value=t,ri(e)}function Zr(e){return e.node.childCount>0}function ei(e,t){K(e.node.children,(function(n,r){t(new $r(n,e,r))}))}function ti(e,t,n,r){n&&!r&&t(e),ei(e,(function(e){ti(e,t,!0,r)})),n&&r&&t(e)}function ni(e){return new Te(null===e.parent?e.name:ni(e.parent)+"/"+e.name)}function ri(e){null!==e.parent&&function(e,t,n){var r=function(e){return void 0===Jr(e)&&!Zr(e)}(n),o=Object(c.contains)(e.node.children,t);r&&o?(delete e.node.children[t],e.node.childCount--,ri(e)):r||o||(e.node.children[t]=n.node,e.node.childCount++,ri(e))}(e.parent,e.name,e)}var ii=/[\[\].#$\/\u0000-\u001F\u007F]/,oi=/[\[\].#$\u0000-\u001F\u007F]/,ai=10485760,si=function(e){return"string"==typeof e&&0!==e.length&&!ii.test(e)},ci=function(e){return"string"==typeof e&&0!==e.length&&!oi.test(e)},ui=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!M(e)||e&&"object"==typeof e&&Object(c.contains)(e,".sv")},hi=function(e,t,path,n){n&&void 0===t||di(Object(c.errorPrefix)(e,"value"),t,path)},di=function(e,data,t){var path=t instanceof Te?new Ue(t,e):t;if(void 0===data)throw new Error(e+"contains undefined "+Be(path));if("function"==typeof data)throw new Error(e+"contains a function "+Be(path)+" with contents = "+data.toString());if(M(data))throw new Error(e+"contains "+data.toString()+" "+Be(path));if("string"==typeof data&&data.length>ai/3&&Object(c.stringLength)(data)>ai)throw new Error(e+"contains a string greater than "+ai+" utf8 bytes "+Be(path)+" ('"+data.substring(0,50)+"...')");if(data&&"object"==typeof data){var n=!1,r=!1;if(K(data,(function(t,o){if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!si(t)))throw new Error(e+" contains an invalid key ("+t+") "+Be(path)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var l,h;!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=Object(c.stringLength)(t),qe(e)}(path,t),di(e,o,path),h=(l=path).parts_.pop(),l.byteLength_-=Object(c.stringLength)(h),l.parts_.length>0&&(l.byteLength_-=1)})),n&&r)throw new Error(e+' contains ".value" child '+Be(path)+" in addition to actual children.")}},pi=function(e,data,path,t){if(!t||void 0!==data){var n=Object(c.errorPrefix)(e,"values");if(!data||"object"!=typeof data||Array.isArray(data))throw new Error(n+" must be an object containing the children to replace.");var r=[];K(data,(function(e,t){var o=new Te(e);if(di(n,t,Ne(path,o)),".priority"===Pe(o)&&!ui(t))throw new Error(n+"contains an invalid value for '"+o.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(o)})),function(e,t){var i,n;for(i=0;i<t.length;i++)for(var r=je(n=t[i]),o=0;o<r.length;o++)if(".priority"===r[o]&&o===r.length-1);else if(!si(r[o]))throw new Error(e+"contains an invalid key ("+r[o]+") in path "+n.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(De);var c=null;for(i=0;i<t.length;i++){if(n=t[i],null!==c&&Le(c,n))throw new Error(e+"contains a path "+c.toString()+" that is ancestor of another path "+n.toString());c=n}}(n,r)}},fi=function(e,t,n){if(!n||void 0!==t){if(M(t))throw new Error(Object(c.errorPrefix)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!ui(t))throw new Error(Object(c.errorPrefix)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},_i=function(e,t,n,r){if(!(r&&void 0===n||si(n)))throw new Error(Object(c.errorPrefix)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},gi=function(e,t,n,r){if(!(r&&void 0===n||ci(n)))throw new Error(Object(c.errorPrefix)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},vi=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),gi(e,t,n,r)},mi=function(e,path){if(".info"===Ee(path))throw new Error(e+" failed = Can't modify data under /.info/")},yi=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!si(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),ci(e)}(n))throw new Error(Object(c.errorPrefix)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},bi=function(){this.eventLists_=[],this.recursionDepth_=0};function wi(e,t){for(var n=null,i=0;i<t.length;i++){var data=t[i],path=data.getPath();null===n||Fe(path,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:path}),n.events.push(data)}n&&e.eventLists_.push(n)}function ki(e,path,t){wi(e,t),Oi(e,(function(e){return Fe(e,path)}))}function Ci(e,t,n){wi(e,n),Oi(e,(function(e){return Le(e,t)||Le(t,e)}))}function Oi(e,t){e.recursionDepth_++;for(var n=!0,i=0;i<e.eventLists_.length;i++){var r=e.eventLists_[i];if(r)t(r.path)?(Ti(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}n&&(e.eventLists_=[]),e.recursionDepth_--}function Ti(e){for(var i=0;i<e.events.length;i++){var t=e.events[i];if(null!==t){e.events[i]=null;var n=t.getEventRunner();E&&P("event: "+t.toString()),Y(n)}}}var Ii="repo_interrupt",Ei=25,Si=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new bi,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Qt(),this.transactionQueueTree_=new $r,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function xi(e,t,n){if(e.stats_=he(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Vt(e.repoInfo_,(function(t,data,n,r){Ri(e,t,data,n,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((function(){return Ni(e,!0)}),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(c.stringify)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Ve(e.repoInfo_,t,(function(t,data,n,r){Ri(e,t,data,n,r)}),(function(t){Ni(e,t)}),(function(t){!function(e,t){K(t,(function(t,n){Ai(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}var r,o,l;e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((function(t){e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=(r=e.repoInfo_,o=function(){return new en(e.stats_,e.server_)},l=r.toString(),le[l]||(le[l]=o()),le[l]),e.infoData_=new Gt,e.infoSyncTree_=new wr({startListening:function(t,n,r,o){var c=[],l=e.infoData_.getNode(t._path);return l.isEmpty()||(c=Tr(e.infoSyncTree_,t._path,l),setTimeout((function(){o("ok")}),0)),c},stopListening:function(){}}),Ai(e,"connected",!1),e.serverSyncTree_=new wr({startListening:function(t,n,r,o){return e.server_.listen(t,r,n,(function(n,data){var r=o(n,data);Ci(e.eventQueue_,t._path,r)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}function Pi(e){var t=e.infoData_.getNode(new Te(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ji(e){return Wr({timestamp:Pi(e)})}function Ri(e,t,data,n,r){e.dataUpdateCount++;var path=new Te(t);data=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,data):data;var o=[];if(r)if(n){var l=Object(c.map)(data,(function(e){return Ct(e)}));o=function(e,path,t,n){var r=Dr(e,n);if(r){var o=Fr(r),c=o.path,l=o.queryId,h=Me(c,path),d=gn.fromObject(t);return Lr(e,c,new sn(tn(l),h,d))}return[]}(e.serverSyncTree_,path,l,r)}else{var h=Ct(data);o=function(e,path,t,n){var r=Dr(e,n);if(null!=r){var o=Fr(r),c=o.path,l=o.queryId,h=Me(c,path);return Lr(e,c,new an(tn(l),h,t))}return[]}(e.serverSyncTree_,path,h,r)}else if(n){var d=Object(c.map)(data,(function(e){return Ct(e)}));o=function(e,path,t){var n=gn.fromObject(t);return Pr(e,new sn({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},path,n))}(e.serverSyncTree_,path,d)}else{var f=Ct(data);o=Tr(e.serverSyncTree_,path,f)}var _=path;o.length>0&&(_=Hi(e,path)),Ci(e.eventQueue_,_,o)}function Ni(e,t){Ai(e,"connected",t),!1===t&&function(e){Bi(e,"onDisconnectEvents");var t=ji(e),n=Qt();Jt(e.onDisconnect_,Ie(),(function(path,r){var o=Vr(path,r,e.serverSyncTree_,t);$t(n,path,o)}));var r=[];Jt(n,Ie(),(function(path,t){r=r.concat(Tr(e.serverSyncTree_,path,t));var n=Yi(e,path);Hi(e,n)})),e.onDisconnect_=Qt(),Ci(e.eventQueue_,Ie(),r)}(e)}function Ai(e,t,n){var path=new Te("/.info/"+t),r=Ct(n);e.infoData_.updateSnapshot(path,r);var o=Tr(e.infoSyncTree_,path,r);Ci(e.eventQueue_,path,o)}function Mi(e){return e.nextWriteId_++}function Di(e,path,t,n,r){Bi(e,"set",{path:path.toString(),value:t,priority:n});var o=ji(e),c=Ct(t,n),l=Sr(e.serverSyncTree_,path),h=Gr(c,l,o),d=Mi(e),f=kr(e.serverSyncTree_,path,h,d,!0);wi(e.eventQueue_,f),e.server_.put(path.toString(),c.val(!0),(function(t,n){var o="ok"===t;o||A("set at "+path+" failed: "+t);var c=Or(e.serverSyncTree_,d,!o);Ci(e.eventQueue_,path,c),Wi(e,r,t,n)}));var _=Yi(e,path);Hi(e,_),Ci(e.eventQueue_,_,[])}function Fi(e,path,t){e.server_.onDisconnectCancel(path.toString(),(function(n,r){"ok"===n&&Yt(e.onDisconnect_,path),Wi(e,t,n,r)}))}function Li(e,path,t,n){var r=Ct(t);e.server_.onDisconnectPut(path.toString(),r.val(!0),(function(t,o){"ok"===t&&$t(e.onDisconnect_,path,r),Wi(e,n,t,o)}))}function Ui(e,t,n){var r;r=".info"===Ee(t._path)?Ir(e.infoSyncTree_,t,n):Ir(e.serverSyncTree_,t,n),ki(e.eventQueue_,t._path,r)}function qi(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Ii)}function Bi(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),P.apply(void 0,Object(l.__spreadArray)([r],Object(l.__read)(t)))}function Wi(e,t,n,r){t&&Y((function(){if("ok"===n)t(null);else{var code=(n||"error").toUpperCase(),e=code;r&&(e+=": "+r);var o=new Error(e);o.code=code,t(o)}}))}function zi(e,path,t){return Sr(e.serverSyncTree_,path,t)||bt.EMPTY_NODE}function Ki(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||$i(e,t),Jr(t)){var n=Gi(e,t);Object(c.assert)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return 0===e.status}))&&function(e,path,t){for(var n=t.map((function(e){return e.currentWriteId})),r=zi(e,path,n),o=r,l=r.hash(),i=0;i<t.length;i++){var h=t[i];Object(c.assert)(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var d=Me(path,h.path);o=o.updateChild(d,h.currentOutputSnapshotRaw)}var f=o.val(!0),_=path;e.server_.put(_.toString(),f,(function(n){Bi(e,"transaction put response",{path:_.toString(),status:n});var r=[];if("ok"===n){for(var o=[],c=function(i){t[i].status=2,r=r.concat(Or(e.serverSyncTree_,t[i].currentWriteId)),t[i].onComplete&&o.push((function(){return t[i].onComplete(null,!0,t[i].currentOutputSnapshotResolved)})),t[i].unwatcher()},i=0;i<t.length;i++)c(i);$i(e,Yr(e.transactionQueueTree_,path)),Ki(e,e.transactionQueueTree_),Ci(e.eventQueue_,path,r);for(i=0;i<o.length;i++)Y(o[i])}else{if("datastale"===n)for(i=0;i<t.length;i++)3===t[i].status?t[i].status=4:t[i].status=0;else{A("transaction at "+_.toString()+" failed: "+n);for(i=0;i<t.length;i++)t[i].status=4,t[i].abortReason=n}Hi(e,path)}}),l)}(e,ni(t),n)}else Zr(t)&&ei(t,(function(t){Ki(e,t)}))}function Hi(e,t){var n=Vi(e,t),path=ni(n);return function(e,t,path){if(0===t.length)return;for(var n=[],r=[],o=t.filter((function(q){return 0===q.status})).map((function(q){return q.currentWriteId})),l=function(i){var l,h,d=t[i],f=Me(path,d.path),_=!1;if(Object(c.assert)(null!==f,"rerunTransactionsUnderNode_: relativePath should not be null."),4===d.status)_=!0,l=d.abortReason,r=r.concat(Or(e.serverSyncTree_,d.currentWriteId,!0));else if(0===d.status)if(d.retryCount>=Ei)_=!0,l="maxretry",r=r.concat(Or(e.serverSyncTree_,d.currentWriteId,!0));else{var v=zi(e,d.path,o);d.currentInputSnapshot=v;var m=t[i].update(v.val());if(void 0!==m){di("transaction failed: Data returned ",m,d.path);var y=Ct(m);"object"==typeof m&&null!=m&&Object(c.contains)(m,".priority")||(y=y.updatePriority(v.getPriority()));var w=d.currentWriteId,k=ji(e),C=Gr(y,v,k);d.currentOutputSnapshotRaw=y,d.currentOutputSnapshotResolved=C,d.currentWriteId=Mi(e),o.splice(o.indexOf(w),1),r=(r=r.concat(kr(e.serverSyncTree_,d.path,C,d.currentWriteId,d.applyLocally))).concat(Or(e.serverSyncTree_,w,!0))}else _=!0,l="nodata",r=r.concat(Or(e.serverSyncTree_,d.currentWriteId,!0))}Ci(e.eventQueue_,path,r),r=[],_&&(t[i].status=2,h=t[i].unwatcher,setTimeout(h,Math.floor(0)),t[i].onComplete&&("nodata"===l?n.push((function(){return t[i].onComplete(null,!1,t[i].currentInputSnapshot)})):n.push((function(){return t[i].onComplete(new Error(l),!1,null)}))))},i=0;i<t.length;i++)l(i);$i(e,e.transactionQueueTree_);for(i=0;i<n.length;i++)Y(n[i]);Ki(e,e.transactionQueueTree_)}(e,Gi(e,n),path),path}function Vi(e,path){var t,n=e.transactionQueueTree_;for(t=Ee(path);null!==t&&void 0===Jr(n);)n=Yr(n,t),t=Ee(path=xe(path));return n}function Gi(e,t){var n=[];return Qi(e,t,n),n.sort((function(a,b){return a.order-b.order})),n}function Qi(e,t,n){var r=Jr(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);ei(t,(function(t){Qi(e,t,n)}))}function $i(e,t){var n=Jr(t);if(n){for(var r=0,o=0;o<n.length;o++)2!==n[o].status&&(n[r]=n[o],r++);n.length=r,Xr(t,n.length>0?n:void 0)}ei(t,(function(t){$i(e,t)}))}function Yi(e,path){var t=ni(Vi(e,path)),n=Yr(e.transactionQueueTree_,path);return function(e,t,n){for(var r=n?e:e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(n,(function(t){Ji(e,t)})),Ji(e,n),ti(n,(function(t){Ji(e,t)})),t}function Ji(e,t){var n=Jr(t);if(n){for(var r=[],o=[],l=-1,i=0;i<n.length;i++)3===n[i].status||(1===n[i].status?(Object(c.assert)(l===i-1,"All SENT items should be at beginning of queue."),l=i,n[i].status=3,n[i].abortReason="set"):(Object(c.assert)(0===n[i].status,"Unexpected transaction status in abort"),n[i].unwatcher(),o=o.concat(Or(e.serverSyncTree_,n[i].currentWriteId,!0)),n[i].onComplete&&r.push(n[i].onComplete.bind(null,new Error("set"),!1,null))));-1===l?Xr(t,void 0):n.length=l+1,Ci(e.eventQueue_,ni(t),o);for(i=0;i<r.length;i++)Y(r[i])}}var Xi=function(e,t){var n=Zi(e),r=n.namespace;"firebase.com"===n.domain&&N(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||N("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&A("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var o="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ae(n.host,n.secure,r,t,o,"",r!==n.subdomain),path:new Te(n.pathString)}},Zi=function(e){var t="",n="",r="",o="",c="",h=!0,d="https",f=443;if("string"==typeof e){var _=e.indexOf("//");_>=0&&(d=e.substring(0,_-1),e=e.substring(_+2));var v=e.indexOf("/");-1===v&&(v=e.length);var m=e.indexOf("?");-1===m&&(m=e.length),t=e.substring(0,Math.min(v,m)),v<m&&(o=function(e){for(var t="",n=e.split("/"),i=0;i<n.length;i++)if(n[i].length>0){var r=n[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(v,m)));var y=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var o=Object(l.__values)(e.split("&")),c=o.next();!c.done;c=o.next()){var h=c.value;if(0!==h.length){var d=h.split("=");2===d.length?r[decodeURIComponent(d[0])]=decodeURIComponent(d[1]):A("Invalid query segment '"+h+"' in query '"+e+"'")}}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,m)));(_=t.indexOf(":"))>=0?(h="https"===d||"wss"===d,f=parseInt(t.substring(_+1),10)):_=t.length;var w=t.slice(0,_);if("localhost"===w.toLowerCase())n="localhost";else if(w.split(".").length<=2)n=w;else{var k=t.indexOf(".");r=t.substring(0,k).toLowerCase(),n=t.substring(k+1),c=r}"ns"in y&&(c=y.ns)}return{host:t,port:f,domain:n,subdomain:r,secure:h,scheme:d,pathString:o,namespace:c}},eo=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(c.stringify)(this.snapshot.exportVal())},e}(),to=function(){function e(e,t,path){this.eventRegistration=e,this.error=t,this.path=path}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),no=function(){function e(e,t){this.snapshotCallback=e,this.cancelCallback=t}return e.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},e.prototype.onCancel=function(e){return Object(c.assert)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(e.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),e.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},e}(),ro=function(){function e(e,t){this._repo=e,this._path=t}return e.prototype.cancel=function(){var e=new c.Deferred;return Fi(this._repo,this._path,e.wrapCallback((function(){}))),e.promise},e.prototype.remove=function(){mi("OnDisconnect.remove",this._path);var e=new c.Deferred;return Li(this._repo,this._path,null,e.wrapCallback((function(){}))),e.promise},e.prototype.set=function(e){mi("OnDisconnect.set",this._path),hi("OnDisconnect.set",e,this._path,!1);var t=new c.Deferred;return Li(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e.prototype.setWithPriority=function(e,t){mi("OnDisconnect.setWithPriority",this._path),hi("OnDisconnect.setWithPriority",e,this._path,!1),fi("OnDisconnect.setWithPriority",t,!1);var n=new c.Deferred;return function(e,path,t,n,r){var o=Ct(t,n);e.server_.onDisconnectPut(path.toString(),o.val(!0),(function(t,n){"ok"===t&&$t(e.onDisconnect_,path,o),Wi(0,r,t,n)}))}(this._repo,this._path,e,t,n.wrapCallback((function(){}))),n.promise},e.prototype.update=function(e){mi("OnDisconnect.update",this._path),pi("OnDisconnect.update",e,this._path,!1);var t=new c.Deferred;return function(e,path,t,n){if(Object(c.isEmpty)(t))return P("onDisconnect().update() called with empty data.  Don't do anything."),void Wi(0,n,"ok",void 0);e.server_.onDisconnectMerge(path.toString(),t,(function(r,o){"ok"===r&&K(t,(function(t,n){var r=Ct(n);$t(e.onDisconnect_,Ne(path,t),r)})),Wi(0,n,r,o)}))}(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e}(),io=function(){function e(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(e.prototype,"key",{get:function(){return Ae(this._path)?null:Pe(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new co(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryIdentifier",{get:function(){var e=Ht(this._queryParams),t=W(e);return"{}"===t?"default":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryObject",{get:function(){return Ht(this._queryParams)},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!((t=Object(c.getModularInstance)(t))instanceof e))return!1;var n=this._repo===t._repo,r=Fe(this._path,t._path),o=this._queryIdentifier===t._queryIdentifier;return n&&r&&o},e.prototype.toJSON=function(){return this.toString()},e.prototype.toString=function(){return this._repo.toString()+function(path){for(var e="",i=path.pieceNum_;i<path.pieces_.length;i++)""!==path.pieces_[i]&&(e+="/"+encodeURIComponent(String(path.pieces_[i])));return e||"/"}(this._path)},e}();function oo(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function ao(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Ye){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==D)throw new Error(r);if("string"!=typeof t)throw new Error(o)}if(e.hasEnd()){if(e.getIndexEndName()!==F)throw new Error(r);if("string"!=typeof n)throw new Error(o)}}else if(e.getIndex()===ft){if(null!=t&&!ui(t)||null!=n&&!ui(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(c.assert)(e.getIndex()instanceof It||e.getIndex()===St,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function so(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var co=function(e){function t(t,path){return e.call(this,t,path,new qt,!1)||this}return Object(l.__extends)(t,e),Object.defineProperty(t.prototype,"parent",{get:function(){var e=Re(this._path);return null===e?null:new t(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),t}(io),uo=function(){function e(e,t,n){this._node=e,this.ref=t,this._index=n}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),e.prototype.child=function(path){var t=new Te(path),n=po(this.ref,path);return new e(this._node.getChild(t),n,ft)},e.prototype.exists=function(){return!this._node.isEmpty()},e.prototype.exportVal=function(){return this._node.val(!0)},e.prototype.forEach=function(t){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(function(r,o){return t(new e(o,po(n.ref,r),ft))}))},e.prototype.hasChild=function(path){var e=new Te(path);return!this._node.getChild(e).isEmpty()},e.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},e.prototype.toJSON=function(){return this.exportVal()},e.prototype.val=function(){return this._node.val()},e}();function lo(e,path){return(e=Object(c.getModularInstance)(e))._checkNotDeleted("ref"),void 0!==path?po(e._root,path):e._root}function ho(e,t){(e=Object(c.getModularInstance)(e))._checkNotDeleted("refFromURL");var n=Xi(t,e._repo.repoInfo_.nodeAdmin);yi("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||N("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),lo(e,n.path.toString())}function po(e,path){return null===Ee((e=Object(c.getModularInstance)(e))._path)?vi("child","path",path,!1):gi("child","path",path,!1),new co(e._repo,Ne(e._path,path))}function fo(e,t){e=Object(c.getModularInstance)(e),mi("set",e._path),hi("set",t,e._path,!1);var n=new c.Deferred;return Di(e._repo,e._path,t,null,n.wrapCallback((function(){}))),n.promise}function _o(e,t){pi("update",t,e._path,!1);var n=new c.Deferred;return function(e,path,t,n){Bi(e,"update",{path:path.toString(),value:t});var r=!0,o=ji(e),c={};if(K(t,(function(t,n){r=!1,c[t]=Vr(Ne(path,t),Ct(n),e.serverSyncTree_,o)})),r)P("update() called with empty data.  Don't do anything."),Wi(0,n,"ok",void 0);else{var l=Mi(e),h=Cr(e.serverSyncTree_,path,c,l);wi(e.eventQueue_,h),e.server_.merge(path.toString(),t,(function(t,r){var o="ok"===t;o||A("update at "+path+" failed: "+t);var c=Or(e.serverSyncTree_,l,!o),h=c.length>0?Hi(e,path):path;Ci(e.eventQueue_,h,c),Wi(0,n,t,r)})),K(t,(function(t){var n=Yi(e,Ne(path,t));Hi(e,n)})),Ci(e.eventQueue_,path,[])}}(e._repo,e._path,t,n.wrapCallback((function(){}))),n.promise}function go(e){return function(e,t){var n=xr(e.serverSyncTree_,t);return null!=n?Promise.resolve(n):e.server_.get(t).then((function(n){var r=Ct(n).withIndex(t._queryParams.getIndex()),o=Tr(e.serverSyncTree_,t._path,r);return ki(e.eventQueue_,t._path,o),Promise.resolve(r)}),(function(n){return Bi(e,"get for query "+Object(c.stringify)(t)+" failed: "+n),Promise.reject(new Error(n))}))}((e=Object(c.getModularInstance)(e))._repo,e).then((function(t){return new uo(t,new co(e._repo,e._path),e._queryParams.getIndex())}))}var vo=function(){function e(e){this.callbackContext=e}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new eo("value",this,new uo(e.snapshotNode,new co(t._repo,t._path),n))},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},e.prototype.createCancelEvent=function(e,path){return this.callbackContext.hasCancelCallback?new to(this,e,path):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))},e.prototype.hasAnyCallback=function(){return null!==this.callbackContext},e}(),mo=function(){function e(e,t){this.eventType=e,this.callbackContext=t}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t},e.prototype.createCancelEvent=function(e,path){return this.callbackContext.hasCancelCallback?new to(this,e,path):null},e.prototype.createEvent=function(e,t){Object(c.assert)(null!=e.childName,"Child events should have a childName.");var n=po(new co(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new eo(e.type,this,new uo(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},e.prototype.matches=function(t){return t instanceof e&&(this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)))},e.prototype.hasAnyCallback=function(){return!!this.callbackContext},e}();function yo(e,t,n,r,o){var c;if("object"==typeof r&&(c=void 0,o=r),"function"==typeof r&&(c=r),o&&o.onlyOnce){var l=n,h=function(t,n){Ui(e._repo,e,f),l(t,n)};h.userCallback=n.userCallback,h.context=n.context,n=h}var d=new no(n,c||void 0),f="value"===t?new vo(d):new mo(t,d);return function(e,t,n){var r;r=".info"===Ee(t._path)?Er(e.infoSyncTree_,t,n):Er(e.serverSyncTree_,t,n),ki(e.eventQueue_,t._path,r)}(e._repo,e,f),function(){return Ui(e._repo,e,f)}}function bo(e,t,n,r){return yo(e,"value",t,n,r)}function wo(e,t,n,r){return yo(e,"child_added",t,n,r)}function ko(e,t,n,r){return yo(e,"child_changed",t,n,r)}function Co(e,t,n,r){return yo(e,"child_moved",t,n,r)}function Oo(e,t,n,r){return yo(e,"child_removed",t,n,r)}function To(e,t,n){var r=null,o=n?new no(n):null;"value"===t?r=new vo(o):t&&(r=new mo(t,o)),Ui(e._repo,e,r)}var Io=function(){},Eo=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.__extends)(t,e),t.prototype._apply=function(e){hi("endAt",this._value,e._path,!0);var t=Wt(e._queryParams,this._value,this._key);if(so(t),ao(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new io(e._repo,e._path,t,e._orderByCalled)},t}(Io);var So=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.__extends)(t,e),t.prototype._apply=function(e){hi("endBefore",this._value,e._path,!1);var t,n,r,o,c=(t=e._queryParams,n=this._value,r=this._key,t.index_===Ye?("string"==typeof n&&(n=Rt(n)),o=Wt(t,n,r)):o=Wt(t,n,null==r?D:Rt(r)),o.endBeforeSet_=!0,o);if(so(c),ao(c),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new io(e._repo,e._path,c,e._orderByCalled)},t}(Io);var xo=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.__extends)(t,e),t.prototype._apply=function(e){hi("startAt",this._value,e._path,!0);var t=Bt(e._queryParams,this._value,this._key);if(so(t),ao(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new io(e._repo,e._path,t,e._orderByCalled)},t}(Io);var Po=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.__extends)(t,e),t.prototype._apply=function(e){hi("startAfter",this._value,e._path,!1);var t=function(e,t,n){var r;e.index_===Ye?("string"==typeof t&&(t=jt(t)),r=Bt(e,t,n)):r=Bt(e,t,null==n?F:jt(n));return r.startAfterSet_=!0,r}(e._queryParams,this._value,this._key);if(so(t),ao(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new io(e._repo,e._path,t,e._orderByCalled)},t}(Io);var jo=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return Object(l.__extends)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new io(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="l",r),e._orderByCalled);var t,n,r},t}(Io);var Ro=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return Object(l.__extends)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new io(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="r",r),e._orderByCalled);var t,n,r},t}(Io);var No=function(e){function t(t){var n=e.call(this)||this;return n._path=t,n}return Object(l.__extends)(t,e),t.prototype._apply=function(e){oo(e,"orderByChild");var t=new Te(this._path);if(Ae(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new It(t),r=zt(e._queryParams,n);return ao(r),new io(e._repo,e._path,r,!0)},t}(Io);var Ao=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.__extends)(t,e),t.prototype._apply=function(e){oo(e,"orderByKey");var t=zt(e._queryParams,Ye);return ao(t),new io(e._repo,e._path,t,!0)},t}(Io);var Mo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.__extends)(t,e),t.prototype._apply=function(e){oo(e,"orderByPriority");var t=zt(e._queryParams,ft);return ao(t),new io(e._repo,e._path,t,!0)},t}(Io);var Do=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(l.__extends)(t,e),t.prototype._apply=function(e){oo(e,"orderByValue");var t=zt(e._queryParams,St);return ao(t),new io(e._repo,e._path,t,!0)},t}(Io);var Fo=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return Object(l.__extends)(t,e),t.prototype._apply=function(e){if(hi("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Eo(this._value,this._key)._apply(new xo(this._value,this._key)._apply(e))},t}(Io);function Lo(e){for(var t,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var h=Object(c.getModularInstance)(e);try{for(var d=Object(l.__values)(r),f=d.next();!f.done;f=d.next()){h=f.value._apply(h)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}return h}!function(e){Object(c.assert)(!Xn,"__referenceConstructor has already been defined"),Xn=e}(co),function(e){Object(c.assert)(!ar,"__referenceConstructor has already been defined"),ar=e}(co);var Uo="FIREBASE_DATABASE_EMULATOR_HOST",qo={},Bo=!1;function Wo(t,n,r,o,c){var l=o||t.options.databaseURL;void 0===l&&(t.options.projectId||N("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),P("Using default host for project ",t.options.projectId),l=t.options.projectId+"-default-rtdb.firebaseio.com");var h,d=Xi(l,c),f=d.repoInfo,_=void 0;void 0!==e&&(_=e.env[Uo]),_?(h=!0,l="http://"+_+"?ns="+f.namespace,f=(d=Xi(l,c)).repoInfo):h=!d.repoInfo.secure;var v=c&&h?new ee(ee.OWNER):new Z(t.name,t.options,n);yi("Invalid Firebase Database URL",d),Ae(d.path)||N("Database URL must point to the root of a Firebase Database (not including a child path).");var m=function(e,t,n,r){var o=qo[t.name];o||(o={},qo[t.name]=o);var c=o[e.toURLString()];c&&N("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return c=new Si(e,Bo,n,r),o[e.toURLString()]=c,c}(f,t,v,new X(t.name,r));return new zo(m,t)}var zo=function(){function e(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}return Object.defineProperty(e.prototype,"_repo",{get:function(){return this._instanceStarted||(xi(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new co(this._repo,Ie())),this._rootInternal},enumerable:!1,configurable:!0}),e.prototype._delete=function(){var e,t,n;return null!==this._rootInternal&&(e=this._repo,t=this.app.name,(n=qo[t])&&n[e.key]===e||N("Database "+t+"("+e.repoInfo_+") has already been deleted."),qi(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null),Promise.resolve()},e.prototype._checkNotDeleted=function(e){null===this._rootInternal&&N("Cannot call "+e+" on a deleted database.")},e}();function Ko(e,t,n,r){void 0===r&&(r={}),(e=Object(c.getModularInstance)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&N("Cannot call useEmulator() after instance has already been initialized.");var o=e._repoInternal,l=void 0;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&N('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),l=new ee(ee.OWNER);else if(r.mockUserToken){var h="string"==typeof r.mockUserToken?r.mockUserToken:Object(c.createMockUserToken)(r.mockUserToken,e.app.options.projectId);l=new ee(h)}!function(e,t,n,r){e.repoInfo_=new ae(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(o,t,n,l)}function Ho(e){var t;(e=Object(c.getModularInstance)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(Ii)}var Vo={".sv":"timestamp"};var Go=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}();function Qo(e,t,n){var r;if(e=Object(c.getModularInstance)(e),mi("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";var o=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,l=new c.Deferred,h=bo(e,(function(){}));return function(e,path,t,n,r,o){Bi(e,"transaction on "+path);var l={path:path,update:t,onComplete:n,status:null,order:O(),applyLocally:o,retryCount:0,unwatcher:r,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},h=zi(e,path,void 0);l.currentInputSnapshot=h;var d=l.update(h.val());if(void 0===d)l.unwatcher(),l.currentOutputSnapshotRaw=null,l.currentOutputSnapshotResolved=null,l.onComplete&&l.onComplete(null,!1,l.currentInputSnapshot);else{di("transaction failed: Data returned ",d,l.path),l.status=0;var f=Yr(e.transactionQueueTree_,path),_=Jr(f)||[];_.push(l),Xr(f,_);var v=void 0;"object"==typeof d&&null!==d&&Object(c.contains)(d,".priority")?(v=Object(c.safeGet)(d,".priority"),Object(c.assert)(ui(v),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):v=(Sr(e.serverSyncTree_,path)||bt.EMPTY_NODE).getPriority().val();var m=ji(e),y=Ct(d,v),w=Gr(y,h,m);l.currentOutputSnapshotRaw=y,l.currentOutputSnapshotResolved=w,l.currentWriteId=Mi(e);var k=kr(e.serverSyncTree_,path,w,l.currentWriteId,l.applyLocally);Ci(e.eventQueue_,path,k),Ki(e,e.transactionQueueTree_)}}(e._repo,e._path,t,(function(t,n,r){var o=null;t?l.reject(t):(o=new uo(r,new co(e._repo,e._path),ft),l.resolve(new Go(n,o)))}),h,o),l.promise}var $o=function(){function e(e){this._delegate=e}return e.prototype.cancel=function(e){Object(c.validateArgCount)("OnDisconnect.cancel",0,1,arguments.length),Object(c.validateCallback)("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.remove=function(e){Object(c.validateArgCount)("OnDisconnect.remove",0,1,arguments.length),Object(c.validateCallback)("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.set=function(e,t){Object(c.validateArgCount)("OnDisconnect.set",1,2,arguments.length),Object(c.validateCallback)("OnDisconnect.set","onComplete",t,!0);var n=this._delegate.set(e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},e.prototype.setWithPriority=function(e,t,n){Object(c.validateArgCount)("OnDisconnect.setWithPriority",2,3,arguments.length),Object(c.validateCallback)("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},e.prototype.update=function(e,t){if(Object(c.validateArgCount)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,A("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(c.validateCallback)("OnDisconnect.update","onComplete",t,!0);var r=this._delegate.update(e);return t&&r.then((function(){return t(null)}),(function(e){return t(e)})),r},e}(),Yo=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return Object(c.validateArgCount)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),Jo=function(){function e(e,t){this._database=e,this._delegate=t}return e.prototype.val=function(){return Object(c.validateArgCount)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},e.prototype.exportVal=function(){return Object(c.validateArgCount)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},e.prototype.toJSON=function(){return Object(c.validateArgCount)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.exists=function(){return Object(c.validateArgCount)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},e.prototype.child=function(path){return Object(c.validateArgCount)("DataSnapshot.child",0,1,arguments.length),path=String(path),gi("DataSnapshot.child","path",path,!1),new e(this._database,this._delegate.child(path))},e.prototype.hasChild=function(path){return Object(c.validateArgCount)("DataSnapshot.hasChild",1,1,arguments.length),gi("DataSnapshot.hasChild","path",path,!1),this._delegate.hasChild(path)},e.prototype.getPriority=function(){return Object(c.validateArgCount)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},e.prototype.forEach=function(t){var n=this;return Object(c.validateArgCount)("DataSnapshot.forEach",1,1,arguments.length),Object(c.validateCallback)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach((function(r){return t(new e(n._database,r))}))},e.prototype.hasChildren=function(){return Object(c.validateArgCount)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(e.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return Object(c.validateArgCount)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},e.prototype.getRef=function(){return Object(c.validateArgCount)("DataSnapshot.ref",0,0,arguments.length),new Zo(this._database,this._delegate.ref)},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Xo=function(){function e(e,t){this.database=e,this._delegate=t}return e.prototype.on=function(t,n,r,o){var l,h=this;Object(c.validateArgCount)("Query.on",2,4,arguments.length),Object(c.validateCallback)("Query.on","callback",n,!1);var d=e.getCancelAndContextArgs_("Query.on",r,o),f=function(e,t){n.call(d.context,new Jo(h.database,e),t)};f.userCallback=n,f.context=d.context;var _=null===(l=d.cancel)||void 0===l?void 0:l.bind(d.context);switch(t){case"value":return bo(this._delegate,f,_),n;case"child_added":return wo(this._delegate,f,_),n;case"child_removed":return Oo(this._delegate,f,_),n;case"child_changed":return ko(this._delegate,f,_),n;case"child_moved":return Co(this._delegate,f,_),n;default:throw new Error(Object(c.errorPrefix)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},e.prototype.off=function(e,t,n){if(Object(c.validateArgCount)("Query.off",0,3,arguments.length),function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(c.errorPrefix)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}("Query.off",e,!0),Object(c.validateCallback)("Query.off","callback",t,!0),Object(c.validateContextObject)("Query.off","context",n,!0),t){var r=function(){};r.userCallback=t,r.context=n,To(this._delegate,e,r)}else To(this._delegate,e)},e.prototype.get=function(){var e=this;return go(this._delegate).then((function(t){return new Jo(e.database,t)}))},e.prototype.once=function(t,n,r,o){var l=this;Object(c.validateArgCount)("Query.once",1,4,arguments.length),Object(c.validateCallback)("Query.once","callback",n,!0);var h=e.getCancelAndContextArgs_("Query.once",r,o),d=new c.Deferred,f=function(e,t){var r=new Jo(l.database,e);n&&n.call(h.context,r,t),d.resolve(r)};f.userCallback=n,f.context=h.context;var _=function(e){h.cancel&&h.cancel.call(h.context,e),d.reject(e)};switch(t){case"value":bo(this._delegate,f,_,{onlyOnce:!0});break;case"child_added":wo(this._delegate,f,_,{onlyOnce:!0});break;case"child_removed":Oo(this._delegate,f,_,{onlyOnce:!0});break;case"child_changed":ko(this._delegate,f,_,{onlyOnce:!0});break;case"child_moved":Co(this._delegate,f,_,{onlyOnce:!0});break;default:throw new Error(Object(c.errorPrefix)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return d.promise},e.prototype.limitToFirst=function(t){return Object(c.validateArgCount)("Query.limitToFirst",1,1,arguments.length),new e(this.database,Lo(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new jo(e)}(t)))},e.prototype.limitToLast=function(t){return Object(c.validateArgCount)("Query.limitToLast",1,1,arguments.length),new e(this.database,Lo(this._delegate,function(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new Ro(e)}(t)))},e.prototype.orderByChild=function(path){return Object(c.validateArgCount)("Query.orderByChild",1,1,arguments.length),new e(this.database,Lo(this._delegate,function(path){if("$key"===path)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===path)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===path)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return gi("orderByChild","path",path,!1),new No(path)}(path)))},e.prototype.orderByKey=function(){return Object(c.validateArgCount)("Query.orderByKey",0,0,arguments.length),new e(this.database,Lo(this._delegate,new Ao))},e.prototype.orderByPriority=function(){return Object(c.validateArgCount)("Query.orderByPriority",0,0,arguments.length),new e(this.database,Lo(this._delegate,new Mo))},e.prototype.orderByValue=function(){return Object(c.validateArgCount)("Query.orderByValue",0,0,arguments.length),new e(this.database,Lo(this._delegate,new Do))},e.prototype.startAt=function(t,n){return void 0===t&&(t=null),Object(c.validateArgCount)("Query.startAt",0,2,arguments.length),new e(this.database,Lo(this._delegate,function(e,t){return void 0===e&&(e=null),_i("startAt","key",t,!0),new xo(e,t)}(t,n)))},e.prototype.startAfter=function(t,n){return void 0===t&&(t=null),Object(c.validateArgCount)("Query.startAfter",0,2,arguments.length),new e(this.database,Lo(this._delegate,function(e,t){return _i("startAfter","key",t,!0),new Po(e,t)}(t,n)))},e.prototype.endAt=function(t,n){return void 0===t&&(t=null),Object(c.validateArgCount)("Query.endAt",0,2,arguments.length),new e(this.database,Lo(this._delegate,function(e,t){return _i("endAt","key",t,!0),new Eo(e,t)}(t,n)))},e.prototype.endBefore=function(t,n){return void 0===t&&(t=null),Object(c.validateArgCount)("Query.endBefore",0,2,arguments.length),new e(this.database,Lo(this._delegate,function(e,t){return _i("endBefore","key",t,!0),new So(e,t)}(t,n)))},e.prototype.equalTo=function(t,n){return Object(c.validateArgCount)("Query.equalTo",1,2,arguments.length),new e(this.database,Lo(this._delegate,function(e,t){return _i("equalTo","key",t,!0),new Fo(e,t)}(t,n)))},e.prototype.toString=function(){return Object(c.validateArgCount)("Query.toString",0,0,arguments.length),this._delegate.toString()},e.prototype.toJSON=function(){return Object(c.validateArgCount)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.isEqual=function(t){if(Object(c.validateArgCount)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){throw new Error("Query.isEqual failed: First argument must be an instance of firebase.database.Query.")}return this._delegate.isEqual(t._delegate)},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,Object(c.validateCallback)(e,"cancel",r.cancel,!0),r.context=n,Object(c.validateContextObject)(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(Object(c.errorPrefix)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return new Zo(this.database,new co(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),e}(),Zo=function(e){function t(t,n){var r=e.call(this,t,new io(n._repo,n._path,new qt,!1))||this;return r.database=t,r._delegate=n,r}return Object(l.__extends)(t,e),t.prototype.getKey=function(){return Object(c.validateArgCount)("Reference.key",0,0,arguments.length),this._delegate.key},t.prototype.child=function(e){return Object(c.validateArgCount)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new t(this.database,po(this._delegate,e))},t.prototype.getParent=function(){Object(c.validateArgCount)("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new t(this.database,e):null},t.prototype.getRoot=function(){return Object(c.validateArgCount)("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)},t.prototype.set=function(e,t){Object(c.validateArgCount)("Reference.set",1,2,arguments.length),Object(c.validateCallback)("Reference.set","onComplete",t,!0);var n=fo(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},t.prototype.update=function(e,t){if(Object(c.validateArgCount)("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},i=0;i<e.length;++i)n[""+i]=e[i];e=n,A("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}mi("Reference.update",this._delegate._path),Object(c.validateCallback)("Reference.update","onComplete",t,!0);var r=_o(this._delegate,e);return t&&r.then((function(){return t(null)}),(function(e){return t(e)})),r},t.prototype.setWithPriority=function(e,t,n){Object(c.validateArgCount)("Reference.setWithPriority",2,3,arguments.length),Object(c.validateCallback)("Reference.setWithPriority","onComplete",n,!0);var r=function(e,t,n){if(mi("setWithPriority",e._path),hi("setWithPriority",t,e._path,!1),fi("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new c.Deferred;return Di(e._repo,e._path,t,n,r.wrapCallback((function(){}))),r.promise}(this._delegate,e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},t.prototype.remove=function(e){Object(c.validateArgCount)("Reference.remove",0,1,arguments.length),Object(c.validateCallback)("Reference.remove","onComplete",e,!0);var t=function(e){return mi("remove",e._path),fo(e,null)}(this._delegate);return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},t.prototype.transaction=function(e,t,n){var r=this;Object(c.validateArgCount)("Reference.transaction",1,3,arguments.length),Object(c.validateCallback)("Reference.transaction","transactionUpdate",e,!1),Object(c.validateCallback)("Reference.transaction","onComplete",t,!0),function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(c.errorPrefix)(e,t)+"must be a boolean.")}("Reference.transaction","applyLocally",n,!0);var o=Qo(this._delegate,e,{applyLocally:n}).then((function(e){return new Yo(e.committed,new Jo(r.database,e.snapshot))}));return t&&o.then((function(e){return t(null,e.committed,e.snapshot)}),(function(e){return t(e,!1,null)})),o},t.prototype.setPriority=function(e,t){Object(c.validateArgCount)("Reference.setPriority",1,2,arguments.length),Object(c.validateCallback)("Reference.setPriority","onComplete",t,!0);var n=function(e,t){e=Object(c.getModularInstance)(e),mi("setPriority",e._path),fi("setPriority",t,!1);var n=new c.Deferred;return Di(e._repo,Ne(e._path,".priority"),t,null,n.wrapCallback((function(){}))),n.promise}(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},t.prototype.push=function(e,n){var r=this;Object(c.validateArgCount)("Reference.push",0,2,arguments.length),Object(c.validateCallback)("Reference.push","onComplete",n,!0);var o=function(e,t){e=Object(c.getModularInstance)(e),mi("push",e._path),hi("push",t,e._path,!0);var n,r=Pi(e._repo),o=Pt(r),l=po(e,o),h=po(e,o);return n=null!=t?fo(h,t).then((function(){return h})):Promise.resolve(h),l.then=n.then.bind(n),l.catch=n.then.bind(n,void 0),l}(this._delegate,e),l=o.then((function(e){return new t(r.database,e)}));n&&l.then((function(){return n(null)}),(function(e){return n(e)}));var h=new t(this.database,o);return h.then=l.then.bind(l),h.catch=l.catch.bind(l,void 0),h},t.prototype.onDisconnect=function(){return mi("Reference.onDisconnect",this._delegate._path),new $o(new ro(this._delegate._repo,this._delegate._path))},Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Xo),ea=function(){function e(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),Ko(this._delegate,e,t,n)},e.prototype.ref=function(path){if(Object(c.validateArgCount)("database.ref",0,1,arguments.length),path instanceof Zo){var e=ho(this._delegate,path.toString());return new Zo(this,e)}e=lo(this._delegate,path);return new Zo(this,e)},e.prototype.refFromURL=function(e){Object(c.validateArgCount)("database.refFromURL",1,1,arguments.length);var t=ho(this._delegate,e);return new Zo(this,t)},e.prototype.goOffline=function(){return Object(c.validateArgCount)("database.goOffline",0,0,arguments.length),e=this._delegate,(e=Object(c.getModularInstance)(e))._checkNotDeleted("goOffline"),void qi(e._repo);var e},e.prototype.goOnline=function(){return Object(c.validateArgCount)("database.goOnline",0,0,arguments.length),Ho(this._delegate)},e.ServerValue={TIMESTAMP:Vo,increment:function(e){return function(e){return{".sv":{increment:e}}}(e)}},e}();var ta=Object.freeze({__proto__:null,forceLongPolling:function(){ve.forceDisallow(),fe.forceAllow()},forceWebSockets:function(){fe.forceDisallow()},isWebSocketsAvailable:function(){return ve.isAvailable()},setSecurityDebugCallback:function(e,t){e._delegate._repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){!function(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var n;t?(e.statsListener_||(e.statsListener_=new Zt(e.stats_)),n=e.statsListener_.get()):n=e.stats_.get();var r=Object.keys(n).reduce((function(e,t){return Math.max(t.length,e)}),0);K(n,(function(e,t){for(var n=e,i=e.length;i<r+2;i++)n+=" ";console.log(n+t)}))}}(e._delegate._repo,t)},statsIncrementCounter:function(e,t){!function(e,t){var n,r;e.stats_.incrementCounter(t),n=e.statsReporter_,r=t,n.statsToReport_[r]=!0}(e._delegate._repo,t)},dataUpdateCount:function(e){return e._delegate._repo.dataUpdateCount},interceptServerData:function(e,t){return function(e,t){e.interceptServerDataCallback_=t}(e._delegate._repo,t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,c=e.customAuthImpl,l=e.namespace,h=e.nodeAdmin,d=void 0!==h&&h;f(r);var _=new o.Provider("auth-internal",new o.ComponentContainer("database-standalone"));return _.setComponent(new o.Component("auth-internal",(function(){return c}),"PRIVATE")),{instance:new ea(Wo(t,_,void 0,n,d),t),namespace:l}}}),na=Ve;Ve.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Ve.prototype.echo=function(data,e){this.sendRequest("echo",{d:data},e)};var ra=ye,ia=ae,oa=Object.freeze({__proto__:null,DataConnection:na,RealTimeConnection:ra,hijackHash:function(e){var t=Ve.prototype.put;return Ve.prototype.put=function(n,data,r,o){void 0!==o&&(o=e()),t.call(this,n,data,r,o)},function(){Ve.prototype.put=t}},ConnectionTarget:ia,queryIdentifier:function(e){return e._delegate._queryIdentifier},forceRestClient:function(e){!function(e){Bo=e}(e)}}),aa=ea.ServerValue;!function(e){f(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new o.Component("database",(function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),o=e.getProvider("auth-internal"),c=e.getProvider("app-check-internal");return new ea(Wo(r,o,c,n),r)}),"PUBLIC").setServiceProps({Reference:Zo,Query:Xo,Database:ea,DataSnapshot:Jo,enableLogging:x,INTERNAL:ta,ServerValue:aa,TEST_ACCESS:oa}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.11.0"),Object(c.isNodeSdk)()&&(t.exports=n)}(r.default)}).call(this,n(300),n(853)(e))},853:function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},854:function(e,t,n){"use strict";var r=n(770),component=n(781),o=n(776),c=n(780),l=n(788);function h(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var d,f=h(r),_=((d={})["already-activated"]="You are trying to activate AppCheck for FirebaseApp {$appName}, while it is already activated. AppCheck can only be activated once.",d["use-before-activation"]="AppCheck is being used before activate() is called for FirebaseApp {$appName}. Please make sure you call activate() before instantiating other Firebase services.",d["fetch-network-error"]="Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",d["fetch-parse-error"]="Fetch client could not parse response. Original error: {$originalErrorMessage}.",d["fetch-status-error"]="Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",d["storage-open"]="Error thrown when opening storage. Original error: {$originalErrorMessage}.",d["storage-get"]="Error thrown when reading from storage. Original error: {$originalErrorMessage}.",d["storage-set"]="Error thrown when writing to storage. Original error: {$originalErrorMessage}.",d["recaptcha-error"]="ReCAPTCHA error.",d),v=new c.ErrorFactory("appCheck","AppCheck",_),m=new Map,y={activated:!1,tokenObservers:[]},w={enabled:!1};function k(e){return m.get(e)||y}function C(e,t){m.set(e,t)}function O(){return w}var T="https://content-firebaseappcheck.googleapis.com/v1beta",I="exchangeDebugToken",E={OFFSET_DURATION:3e5,RETRIAL_MIN_WAIT:3e4,RETRIAL_MAX_WAIT:96e4},S=function(){function e(e,t,n,r,o){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=r,this.upperBound=o,this.pending=null,this.nextErrorWaitInterval=r,r>o)throw new Error("Proactive refresh lower bound greater than upper bound!")}return e.prototype.start=function(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch((function(){}))},e.prototype.stop=function(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)},e.prototype.isRunning=function(){return!!this.pending},e.prototype.process=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:this.stop(),n.label=1;case 1:return n.trys.push([1,6,,7]),this.pending=new c.Deferred,[4,(r=this.getNextRun(e),new Promise((function(e){setTimeout(e,r)})))];case 2:return n.sent(),this.pending.resolve(),[4,this.pending.promise];case 3:return n.sent(),this.pending=new c.Deferred,[4,this.operation()];case 4:return n.sent(),this.pending.resolve(),[4,this.pending.promise];case 5:return n.sent(),this.process(!0).catch((function(){})),[3,7];case 6:return t=n.sent(),this.retryPolicy(t)?this.process(!1).catch((function(){})):this.stop(),[3,7];case 7:return[2]}var r}))}))},e.prototype.getNextRun=function(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();var t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t},e}();function x(){return self.grecaptcha}function P(e){if(!k(e).activated)throw v.create("use-before-activation",{appName:e.name})}function j(e){return c.base64.encodeString(JSON.stringify(e),!1)}function R(e,t){var n=e.url,body=e.body;return o.__awaiter(this,void 0,void 0,(function(){var e,r,c,l,h,d,f,_,m,y;return o.__generator(this,(function(o){switch(o.label){case 0:e={"Content-Type":"application/json"},(r=t.getImmediate({optional:!0}))&&(e["X-Firebase-Client"]=r.getPlatformInfoString()),c={method:"POST",body:JSON.stringify(body),headers:e},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,fetch(n,c)];case 2:return l=o.sent(),[3,4];case 3:throw h=o.sent(),v.create("fetch-network-error",{originalErrorMessage:h.message});case 4:if(200!==l.status)throw v.create("fetch-status-error",{httpStatus:l.status});o.label=5;case 5:return o.trys.push([5,7,,8]),[4,l.json()];case 6:return d=o.sent(),[3,8];case 7:throw f=o.sent(),v.create("fetch-parse-error",{originalErrorMessage:f.message});case 8:if(!(_=d.ttl.match(/^([\d.]+)(s)$/))||!_[2]||isNaN(Number(_[1])))throw v.create("fetch-parse-error",{originalErrorMessage:"ttl field (timeToLive) is not in standard Protobuf Duration format: "+d.ttl});return m=1e3*Number(_[1]),y=Date.now(),[2,{token:d.attestationToken,expireTimeMillis:y+m,issuedAtTimeMillis:y}]}}))}))}function N(e,t){var n=e.options,r=n.projectId,o=n.appId,c=n.apiKey;return{url:T+"/projects/"+r+"/apps/"+o+":exchangeRecaptchaToken?key="+c,body:{recaptcha_token:t}}}function A(e,t){var n=e.options,r=n.projectId,o=n.appId,c=n.apiKey;return{url:T+"/projects/"+r+"/apps/"+o+":"+I+"?key="+c,body:{debug_token:t}}}var M="firebase-app-check-database",D=1,F="firebase-app-check-store",L="debug-token",U=null;function B(){return U||(U=new Promise((function(e,t){try{var n=indexedDB.open(M,D);n.onsuccess=function(t){e(t.target.result)},n.onerror=function(e){var n;t(v.create("storage-open",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))},n.onupgradeneeded=function(e){var t=e.target.result;if(0===e.oldVersion)t.createObjectStore(F,{keyPath:"compositeKey"})}}catch(e){t(v.create("storage-open",{originalErrorMessage:e.message}))}})),U)}function W(e){return K(H(e))}function z(e,t){return o.__awaiter(this,void 0,void 0,(function(){var n,r,c,l;return o.__generator(this,(function(o){switch(o.label){case 0:return[4,B()];case 1:return n=o.sent(),r=n.transaction(F,"readwrite"),c=r.objectStore(F),l=c.put({compositeKey:e,value:t}),[2,new Promise((function(e,t){l.onsuccess=function(t){e()},r.onerror=function(e){var n;t(v.create("storage-set",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}}))]}}))}))}function K(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n,r,c;return o.__generator(this,(function(o){switch(o.label){case 0:return[4,B()];case 1:return t=o.sent(),n=t.transaction(F,"readonly"),r=n.objectStore(F),c=r.get(e),[2,new Promise((function(e,t){c.onsuccess=function(t){var n=t.target.result;e(n?n.value:void 0)},n.onerror=function(e){var n;t(v.create("storage-get",{originalErrorMessage:null===(n=e.target.error)||void 0===n?void 0:n.message}))}}))]}}))}))}function H(e){return e.options.appId+"-"+e.name}var V=new l.Logger("@firebase/app-check");function G(e,t){return c.isIndexedDBAvailable()?function(e,t){return z(H(e),t)}(e,t).catch((function(e){V.warn("Failed to write token to indexeddb. Error: "+e)})):Promise.resolve()}function Q(){return o.__awaiter(this,void 0,void 0,(function(){var e,t;return o.__generator(this,(function(n){switch(n.label){case 0:e=void 0,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,K(L)];case 2:return e=n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return e?[2,e]:(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),(r=t,z(L,r)).catch((function(e){return V.warn("Failed to persist debug token to indexeddb. Error: "+e)})),console.log("AppCheck debug token: "+t+". You will need to whitelist it in the Firebase console for it to work"),[2,t])}var r}))}))}function $(){return o.__awaiter(this,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){if((e=O()).enabled&&e.token)return[2,e.token.promise];throw Error("\n            Can't get debug token in production mode.\n        ")}))}))}var Y={error:"UNKNOWN_ERROR"};function J(e,t,n){return void 0===n&&(n=!1),o.__awaiter(this,void 0,void 0,(function(){var r,c,l,h,d,f,_,v,m,y;return o.__generator(this,(function(w){switch(w.label){case 0:return P(e),r=k(e),c=r.token,l=void 0,c?[3,2]:[4,r.cachedTokenPromise];case 1:(h=w.sent())&&te(h)&&(c=h,C(e,o.__assign(o.__assign({},r),{token:c})),ee(e,{token:c.token})),w.label=2;case 2:return!n&&c&&te(c)?[2,{token:c.token}]:O().enabled?(f=R,_=A,v=[e],[4,$()]):[3,6];case 3:return[4,f.apply(void 0,[_.apply(void 0,v.concat([w.sent()])),t])];case 4:return d=w.sent(),[4,G(e,d)];case 5:return w.sent(),C(e,o.__assign(o.__assign({},r),{token:d})),[2,{token:d.token}];case 6:return w.trys.push([6,8,,9]),[4,r.provider.getToken()];case 7:return c=w.sent(),[3,9];case 8:return m=w.sent(),V.error(m),l=m,[3,9];case 9:return c?[3,10]:(y=function(e){return{token:j(Y),error:e}}(l),[3,12]);case 10:return y={token:c.token},C(e,o.__assign(o.__assign({},r),{token:c})),[4,G(e,c)];case 11:w.sent(),w.label=12;case 12:return ee(e,y),[2,y]}}))}))}function X(e,t,n,r,c){var l=k(e),h={next:r,error:c,type:n},d=o.__assign(o.__assign({},l),{tokenObservers:o.__spreadArray(o.__spreadArray([],l.tokenObservers),[h])});if(!d.tokenRefresher){var f=function(e,t){var n=this;return new S((function(){return o.__awaiter(n,void 0,void 0,(function(){var n;return o.__generator(this,(function(r){switch(r.label){case 0:return k(e).token?[3,2]:[4,J(e,t)];case 1:return n=r.sent(),[3,4];case 2:return[4,J(e,t,!0)];case 3:n=r.sent(),r.label=4;case 4:if(n.error)throw n.error;return[2]}}))}))}),(function(){return!0}),(function(){var t=k(e);if(t.token){var n=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5,r=t.token.expireTimeMillis-3e5;return n=Math.min(n,r),Math.max(0,n-Date.now())}return 0}),E.RETRIAL_MIN_WAIT,E.RETRIAL_MAX_WAIT)}(e,t);d.tokenRefresher=f}if(!d.tokenRefresher.isRunning()&&l.isTokenAutoRefreshEnabled&&d.tokenRefresher.start(),l.token&&te(l.token)){var _=l.token;Promise.resolve().then((function(){return r({token:_.token})})).catch((function(){}))}else null==l.token&&l.cachedTokenPromise.then((function(e){e&&te(e)&&r({token:e.token})})).catch((function(){}));C(e,d)}function Z(e,t){var n=k(e),r=n.tokenObservers.filter((function(e){return e.next!==t}));0===r.length&&n.tokenRefresher&&n.tokenRefresher.isRunning()&&n.tokenRefresher.stop(),C(e,o.__assign(o.__assign({},n),{tokenObservers:r}))}function ee(e,t){for(var n=0,r=k(e).tokenObservers;n<r.length;n++){var o=r[n];try{"EXTERNAL"===o.type&&null!=t.error?o.error(t.error):o.next(t)}catch(e){}}}function te(e){return e.expireTimeMillis-Date.now()>0}var ne="https://www.google.com/recaptcha/api.js";function re(e,t){var n=k(e),r=new c.Deferred;C(e,o.__assign(o.__assign({},n),{reCAPTCHAState:{initialized:r}}));var l="fire_app_check_"+e.name,h=document.createElement("div");h.id=l,h.style.display="none",document.body.appendChild(h);var d,script,f=x();return f?f.ready((function(){oe(e,t,f,l),r.resolve(f)})):(d=function(){var n=x();if(!n)throw new Error("no recaptcha");n.ready((function(){oe(e,t,n,l),r.resolve(n)}))},(script=document.createElement("script")).src=""+ne,script.onload=d,document.head.appendChild(script)),r.promise}function ie(e){return o.__awaiter(this,void 0,void 0,(function(){var t;return o.__generator(this,(function(n){switch(n.label){case 0:return P(e),[4,k(e).reCAPTCHAState.initialized.promise];case 1:return t=n.sent(),[2,new Promise((function(n,r){var o=k(e).reCAPTCHAState;t.ready((function(){n(t.execute(o.widgetId,{action:"fire_app_check"}))}))}))]}}))}))}function oe(e,t,n,r){var c=n.render(r,{sitekey:t,size:"invisible"}),l=k(e);C(e,o.__assign(o.__assign({},l),{reCAPTCHAState:o.__assign(o.__assign({},l.reCAPTCHAState),{widgetId:c})}))}var ae=function(){function e(e){this._siteKey=e}return e.prototype.getToken=function(){return o.__awaiter(this,void 0,void 0,(function(){var e;return o.__generator(this,(function(t){switch(t.label){case 0:if(!this._app||!this._platformLoggerProvider)throw v.create("use-before-activation",{appName:""});t.label=1;case 1:return t.trys.push([1,3,,4]),[4,ie(this._app)];case 2:return e=t.sent(),[3,4];case 3:throw t.sent(),v.create("recaptcha-error");case 4:return[2,R(N(this._app,e),this._platformLoggerProvider)]}}))}))},e.prototype.initialize=function(e,t){this._app=e,this._platformLoggerProvider=t,re(e,this._siteKey).catch((function(){}))},e}(),se=function(){function e(e){this._customProviderOptions=e}return e.prototype.getToken=function(){return o.__awaiter(this,void 0,void 0,(function(){var e,t,n;return o.__generator(this,(function(r){switch(r.label){case 0:if(!this._app)throw v.create("use-before-activation",{appName:""});return[4,this._customProviderOptions.getToken()];case 1:return e=r.sent(),t=c.issuedAtTime(e.token),n=null!==t&&t<Date.now()&&t>0?1e3*t:Date.now(),[2,o.__assign(o.__assign({},e),{issuedAtTimeMillis:n})]}}))}))},e.prototype.initialize=function(e){this._app=e},e}();function ce(e,t,n,r){var l=k(e);if(l.activated)throw v.create("already-activated",{appName:e.name});var h=o.__assign(o.__assign({},l),{activated:!0});h.cachedTokenPromise=function(e){return o.__awaiter(this,void 0,void 0,(function(){var t,n;return o.__generator(this,(function(r){switch(r.label){case 0:if(!c.isIndexedDBAvailable())return[3,5];t=void 0,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,W(e)];case 2:return t=r.sent(),[3,4];case 3:return n=r.sent(),V.warn("Failed to read token from indexeddb. Error: "+n),[3,4];case 4:return[2,t];case 5:return[2,void 0]}}))}))}(e).then((function(t){return t&&te(t)&&C(e,o.__assign(o.__assign({},k(e)),{token:t})),t})),h.provider="string"==typeof t?new ae(t):t instanceof ae||t instanceof se?t:new se({getToken:t.getToken}),h.isTokenAutoRefreshEnabled=void 0===r?e.automaticDataCollectionEnabled:r,C(e,h),h.provider.initialize(e,n)}function ue(e,t){return{app:e,activate:function(n,r){return ce(e,n,t,r)},setTokenAutoRefreshEnabled:function(t){return function(e,t){var n=k(e);n.tokenRefresher&&(!0===t?n.tokenRefresher.start():n.tokenRefresher.stop()),C(e,o.__assign(o.__assign({},n),{isTokenAutoRefreshEnabled:t}))}(e,t)},getToken:function(n){return function(e,t,n){return o.__awaiter(this,void 0,void 0,(function(){var r;return o.__generator(this,(function(o){switch(o.label){case 0:return[4,J(e,t,n)];case 1:if((r=o.sent()).error)throw r.error;return[2,{token:r.token}]}}))}))}(e,t,n)},onTokenChanged:function(n,r,o){return function(e,t,n,r,o){var c=function(){},l=function(){};return c=null!=n.next?n.next.bind(n):n,null!=n.error?l=n.error.bind(n):r&&(l=r),X(e,t,"EXTERNAL",c,l),function(){return Z(e,c)}}(e,t,n,r)},INTERNAL:{delete:function(){for(var t=0,n=k(e).tokenObservers;t<n.length;t++){var r=n[t];Z(e,r.next)}return Promise.resolve()}}}}var le="app-check-internal";!function(e){e.INTERNAL.registerComponent(new component.Component("appCheck",(function(e){return ue(e.getProvider("app").getImmediate(),e.getProvider("platform-logger"))}),"PUBLIC").setServiceProps({ReCaptchaV3Provider:ae,CustomProvider:se}).setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((function(e,t,n){e.getProvider(le).initialize()}))),e.INTERNAL.registerComponent(new component.Component(le,(function(e){return function(e,t){return{getToken:function(n){return J(e,t,n)},addTokenListener:function(n){return X(e,t,"INTERNAL",n)},removeTokenListener:function(t){return Z(e,t)}}}(e.getProvider("app").getImmediate(),e.getProvider("platform-logger"))}),"PUBLIC").setInstantiationMode("EXPLICIT")),e.registerVersion("@firebase/app-check","0.3.2")}(f.default),function(){var e=c.getGlobal();if("string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN||!0===e.FIREBASE_APPCHECK_DEBUG_TOKEN){var t=O();t.enabled=!0;var n=new c.Deferred;t.token=n,"string"==typeof e.FIREBASE_APPCHECK_DEBUG_TOKEN?n.resolve(e.FIREBASE_APPCHECK_DEBUG_TOKEN):n.resolve(Q())}}()}}]);