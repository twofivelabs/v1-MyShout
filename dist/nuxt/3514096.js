(window.webpackJsonp=window.webpackJsonp||[]).push([[100],{978:function(e,t,n){"use strict";n.r(t);var r=n(0),o=(n(17),n(67),n(3)),c=Object(o.b)({name:"NotificationsToggle",props:{label:{type:String,default:function(){return"Notifications"}}},setup:function(){var e=Object(o.r)(),t=e.state,n=e.dispatch,c=Object(o.m)(),l=c.$notify,f=c.$system,v=c.$capacitor,m=c.$fire,d=Object(o.a)((function(){return t.user.data})),x=Object(o.a)((function(){return t.user.profile})),k=Object(o.i)(!1),w=Object(o.i)(null),h=Object(o.i)(null),j=Object(o.i)(!1),O=Object(o.i)(!1);Object(o.f)(Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.device();case 2:h.value=e.sent,h.value&&h.value.platform&&("web"===h.value.platform||void 0===h.value.platform||null===h.value.platform)&&(j.value=!0),Object(o.d)((function(){setTimeout((function(){x.value.permissions.notifications&&(O.value=!0)}),1e3)}));case 5:case"end":return e.stop()}}),e)}))));var R=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n("user/updateField",{permissions:{notifications:!1}});case 2:if(j.value){e.next=5;break}return e.next=5,v.pushNotificationsRemoveListeners();case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("notificationPermissionGranted.value",O.value),!0!==O.value){e.next=13;break}if(!j.value){e.next=8;break}return e.next=5,P();case 5:w.value=x.value.notificationWebToken,e.next=11;break;case 8:return e.next=10,v.pushNotificationsRequestAndRegisterPermissions();case 10:w.value=x.value.notificationDeviceToken;case 11:e.next=15;break;case 13:return e.next=15,R();case 15:if(!O.value){e.next=18;break}return e.next=18,n("user/updateField",{permissions:{notifications:O.value}});case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=Object(r.a)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,window.Notification){e.next=5;break}l.show({text:"Notifications not supported!",color:"error"}),e.next=14;break;case 5:return e.next=7,Notification.requestPermission();case 7:if(t=e.sent,O.value="granted"===t,!m.messaging){e.next=12;break}return e.next=12,m.messaging.getToken();case 12:return e.next=14,n("user/updateField",{permissions:{notifications:"granted"===t}});case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(0),l.show({text:"Error with your notifications.",color:"error"}),f.log({comp:"UserToggleSettings",msg:"requestWebPermissions",val:e.t0});case 20:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}();return{loading:k,user:d,token:w,profile:x,notificationPermissionGranted:O,toggleNotifications:N}}}),l=c,f=n(43),v=n(45),m=n.n(v),d=n(1086),component=Object(f.a)(l,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("v-switch",{attrs:{"hide-details":"true",label:e.label,"prepend-icon":"mdi-bell"},on:{click:e.toggleNotifications},model:{value:e.notificationPermissionGranted,callback:function(t){e.notificationPermissionGranted=t},expression:"notificationPermissionGranted"}})}),[],!1,null,null,null);t.default=component.exports;m()(component,{VSwitch:d.a})}}]);